{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"DFIR Techniques","text":"<p>This documentation provides a comprehensive collection of Digital Forensics and Incident Response (DFIR) techniques, tools, and references across multiple domains.</p>"},{"location":"#navigation","title":"Navigation","text":"<p>Use the navigation menu to explore the following domains:</p> <ul> <li>Windows - Forensics techniques and tools for Windows systems</li> <li>Linux - Forensics techniques and tools for Linux systems  </li> <li>Networking - Network traffic analysis and investigation methods</li> <li>Cloud - Cloud forensics and investigation procedures</li> <li>Malware - Malware analysis techniques and tools</li> <li>ICS - Industrial Control Systems security and forensics</li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":"<p>Select a domain from the navigation to view available tools, techniques, and references.</p>"},{"location":"#contributing","title":"Contributing","text":"<p>This is an evolving resource for DFIR practitioners. Content is organized by domain and technique for easy reference.</p>"},{"location":"1.Windows/","title":"Overview","text":"<ul> <li>1. User Account Profiling</li> <li>2. System Profiling</li> <li>3. NTUSER.DAT Analysis</li> <li>4. Application Execution Analysis</li> <li>5. Cloud Storage Forensics - One Drive</li> <li>Evidence of Execution</li> <li>AutoStart Persistence</li> <li>Windows Services Persistence</li> </ul>"},{"location":"1.Windows/Application_Execution_Analysis/","title":"Application Execution Analysis (DFIR)","text":""},{"location":"1.Windows/Application_Execution_Analysis/#overview","title":"Overview","text":"<p>Application Execution Analysis focuses on identifying what programs ran, when they ran, which user executed them, and what artifacts those programs touched during execution.</p> <p>This is essential for:    - Identifying attacker tooling (LOLBins, remote tools, dumpers, exfil tools)    - Correlating execution to the incident timeline    - Proving or disproving user involvement    - Pivoting to file, registry, and log artifacts tied to execution</p> <p>This workflow uses:    - Registry Explorer (interactive analysis)    - RECmd.exe (automation)    - Win Prefetch View (GUI Prefetch review)    - PECmd.exe (bulk Prefetch parsing + timeline output)</p>"},{"location":"1.Windows/Application_Execution_Analysis/#primary-artifacts","title":"Primary Artifacts","text":""},{"location":"1.Windows/Application_Execution_Analysis/#registry-hives","title":"Registry Hives","text":"<ul> <li><code>C:\\Users\\{user}\\NTUSER.DAT</code></li> <li><code>C:\\Windows\\System32\\config\\SYSTEM</code></li> </ul>"},{"location":"1.Windows/Application_Execution_Analysis/#prefetch-files","title":"Prefetch Files","text":"<ul> <li><code>C:\\Windows\\Prefetch\\*.pf</code></li> </ul>"},{"location":"1.Windows/Application_Execution_Analysis/#tools-used","title":"Tools Used","text":"<ul> <li>Registry Explorer (Eric Zimmerman)</li> <li>RECmd.exe (Eric Zimmerman)</li> <li>Win Prefetch View (NirSoft)</li> <li>PECmd.exe (Eric Zimmerman)</li> <li>Timeline Explorer (Eric Zimmerman)</li> </ul>"},{"location":"1.Windows/Application_Execution_Analysis/#workflow-registry-explorer-ntuserdat-system","title":"Workflow \u2013 Registry Explorer (NTUSER.DAT + SYSTEM)","text":""},{"location":"1.Windows/Application_Execution_Analysis/#step-1-load-ntuserdat_clean-and-system_clean-in-registry-explorer","title":"Step 1 \u2014 Load NTUSER.DAT_clean and SYSTEM_clean in Registry Explorer","text":""},{"location":"1.Windows/Application_Execution_Analysis/#goal","title":"Goal","text":"<p>Load both hives at once so you can pivot between user execution artifacts and system execution artifacts.</p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure","title":"Procedure","text":"<ol> <li>Open both NTUSER.DAT_clean and SYSTEM_clean Hive in Registry Explorer (refer to 2. System Profiling and 3. NTUSER.DAT Analysis on how to create those hives if not present)<ul> <li>Launch Registry Explorer</li> <li>Select File \u2192 Load Hive</li> <li>Use CTRL-left-click to select both SYSTEM_clean and NTUSER.DAT_clean and click Open.</li> <li>There should now be two registry hives open within Registry Explorer</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Two hives loaded](img/app_execution/01_two_hives_loaded.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#step-2-investigate-bam-background-activity-moderator","title":"Step 2 \u2014 Investigate BAM (Background Activity Moderator)","text":""},{"location":"1.Windows/Application_Execution_Analysis/#registry-path-example","title":"Registry Path (Example)","text":"<pre><code>SYSTEM\\ControlSet001\\Services\\bam\\State\\UserSettings\\&lt;SID-RID&gt;\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#what-is-bam","title":"What is BAM?","text":"<p>BAM is an acronym for the Background Activity Moderator, and the corresponding registry key maintains a simple list of applications executed and their last execution time.  Data is stored per user via sub-keys named for each account security identifier / relative identifier (SID/RID)</p> <p>Example for RID 1002: <pre><code>SYSTEM\\ControlSet001\\Services\\bam\\State\\UserSettings\\S-1-5-21-528816539-567677750-276746561-1002\n</code></pre></p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_1","title":"Procedure","text":"<ol> <li>Navigate to the BAM key for the user account of interest. Example:<ul> <li><code>SYSTEM\\ControlSet001\\Services\\bam\\State\\UserSettings\\S-1-5-21-528816539-567677750-276746561-1002</code></li> </ul> </li> <li>Sort entries by Execution Time</li> <li>Sort the contents by Execution Time and review applications executed around the time of interest.</li> <li>Document suspicious programs or applications.</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - BAM execution times](img/app_execution/02_bam_execution.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#dfir-tips","title":"DFIR Tips","text":"<p>Flag executions such as: - <code>powershell.exe</code>, <code>cmd.exe</code> - <code>rundll32.exe</code>, <code>regsvr32.exe</code>, <code>mshta.exe</code> - <code>wmic.exe</code>, <code>certutil.exe</code>, <code>bitsadmin.exe</code> - <code>procdump.exe</code>, <code>mimikatz.exe</code>, <code>rclone.exe</code> - utilities from <code>Temp</code>/<code>Downloads</code>/<code>AppData</code></p>"},{"location":"1.Windows/Application_Execution_Analysis/#step-3-investigate-userassist-deep-gui-execution-insight","title":"Step 3 \u2014 Investigate UserAssist (Deep GUI Execution Insight)","text":""},{"location":"1.Windows/Application_Execution_Analysis/#registry-path","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#what-is-userassist","title":"What is UserAssist?","text":"<p>UserAssist has long been a valuable Windows artifact for providing deep insight into application use. Because it is present in the NTUSER.DAT hive, all activity is directly tied to the account who owns that NTUSER.DAT. While UserAssist typically only tracks GUI-based applications, it provides a wealth of usage information difficult to get elsewhere such as:    - Start Menu launches    - Shortcut executions    - Pinned taskbar items</p> <p>UserAssist data is stored using ROT-13 encoding; Registry Explorer decodes this through a plugin.</p>"},{"location":"1.Windows/Application_Execution_Analysis/#key-guids-of-interest","title":"Key GUIDs of Interest","text":"<ul> <li>Executable file execution</li> <li><code>CEBFF5CD-ACE2-4F4F-9178-9926F41749EA</code></li> <li>Shortcut file execution</li> <li><code>F4E57C4B-2036-45F0-A9AB-443BCFE33D9F</code></li> </ul>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_2","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\Currentversion\\Explorer\\UserAssist\\</code> key in Registry Explorer.</li> <li>Notice a series of sub-keys in Globally Unique Identifier (GUID) format. Each GUID represents a different way application execution can be tracked by the operating system (whether something was opened via a shortcut, via the start-menu, via the Windows Universal Application \"tiled\" interface, etc.)</li> <li>The two most commonly used GUIDs under UserAssist are:<ul> <li><code>CEBFF5CD-ACE2-4F4F-9178-9926F41749EA</code> -&gt; Executable File Execution</li> <li><code>F4E57C4B-2036-45F0-A9AB-443BCFE33D9F</code> -&gt; Shortcut File Execution</li> </ul> </li> <li>Start with the GUID beginning with F4E57, and click its sub-key named Count to trigger the Registry Explorer plugin.<ul> <li><code>...\\UserAssist\\{F4E57...}\\Count</code></li> </ul> </li> <li>Sort the output by Program Name.</li> <li>Review the contents for items of interest such as what items were pinned to the user's taskbar?</li> <li>Next move to the UserAssist GUID beginning with CEBFF, and click its sub-key named Count to trigger the Registry Explorer plugin.<ul> <li><code>...\\UserAssist\\{CEBFF...}\\Count</code></li> </ul> </li> <li>Sort the output by Last Executed and document any suspicious entries.</li> <li>Sort the output by Focus Count. This value represents the number of times that application was the primary window for the user. Items with a higher focus count often represent more commonly used applications for that user. Document what user applications have high focus count.</li> <li>You can use these execution times to pivot to other artifacts, for example, if regedit.exe was executed at 2025-10-10:50:25 UTC search for registry keys with last write timestamps near that timestamp.</li> <li>Use Ctrl-F (or Tools -&gt; Find) to open the Registry Explorer search dialog.</li> <li>Under Last write timestamp select Between and use the time frame of interest such as 2025-10-10:50:25 and 2025-10-10:55:25. Any results could indicate those registry keys may have been manipulated.</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - UserAssist plugin output](img/app_execution/03_userassist.png)\n</code></pre> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Find by timestamp window](img/app_execution/04_find_timestamp.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#workflow-prefetch-execution-evidence","title":"Workflow \u2013 Prefetch (Execution Evidence)","text":""},{"location":"1.Windows/Application_Execution_Analysis/#step-4-investigate-prefetch-with-win-prefetch-view-gui","title":"Step 4 \u2014 Investigate Prefetch with Win Prefetch View (GUI)","text":""},{"location":"1.Windows/Application_Execution_Analysis/#what-is-prefetch","title":"What is Prefetch","text":"<p>Prefetch tracks executed applications from both the GUI and command-line, often making it even more comprehensive than other app execution artifacts (and providing an edge against attackers who utilize the command-line in an attempt to leave fewer artifacts)</p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_3","title":"Procedure","text":"<ol> <li>Open Win Prefetch View</li> <li>Win Prefetch View defaults to opening up the live system Prefetch, switch to the mounted triage image:<ul> <li>Select <code>Options</code> -&gt; <code>Advanced Options</code>.</li> <li>Browse to the mounted triage image Prefetch folder (such as E:\\C\\Windows\\Prefetch).</li> <li>Click OK</li> </ul> </li> <li>Review the entries and document any suspicious or noteworthy executions. The executable name will be the first part of the entry, the alphanumeric after the dash is based on where the executable ran from. Noteworthy execution examples are:<ul> <li><code>TSTHEME.EXE-01D23267.pf</code> (executes on the system during incoming remote desktop protocol (RDP) sessions, it is a good indicator of incoming RDP to a computer)</li> <li><code>MSTSC.EXE-2B5707A7.pf</code> (used to engage outbound RDP connections from a system (basically the exact opposite of TSTHEME.exe)</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Win Prefetch View - Prefetch list](img/app_execution/05_winprefetchview.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#step-5-prefetch-parsing-with-pecmdexe-command-line-timelines","title":"Step 5 \u2014 Prefetch Parsing with PECmd.exe (Command Line + Timelines)","text":"<p>This is a command-line based tool allowing fast and comprehensive parsing of large numbers of Prefetch files.</p>"},{"location":"1.Windows/Application_Execution_Analysis/#5a-single-prefetch-file-analysis","title":"5A \u2014 Single Prefetch File Analysis","text":""},{"location":"1.Windows/Application_Execution_Analysis/#procedure_4","title":"Procedure","text":"<ol> <li>Open an Administrator Command Prompt.</li> <li>Navigate to your evidence directory that contains the Prefetch file (this example will use <code>E:\\C\\Windows\\prefetch and SDELETE.EXE-0E837E93.pf</code>)</li> <li>Execute Command: <pre><code>PECmd.exe -f \"E:\\C\\Windows\\Prefetch\\SDELETE.EXE-0E837E93.pf\"\n</code></pre></li> <li>Review execution times and most importantly any interesting File References. The File References are any files that this executable touched within 10 seconds of running which can provide invaluable artifacts to expand your investigation. Document:<ul> <li>execution times</li> <li>run count</li> <li>File References (files touched within ~10 seconds of execution)</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![PECmd - single file parse output](img/app_execution/06_pecmd_single.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#5b-bulk-prefetch-parsing-all-prefetch","title":"5B \u2014 Bulk Prefetch Parsing (All Prefetch)","text":"<p>Run PECmd against every Prefetch file acquired from the system.</p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_5","title":"Procedure","text":"<ol> <li>Open an Administrator Command Prompt.</li> <li>To do this you will use the -d option to point at the Prefetch directory, the -q option for quiet-mode (less output), and --csv for the output location.</li> <li>Execute Command: <pre><code>PECmd.exe -d \"E:\\C\\Windows\\Prefetch\" -q --csv \"G:\\Evidence\\Prefetch\"\n</code></pre></li> <li>Open Timeline Explorer and open the resulting output file named <code>&lt;Timestamp&gt;_PECmd_Output_Timeline.csv</code>.</li> <li>Sort the output by the Run Time column and review the PECmd timeline output.</li> <li>This file has every execution recorded by Prefetch in chronological order. It can be very useful for seeing relationships between different tools and in profiling user actions on a system.</li> <li>Filter the Executable Name column for any executions of interest to determine which locations they ran from.</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Timeline Explorer - PECmd timeline output](img/app_execution/07_timeline_explorer_pecmd.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#dfir-tips_1","title":"DFIR Tips","text":"<ul> <li>Prefetch is ideal for spotting execution chains:</li> <li><code>WINWORD.EXE</code> \u2192 <code>POWERSHELL.EXE</code> \u2192 <code>RUNDLL32.EXE</code></li> <li>File References enable rapid pivoting to:</li> <li>payloads</li> <li>dropped artifacts</li> <li>accessed sensitive documents</li> </ul>"},{"location":"1.Windows/Application_Execution_Analysis/#workflow-taskbar-featureusage-user-interaction-detail","title":"Workflow \u2013 Taskbar FeatureUsage (User Interaction Detail)","text":""},{"location":"1.Windows/Application_Execution_Analysis/#step-6-investigate-featureusage-taskbar-jump-list-interaction","title":"Step 6 \u2014 Investigate FeatureUsage (Taskbar + Jump List Interaction)","text":""},{"location":"1.Windows/Application_Execution_Analysis/#registry-path_1","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#what-is-featureusage","title":"What is FeatureUsage","text":"<p>FeatureUsage tracks both application execution and an interesting set of data found nowhere else. The set of sub-keys under FeatureUsage track different activities occurring on the Windows task bar. It ties to the user activities like pinning an application and use of the application Jump Lists (application knowledge), number of times the shortcuts were used (execution count), number of times an application was put into focus, and clicks on other parts of the task bar like the system clock and search dialogs. While these artifacts are not necessarily comprehensive (they appear to be only tied to actions involving GUI applications and/or the task bar), they do give great insight into user interactions down to the click level.</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - FeatureUsage key](img/app_execution/08_featureusage_root.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#6a-appbadgeupdated","title":"6A \u2014 AppBadgeUpdated","text":"<p>Tracks: applications generating taskbar badge notifications</p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_6","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppBadgeUpdated</code> subkey in Registry Explorer.</li> <li>Document:<ul> <li>Which application displayed the most number of new content alerts on the task bar.</li> <li>Note browser profiles like <code>Chrome.UserData.Profile1</code> , this will be useful during Browser forensics.</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - FeatureUsage AppBadgeUpdated](img/app_execution/09_featureusage_appbadgeupdated.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#6b-applaunch","title":"6B \u2014 AppLaunch","text":"<p>Tracks: taskbar-pinned application launches</p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_7","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppLaunch</code> subkey in Registry Explorer.</li> <li>Applications listed in this key were pinned to the taskbar. Document:<ul> <li>interesting pinned apps</li> <li>identify suspicious tools pinned to taskbar</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - FeatureUsage AppLaunch](img/app_execution/10_featureusage_applaunch.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#6c-appswitched","title":"6C \u2014 AppSwitched","text":"<p>Tracks: application focus switching (in-focus activity)</p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_8","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppSwitched</code> subkey in Registry Explorer.</li> <li>This subkey indicates application execution and how often applications were switched to the active window (\"in focus\").</li> <li>There are typically many more entries in this key than AppLaunch since applications do not need to be pinned to the task bar to be tracked.</li> <li>Document:<ul> <li>The top applications switched in focus</li> <li>Suspicious items</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - FeatureUsage AppSwitched](img/app_execution/11_featureusage_appswitched.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#6d-showjumpview","title":"6D \u2014 ShowJumpView","text":"<p>Tracks: number of right-clicks on running application icons to show Jump Lists</p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_9","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\ShowJumpView</code> subkey in Registry Explorer.</li> <li>Document:<ul> <li>Which Jump List was requested by the user the most number of times.</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - FeatureUsage ShowJumpView](img/app_execution/12_featureusage_showjumpview.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#6e-traybuttonclicked","title":"6E \u2014 TrayButtonClicked","text":"<p>Tracks: the number clicks to many of the built-in tray applications (clock/search/network/etc.)</p>"},{"location":"1.Windows/Application_Execution_Analysis/#procedure_10","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\TrayButtonClicked</code> subkey in Registry Explorer.</li> <li>Document:<ul> <li>Interesting tray interaction patterns.</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - FeatureUsage TrayButtonClicked](img/app_execution/13_featureusage_tray.png)\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#scaling-evidence-collection-recmdexe","title":"Scaling Evidence Collection \u2013 RECmd.exe","text":""},{"location":"1.Windows/Application_Execution_Analysis/#recommended-approach","title":"Recommended Approach","text":"<p>Use RECmd to scale extraction across many systems and profiles.</p>"},{"location":"1.Windows/Application_Execution_Analysis/#example-recmd-run-user-hives","title":"Example RECmd Run (User Hives)","text":"<pre><code>RECmd.exe -f \"E:\\C\\Users\\user1\\NTUSER.DAT\" --bn .\\Batch\\UserActivity.reb --csv \"G:\\Evidence\\Registry\"\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#example-recmd-run-system-hive","title":"Example RECmd Run (SYSTEM Hive)","text":"<pre><code>RECmd.exe -f \"E:\\C\\Windows\\System32\\config\\SYSTEM\" --csv \"G:\\Evidence\\Registry\" --csvf SYSTEM_Execution.csv\n</code></pre>"},{"location":"1.Windows/Application_Execution_Analysis/#what-to-focus-on-timeline-explorer","title":"What to Focus On (Timeline Explorer)","text":"<ul> <li>Description</li> <li>Key Path</li> <li>Value Data</li> <li>LastWrite timestamps</li> </ul>"},{"location":"1.Windows/Application_Execution_Analysis/#evidence-to-document","title":"Evidence to Document","text":""},{"location":"1.Windows/Application_Execution_Analysis/#execution-profile-summary","title":"Execution Profile Summary","text":"<ul> <li>BAM executions around incident timeframe</li> <li>UserAssist executions + Focus Count insights</li> <li>Prefetch executions (Win Prefetch View + PECmd)</li> <li>File References linked to suspicious programs</li> <li>FeatureUsage: pinned apps, focus switching, Jump List interaction</li> <li>Any suspicious paths:<ul> <li><code>Temp</code>, <code>Downloads</code>, <code>AppData</code></li> <li>UNC paths</li> <li>external drives</li> </ul> </li> </ul>"},{"location":"1.Windows/Application_Execution_Analysis/#analyst-notes-pitfalls","title":"Analyst Notes / Pitfalls","text":"<ul> <li>UserAssist is GUI-focused; Prefetch captures both GUI + command-line (when enabled)</li> <li>Prefetch can be disabled in some environments or limited on servers</li> <li>BAM often provides clean \u201clast execution\u201d evidence but not full execution history</li> <li>Always correlate execution artifacts with:<ul> <li>Security log 4688 (process creation, if enabled)</li> <li>Sysmon Event ID 1 (if deployed)</li> <li>Amcache/SRUM</li> <li>Shimcache</li> <li>Jump Lists</li> </ul> </li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/","title":"AutoStart Persistence Locations (Windows)","text":"<p>This section provides a DFIR-focused overview of common Windows AutoStart persistence locations.</p> <p>AutoStart locations (also called autoruns) allow software \u2014 including malware \u2014 to execute automatically during:</p> <ul> <li>user logon</li> <li>system startup</li> <li>Winlogon initialization</li> </ul> <p>These artifacts are critical for:</p> <ul> <li>confirming persistence mechanisms</li> <li>hunting for suspicious binaries/scripts</li> <li>understanding how an attacker maintains access</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#table-of-contents","title":"Table of Contents","text":"<ol> <li>HKCU Run</li> <li>HKCU RunOnce</li> <li>HKLM RunOnce</li> <li>HKLM Policies Explorer Run</li> <li>HKLM Run</li> <li>Winlogon Userinit</li> <li>Startup Folder (Per-User)</li> <li>Correlation &amp; Analyst Tips</li> <li>Evasion Techniques</li> <li>Tooling Summary</li> </ol>"},{"location":"1.Windows/AutoStart_Persistence/#hkcu-run","title":"HKCU Run","text":""},{"location":"1.Windows/AutoStart_Persistence/#registry-entry","title":"Registry Entry","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#what-is-hkcu-run","title":"What is HKCU Run?","text":"<p>The HKCU Run key starts listed programs automatically when the user logs on. The key is stored in the user\u2019s <code>NTUSER.DAT</code> hive and applies only to that specific user.</p> <p>Attackers frequently use this location because:</p> <ul> <li>it does not require admin rights</li> <li>it triggers reliably at logon</li> <li>it blends in with legitimate software</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#location","title":"Location","text":"<p>Offline forensics:</p> <ul> <li>Hive: <code>C:\\Users\\&lt;User&gt;\\NTUSER.DAT</code></li> <li>Key Path: <code>Software\\Microsoft\\Windows\\CurrentVersion\\Run</code></li> </ul> <p>Live system:</p> <ul> <li><code>HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#forensic-value","title":"Forensic Value","text":"<p>This key helps answer:</p> <ul> <li>What programs execute at logon for this user?</li> <li>Did malware set persistence without admin rights?</li> <li>Are there suspicious commands, scripts, or LOLbins used for persistence?</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#key-data-points","title":"Key Data Points","text":"<ul> <li>Value Name (often masquerades as legitimate software)</li> <li>Command line / executable path</li> <li>Arguments (e.g., encoded PowerShell)</li> <li>Binary location (user-writable vs system path)</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#example-output-registry-explorer","title":"Example Output (Registry Explorer)","text":"<pre><code>Key: ...\\CurrentVersion\\Run\n\nValue Name: OneDrive\nData: \"C:\\Program Files\\Microsoft OneDrive\\OneDrive.exe\" /background\n\nValue Name: Windows Update Service\nData: powershell.exe -WindowStyle Hidden -enc SQBFAFgA...\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#tools-for-parsing-this-autostart-location","title":"Tools for parsing this autostart location","text":"<p>Registry Explorer (GUI):</p> <ul> <li>Load <code>NTUSER.DAT</code></li> <li>Navigate to the Run key</li> </ul> <p>RECmd (CLI):</p> <pre><code>RECmd.exe -f NTUSER.DAT --kn \"Software\\Microsoft\\Windows\\CurrentVersion\\Run\" --csv autoruns.csv\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#hkcu-runonce","title":"HKCU RunOnce","text":""},{"location":"1.Windows/AutoStart_Persistence/#registry-entry_1","title":"Registry Entry","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#what-is-hkcu-runonce","title":"What is HKCU RunOnce?","text":"<p>RunOnce entries execute automatically at the next user logon, then are removed after execution.</p> <p>This location is often abused for:</p> <ul> <li>one-time payload execution</li> <li>staging secondary persistence elsewhere</li> <li>running cleanup tools</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#location_1","title":"Location","text":"<p>Offline:</p> <ul> <li><code>NTUSER.DAT</code> \u2192 <code>Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce</code></li> </ul> <p>Live:</p> <ul> <li><code>HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#forensic-value_1","title":"Forensic Value","text":"<ul> <li>Indicates one-time execution intent</li> <li>Useful for identifying transient attacker activity</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#key-data-points_1","title":"Key Data Points","text":"<ul> <li>Value name</li> <li>Command line</li> <li>Whether the entry was removed (requires hive analysis / timeline)</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#example-output-registry-explorer_1","title":"Example Output (Registry Explorer)","text":"<pre><code>Value Name: AdobeUpdate\nData: \"C:\\Users\\Public\\adobe_update.exe\" /silent\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#tools-for-parsing-this-autostart-location_1","title":"Tools for parsing this autostart location","text":"<pre><code>RECmd.exe -f NTUSER.DAT --kn \"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\" --csv autoruns.csv\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#hklm-runonce","title":"HKLM RunOnce","text":""},{"location":"1.Windows/AutoStart_Persistence/#registry-entry_2","title":"Registry Entry","text":"<pre><code>SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#what-is-hklm-runonce","title":"What is HKLM RunOnce?","text":"<p>The HKLM RunOnce key triggers one-time execution at startup or logon, depending on the entry.</p> <p>Unlike HKCU RunOnce, it applies to:</p> <ul> <li>all users</li> <li>system-wide execution</li> </ul> <p>This typically requires admin rights to set.</p>"},{"location":"1.Windows/AutoStart_Persistence/#location_2","title":"Location","text":"<p>Offline:</p> <ul> <li>Hive: <code>C:\\Windows\\System32\\config\\SOFTWARE</code></li> <li>Key path: <code>Microsoft\\Windows\\CurrentVersion\\RunOnce</code></li> </ul> <p>Live:</p> <ul> <li><code>HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#forensic-value_2","title":"Forensic Value","text":"<ul> <li>System-wide one-time persistence</li> <li>Useful for tracking admin-level attacker persistence</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#key-data-points_2","title":"Key Data Points","text":"<ul> <li>Value name</li> <li>Command line</li> <li>Whether entry is deleted post-run</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#example-output-registry-explorer_2","title":"Example Output (Registry Explorer)","text":"<pre><code>Value Name: DriverUpdate\nData: \"C:\\Windows\\Temp\\drvupdate.exe\"\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#tools-for-parsing-this-autostart-location_2","title":"Tools for parsing this autostart location","text":"<pre><code>RECmd.exe -f SOFTWARE --kn \"Microsoft\\Windows\\CurrentVersion\\RunOnce\" --csv autoruns.csv\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#hklm-policies-explorer-run","title":"HKLM Policies Explorer Run","text":""},{"location":"1.Windows/AutoStart_Persistence/#registry-entry_3","title":"Registry Entry","text":"<pre><code>SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\Explorer\\Run\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#what-is-hklm-policies-explorer-run","title":"What is HKLM Policies Explorer Run?","text":"<p>This key is commonly used for:</p> <ul> <li>enterprise administration</li> <li>group policy-driven logon actions</li> </ul> <p>Because it appears \u201cofficial,\u201d it is sometimes abused for stealth persistence.</p>"},{"location":"1.Windows/AutoStart_Persistence/#location_3","title":"Location","text":"<p>Offline:</p> <ul> <li>Hive: <code>SOFTWARE</code></li> <li>Path: <code>Microsoft\\Windows\\CurrentVersion\\policies\\Explorer\\Run</code></li> </ul> <p>Live:</p> <ul> <li><code>HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#forensic-value_3","title":"Forensic Value","text":"<ul> <li>May indicate policy-based persistence</li> <li>Suspicious if environment is not domain-managed</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#key-data-points_3","title":"Key Data Points","text":"<ul> <li>Value names</li> <li>Commands</li> <li>Script invocation</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#example-output-registry-explorer_3","title":"Example Output (Registry Explorer)","text":"<pre><code>Value Name: LogonScript\nData: cmd.exe /c \"C:\\ProgramData\\svc.bat\"\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#tools-for-parsing-this-autostart-location_3","title":"Tools for parsing this autostart location","text":"<pre><code>RECmd.exe -f SOFTWARE --kn \"Microsoft\\Windows\\CurrentVersion\\policies\\Explorer\\Run\" --csv autoruns.csv\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#hklm-run","title":"HKLM Run","text":""},{"location":"1.Windows/AutoStart_Persistence/#registry-entry_4","title":"Registry Entry","text":"<pre><code>SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#what-is-hklm-run","title":"What is HKLM Run?","text":"<p>The HKLM Run key launches programs at logon for all users.</p> <p>Commonly used by:</p> <ul> <li>legitimate software (AV, sync tools)</li> <li>attackers with admin rights to establish persistence</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#location_4","title":"Location","text":"<p>Offline:</p> <ul> <li>Hive: SOFTWARE</li> <li>Path: <code>Microsoft\\Windows\\CurrentVersion\\Run</code></li> </ul> <p>Live:</p> <ul> <li><code>HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#forensic-value_4","title":"Forensic Value","text":"<ul> <li>High-confidence persistence location</li> <li>Helps identify system-wide attacker footholds</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#key-data-points_4","title":"Key Data Points","text":"<ul> <li>Executable/script path</li> <li>Arguments</li> <li>Unusual directories (Temp, AppData, Public)</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#example-output-registry-explorer_4","title":"Example Output (Registry Explorer)","text":"<pre><code>Value Name: SecurityHealth\nData: \"C:\\Windows\\System32\\SecurityHealthSystray.exe\"\n\nValue Name: Windows Audio Driver\nData: \"C:\\Users\\Public\\audiodrv.exe\" --silent\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#tools-for-parsing-this-autostart-location_4","title":"Tools for parsing this autostart location","text":"<pre><code>RECmd.exe -f SOFTWARE --kn \"Microsoft\\Windows\\CurrentVersion\\Run\" --csv autoruns.csv\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#winlogon-userinit","title":"Winlogon Userinit","text":""},{"location":"1.Windows/AutoStart_Persistence/#registry-entry_5","title":"Registry Entry","text":"<pre><code>SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#what-is-winlogon-userinit","title":"What is Winlogon Userinit?","text":"<p>The <code>Userinit</code> value controls which program runs immediately after a successful logon.</p> <p>Default value:</p> <pre><code>C:\\Windows\\System32\\userinit.exe,\n</code></pre> <p>Attackers may append an additional executable/script.</p>"},{"location":"1.Windows/AutoStart_Persistence/#location_5","title":"Location","text":"<p>Offline:</p> <ul> <li>Hive: SOFTWARE</li> <li>Key: <code>Microsoft\\Windows NT\\CurrentVersion\\Winlogon</code></li> <li>Value: <code>Userinit</code></li> </ul> <p>Live:</p> <ul> <li><code>HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#forensic-value_5","title":"Forensic Value","text":"<ul> <li>Extremely high-value persistence location</li> <li>Often indicates sophisticated attacker persistence</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#key-data-points_5","title":"Key Data Points","text":"<ul> <li>Presence of extra entries appended after <code>userinit.exe</code></li> <li>Non-standard paths</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#example-output-registry-explorer_5","title":"Example Output (Registry Explorer)","text":"<pre><code>Value Name: Userinit\nData: C:\\Windows\\System32\\userinit.exe,C:\\Users\\Public\\svchost.exe\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#tools-for-parsing-this-autostart-location_5","title":"Tools for parsing this autostart location","text":"<pre><code>RECmd.exe -f SOFTWARE --kn \"Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" --csv autoruns.csv\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#startup-folder-per-user","title":"Startup Folder (Per-User)","text":""},{"location":"1.Windows/AutoStart_Persistence/#file-location","title":"File Location","text":"<pre><code>%AppData%\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#what-is-the-startup-folder","title":"What is the Startup Folder?","text":"<p>Files placed in the Startup folder automatically execute when the user logs in.</p> <p>This is a popular attacker choice because:</p> <ul> <li>does not require admin rights</li> <li>supports <code>.lnk</code>, <code>.bat</code>, <code>.vbs</code>, <code>.ps1</code>, EXEs</li> <li>blends in with legitimate shortcuts</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#location_6","title":"Location","text":"<p>Typical path:</p> <pre><code>C:\\Users\\&lt;User&gt;\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#forensic-value_6","title":"Forensic Value","text":"<ul> <li>Strong evidence of user-level persistence</li> <li>Useful for detecting dropped scripts and shortcut-based persistence</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#key-data-points_6","title":"Key Data Points","text":"<ul> <li>File name</li> <li>Target path (for <code>.lnk</code>)</li> <li>Creation/modification timestamps</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#example-output-directory-listing","title":"Example Output (Directory Listing)","text":"<pre><code>2024-11-18  13:40    2,048   OneDrive.lnk\n2024-11-18  13:41    1,200   updater.vbs\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#tools-for-parsing-this-autostart-location_6","title":"Tools for parsing this autostart location","text":"<ul> <li>KAPE collection (Startup folders)</li> <li>LECmd.exe for parsing <code>.lnk</code> files</li> </ul> <p>Example LECmd:</p> <pre><code>LECmd.exe -d \"C:\\Users\\&lt;User&gt;\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\" --csv startup_links.csv\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#correlation-analyst-tips","title":"Correlation &amp; Analyst Tips","text":""},{"location":"1.Windows/AutoStart_Persistence/#common-suspicion-indicators","title":"Common Suspicion Indicators","text":"<ul> <li> <p>Executables launched from:</p> </li> <li> <p><code>C:\\Users\\Public</code></p> </li> <li><code>%AppData%</code></li> <li><code>%Temp%</code></li> <li><code>C:\\ProgramData</code></li> <li> <p>Suspicious command lines:</p> </li> <li> <p><code>powershell.exe -enc</code></p> </li> <li><code>cmd.exe /c</code></li> <li><code>mshta.exe</code></li> <li><code>rundll32.exe</code></li> <li>Value names designed to blend in (e.g., <code>Windows Update Service</code>)</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#recommended-correlation-artifacts","title":"Recommended Correlation Artifacts","text":"<ul> <li>Prefetch</li> <li>Amcache</li> <li>ShimCache</li> <li>BAM/DAM</li> <li>SRUM</li> <li>Windows Event Logs (4688, 4697, 7045)</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#evasion-techniques","title":"Evasion Techniques","text":"<p>Attackers may evade AutoStart discovery by:</p> <ul> <li>using benign-sounding value names</li> <li>deleting keys after execution (RunOnce)</li> <li>storing payloads in obscure directories</li> <li>using fileless persistence (WMI, scheduled tasks)</li> <li>replacing hives / timestomping</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#kape-targets-modules-autostart-collection","title":"KAPE Targets &amp; Modules (AutoStart Collection)","text":"<p>KAPE collects files relevant to persistence. For these AutoStart locations, the primary items to collect are:</p> <ul> <li><code>NTUSER.DAT</code> (per user)</li> <li>Startup folder contents (per user)</li> <li>Optional: <code>UsrClass.dat</code> (useful for shell artifacts / Jump Lists correlation)</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#collection-targets","title":"Collection Targets","text":"Evidence Needed What to Collect Typical Paths HKCU Run / RunOnce keys <code>NTUSER.DAT</code> <code>C:\\Users\\&lt;User&gt;\\NTUSER.DAT</code> Startup Folder persistence Startup folder <code>C:\\Users\\&lt;User&gt;\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup</code> LNK parsing context <code>.lnk</code> files Startup folder + other locations"},{"location":"1.Windows/AutoStart_Persistence/#example-kape-targets","title":"Example KAPE Targets","text":"<p>Depending on the version of KAPETargets in your environment, the target names vary. Common targets include:</p> <ul> <li><code>NTUSER</code> / <code>UserHives</code></li> <li><code>StartupFolders</code></li> <li><code>LNKFiles</code></li> </ul> <p>Example collection:</p> <pre><code>kape.exe --tsource C: --tdest E:\\KAPE --target NTUSER,StartupFolders\n</code></pre> <p>If you want to collect and immediately parse <code>.lnk</code> files:</p> <pre><code>kape.exe --tsource C: --tdest E:\\KAPE --target NTUSER,StartupFolders --module LECmd\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#parsing-modules","title":"Parsing Modules","text":"Artifact Parser Typical Module NTUSER autoruns RECmd <code>RECmd.mkape</code> Startup <code>.lnk</code> LECmd <code>LECmd.mkape</code> <p>Example:</p> <pre><code>kape.exe --tsource C: --tdest E:\\KAPE --target NTUSER,StartupFolders --module RECmd,LECmd\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#mitre-attck-mapping-persistence","title":"MITRE ATT&amp;CK Mapping (Persistence)","text":"<p>These AutoStart locations map directly to MITRE ATT&amp;CK persistence mechanisms.</p>"},{"location":"1.Windows/AutoStart_Persistence/#persistence","title":"Persistence","text":"<ul> <li> <p>T1547.001 \u2013 Registry Run Keys / Startup Folder</p> </li> <li> <p>Covers:</p> <ul> <li><code>HKCU\\...\\Run</code></li> <li><code>HKCU\\...\\RunOnce</code></li> <li><code>HKLM\\...\\Run</code></li> <li><code>HKLM\\...\\RunOnce</code></li> <li>Startup folder</li> </ul> </li> <li> <p>T1547.004 \u2013 Winlogon Helper DLL / Winlogon Userinit</p> </li> <li> <p>Covers:</p> <ul> <li><code>Winlogon\\Userinit</code></li> </ul> </li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#defense-evasion-related","title":"Defense Evasion (Related)","text":"<ul> <li> <p>T1036 \u2013 Masquerading</p> </li> <li> <p>Value names designed to look legitimate</p> </li> <li> <p>T1070 \u2013 Indicator Removal on Host</p> </li> <li> <p>Deleting Run/RunOnce values</p> </li> <li>Removing startup folder payloads</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#recmd-batch-template-reb-autoruns-in-one-pass","title":"RECmd Batch Template (.reb) \u2014 Autoruns in One Pass","text":"<p>Below is a cohesive RECmd batch file you can save as:</p> <ul> <li><code>Autoruns_AutoStart_Persistence.reb</code></li> </ul> <p>It extracts all autorun-related keys referenced in this document.</p> <pre><code>Description: AutoStart Persistence (Registry Run Keys)\nAuthor: DFIR Team\nVersion: 1\nId: 8b0c0e7e-3c8e-4d62-a1cf-000000000010\nKeys:\n  # -----------------------------\n  # NTUSER.DAT (HKCU)\n  # -----------------------------\n\n  - Description: HKCU Run\n    HiveType: NTUSER\n    Category: Persistence\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Run\n    Recursive: false\n\n  - Description: HKCU RunOnce\n    HiveType: NTUSER\n    Category: Persistence\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n    Recursive: false\n\n  # -----------------------------\n  # SOFTWARE (HKLM)\n  # -----------------------------\n\n  - Description: HKLM Run\n    HiveType: SOFTWARE\n    Category: Persistence\n    KeyPath: Microsoft\\Windows\\CurrentVersion\\Run\n    Recursive: false\n\n  - Description: HKLM RunOnce\n    HiveType: SOFTWARE\n    Category: Persistence\n    KeyPath: Microsoft\\Windows\\CurrentVersion\\RunOnce\n    Recursive: false\n\n  - Description: HKLM Policies Explorer Run\n    HiveType: SOFTWARE\n    Category: Persistence\n    KeyPath: Microsoft\\Windows\\CurrentVersion\\policies\\Explorer\\Run\n    Recursive: false\n\n  - Description: Winlogon (Userinit)\n    HiveType: SOFTWARE\n    Category: Persistence\n    KeyPath: Microsoft\\Windows NT\\CurrentVersion\\Winlogon\n    Recursive: false\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#recmd-usage-examples","title":"RECmd Usage Examples","text":"<p>Parse individual hives:</p> <pre><code>RECmd.exe -f NTUSER.DAT --bn Autoruns_AutoStart_Persistence.reb --csv E:\\out\nRECmd.exe -f SOFTWARE --bn Autoruns_AutoStart_Persistence.reb --csv E:\\out\n</code></pre> <p>Parse a directory (typical after KAPE acquisition):</p> <pre><code>RECmd.exe -d E:\\KAPE\\Files --bn Autoruns_AutoStart_Persistence.reb --csv E:\\out\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#recmd-pivot-batch-reb-high-recall-autoruns","title":"RECmd Pivot Batch (.reb) \u2014 High Recall Autoruns","text":"<p>When you have an indicator (filename, directory, LOLbin) but you\u2019re not sure which persistence key it lives under, use a high-recall pivot batch, then keyword search the output.</p> <p>Save the following as:</p> <ul> <li><code>Autoruns_Pivot.reb</code></li> </ul> <pre><code>Description: Autoruns Pivot (High Recall)\nAuthor: DFIR Team\nVersion: 1\nId: 8b0c0e7e-3c8e-4d62-a1cf-000000000011\nKeys:\n  # -----------------------------\n  # NTUSER.DAT (HKCU)\n  # -----------------------------\n\n  - Description: HKCU CurrentVersion (broad)\n    HiveType: NTUSER\n    Category: Persistence\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\n    Recursive: true\n\n  # -----------------------------\n  # SOFTWARE (HKLM)\n  # -----------------------------\n\n  - Description: HKLM CurrentVersion (broad)\n    HiveType: SOFTWARE\n    Category: Persistence\n    KeyPath: Microsoft\\Windows\\CurrentVersion\n    Recursive: true\n\n  - Description: HKLM Winlogon (broad)\n    HiveType: SOFTWARE\n    Category: Persistence\n    KeyPath: Microsoft\\Windows NT\\CurrentVersion\\Winlogon\n    Recursive: true\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#run-the-pivot-batch","title":"Run the Pivot Batch","text":"<pre><code>RECmd.exe -f NTUSER.DAT --bn Autoruns_Pivot.reb --csv E:\\pivot_out\nRECmd.exe -f SOFTWARE --bn Autoruns_Pivot.reb --csv E:\\pivot_out\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#keyword-search-examples","title":"Keyword Search Examples","text":""},{"location":"1.Windows/AutoStart_Persistence/#windows-findstr","title":"Windows <code>findstr</code>","text":"<pre><code>findstr /S /I \"powershell.exe rundll32.exe mshta.exe C:\\Users\\Public\" E:\\pivot_out\\*.csv\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#powershell-select-string","title":"PowerShell <code>Select-String</code>","text":"<pre><code>Get-ChildItem E:\\pivot_out\\*.csv | Select-String -Pattern \"powershell.exe\",\"rundll32.exe\",\"mshta.exe\",\"C:\\Users\\Public\" -CaseSensitive:$false\n</code></pre>"},{"location":"1.Windows/AutoStart_Persistence/#notes","title":"Notes","text":"<ul> <li>This pivot batch is intentionally broad and may generate large output.</li> <li>Use it for hunting and triage, then confirm findings with the precise batch (<code>Autoruns_AutoStart_Persistence.reb</code>) and additional execution artifacts.</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#recommended-indicator-list-autoruns-hunting","title":"Recommended Indicator List (Autoruns Hunting)","text":"<p>Use the following indicator list to quickly pivot through autorun output (CSV/JSON). These are common attacker tradecraft patterns.</p>"},{"location":"1.Windows/AutoStart_Persistence/#high-signal-lolbins-living-off-the-land","title":"High-Signal LOLBins / Living-off-the-Land","text":"<p>Search for these executables in autorun values:</p> <ul> <li><code>powershell.exe</code></li> <li><code>pwsh.exe</code></li> <li><code>cmd.exe</code></li> <li><code>wscript.exe</code> / <code>cscript.exe</code></li> <li><code>mshta.exe</code></li> <li><code>rundll32.exe</code></li> <li><code>regsvr32.exe</code></li> <li><code>schtasks.exe</code></li> <li><code>wmic.exe</code></li> <li><code>bitsadmin.exe</code></li> <li><code>certutil.exe</code></li> <li><code>installutil.exe</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#suspicious-command-line-patterns","title":"Suspicious Command Line Patterns","text":"<ul> <li><code>-enc</code> / <code>-encodedcommand</code></li> <li><code>IEX</code> / <code>Invoke-Expression</code></li> <li><code>FromBase64String</code></li> <li><code>DownloadString</code></li> <li><code>WebClient</code></li> <li><code>Start-Process</code></li> <li><code>Hidden</code> / <code>WindowStyle Hidden</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#common-staging-user-writable-paths","title":"Common Staging / User-Writable Paths","text":"<ul> <li><code>C:\\Users\\Public</code></li> <li><code>%AppData%</code> / <code>\\AppData\\Roaming</code></li> <li><code>%LocalAppData%</code> / <code>\\AppData\\Local</code></li> <li><code>%Temp%</code> / <code>\\AppData\\Local\\Temp</code></li> <li><code>C:\\ProgramData</code></li> <li><code>C:\\Windows\\Temp</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#common-masquerading-filenames","title":"Common Masquerading Filenames","text":"<ul> <li><code>svchost.exe</code></li> <li><code>lsass.exe</code></li> <li><code>explorer.exe</code></li> <li><code>taskhostw.exe</code></li> <li><code>services.exe</code></li> <li><code>spoolsv.exe</code></li> </ul> <p>These names are suspicious when found outside <code>C:\\Windows\\System32</code>.</p>"},{"location":"1.Windows/AutoStart_Persistence/#quick-pivot-strings","title":"Quick Pivot Strings","text":"<p>Use these directly in <code>findstr</code> / <code>Select-String</code>:</p> <ul> <li><code>powershell.exe -enc</code></li> <li><code>rundll32.exe</code></li> <li><code>mshta.exe</code></li> <li><code>wscript.exe</code></li> <li><code>c:\\users\\public</code></li> <li><code>\\appdata\\roaming</code></li> <li><code>\\appdata\\local\\temp</code></li> <li><code>c:\\programdata</code></li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#tooling-summary","title":"Tooling Summary","text":"<p>Recommended tools for AutoStart persistence analysis:</p> <ul> <li>Sysinternals Autoruns (excellent triage)</li> <li>Eric Zimmerman Registry Explorer (manual review)</li> <li>RECmd.exe (batch parsing of hives)</li> <li>KAPE (collection + processing)</li> <li>LECmd.exe (Startup folder <code>.lnk</code> parsing)</li> </ul>"},{"location":"1.Windows/AutoStart_Persistence/#references","title":"References","text":"<ul> <li>Sysinternals Autoruns</li> <li>Eric Zimmerman Tools</li> <li>MITRE ATT&amp;CK Persistence Techniques</li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/","title":"Cloud Storage Forensics \u2013 OneDrive (DFIR)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#overview","title":"Overview","text":"<p>OneDrive (Personal and Business) is a common avenue for: - data staging and exfiltration - unauthorized access via shared links - cloud-only file persistence - sync-based data compromise (SharePoint / Teams libraries)</p> <p>This MKDoc outlines a structured DFIR workflow for investigating OneDrive on Windows endpoints using:</p> <ul> <li>Registry Explorer (account configuration + sync metadata)</li> <li>OneDrive Explorer (OneDrive sync databases)</li> <li>ShadowExplorer (Volume Shadow Copy historical folder states)</li> <li>Timeline Explorer (CSV &amp; UAL investigation at scale)</li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#primary-evidence-locations","title":"Primary Evidence Locations","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#registry-hive","title":"Registry Hive","text":"<ul> <li><code>C:\\Users\\{user}\\NTUSER.DAT</code></li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#onedrive-sync-databases-endpoint","title":"OneDrive Sync Databases (Endpoint)","text":"<ul> <li>Personal:</li> <li><code>C:\\Users\\{user}\\AppData\\Local\\Microsoft\\OneDrive\\settings\\Personal\\&lt;UserCid&gt;.dat</code></li> <li>Business:</li> <li><code>C:\\Users\\{user}\\AppData\\Local\\Microsoft\\OneDrive\\settings\\Business1\\&lt;TenantGuid&gt;.dat</code></li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#onedrive-sync-folder","title":"OneDrive Sync Folder","text":"<ul> <li>Personal:</li> <li><code>C:\\Users\\{user}\\OneDrive\\</code></li> <li>Business:</li> <li><code>C:\\Users\\{user}\\OneDrive - &lt;OrgName&gt;\\</code></li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#recycle-bin-evidence","title":"Recycle Bin Evidence","text":"<ul> <li><code>C:\\$Recycle.Bin\\&lt;SID-RID&gt;\\</code></li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#cloud-logs-org-provided","title":"Cloud Logs (Org Provided)","text":"<ul> <li>Microsoft Unified Audit Logs (UAL) exported to CSV</li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#tools-used","title":"Tools Used","text":"<ul> <li>Registry Explorer (Eric Zimmerman)</li> <li>OneDrive Explorer (Eric Zimmerman)</li> <li>ShadowExplorer</li> <li>Timeline Explorer (Eric Zimmerman)</li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#workflow-registry-explorer-ntuserdat","title":"Workflow \u2013 Registry Explorer (NTUSER.DAT)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-1-load-ntuserdat_clean-in-registry-explorer","title":"Step 1 \u2014 Load NTUSER.DAT_clean in Registry Explorer","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure","title":"Procedure","text":"<ol> <li>Launch Registry Explorer</li> <li>Select File \u2192 Load Hive</li> <li>Select <code>NTUSER.DAT_clean</code></li> <li>Click Open</li> <li>Confirm hive appears in left navigation</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Load NTUSER.DAT_clean](img/onedrive_forensics/01_load_ntuser.png)\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-2-investigate-onedrive-accounts-key","title":"Step 2 \u2014 Investigate OneDrive Accounts Key","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#registry-path","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\OneDrive\\Accounts\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure_1","title":"Procedure","text":"<ol> <li>In Registry Explorer navigate to the Accounts Key:<ul> <li><code>NTUSER.DAT\\Software\\Microsoft\\OneDrive\\Accounts</code></li> </ul> </li> <li>Document what accounts have data present.</li> <li>For each account present, document<ul> <li><code>UserEmail</code></li> <li><code>UserFolder</code></li> <li><code>cid</code></li> <li><code>SPOResourceID</code> (if present)</li> </ul> </li> <li>If there is a OneDrive for Business account present on the system, it may be synchronizing multiple shared folders from Sharepoint / Teams (Microsoft calls these \"Tenants\").</li> <li>In Registry Explorer navigate to the subkey of the Accounts Key:<ul> <li><code>NTUSER.DAT\\Software\\Microsoft\\OneDrive\\Accounts\\Business1\\Tenants</code></li> </ul> </li> <li>Document any interesting Share Folders present, this is could be useful information in assessing potential data compromise locations for the damage assessment.</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - OneDrive Accounts key](img/onedrive_forensics/02_onedrive_accounts.png)\n</code></pre> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - OneDrive Business Tenants](img/onedrive_forensics/03_business_tenants.png)\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#workflow-onedrive-explorer-personal","title":"Workflow \u2013 OneDrive Explorer (Personal)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-3-prepare-onedrive-personal-in-onedrive-explorer","title":"Step 3 \u2014 Prepare OneDrive Personal in OneDrive Explorer","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#analyst-prep-interview-the-network-owner","title":"Analyst Prep: Interview the Network Owner","text":"<p>Before searching, obtain: - names of sensitive projects - critical file names / keywords - suspected exfil targets - timeframe of concern</p>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure_2","title":"Procedure","text":"<ol> <li>Open OneDrive Explorer</li> <li>Select: Options \u2192 Preferences</li> <li>Enable automatic CSV export for high efficiency:<ul> <li>Select Auto Save to CSV</li> <li>Auto Save Path: <code>F:\\Evidence\\CloudStorage</code> ((or whatever working evidence directory you are using)</li> <li>Click Save</li> </ul> </li> <li>Load OneDrive Personal database:<ul> <li>File \u2192 OneDrive settings \u2192 Load .dat <li>Example file:</li> <li><code>E:\\C\\Users\\user1\\AppData\\Local\\Microsoft\\OneDrive\\settings\\Personal\\a322388cbcb18cb.dat</code></li> <li>When asked for registry hive \u2192 Yes<ul> <li>Browse to: <code>E:\\C\\Users\\user1\\NTUSER.DAT</code></li> </ul> </li> <li>When asked for $Recycle.Bin \u2192 Yes<ul> <li>Browse to: <code>E:\\C\\$Recycle.Bin\\S-1-5-21-...-1002</code> (actual $Recycle.Bin will be different depending on the RID you are focused on)</li> <li>Use the RID you identified to load the correct one. Triage images are particularly useful for this step as access to these folders in mounted disk images often have difficulties due to Windows auto-redirection of Recycle Bin folders.</li> </ul> </li> <li>After load completes, the root of the OneDrive folder hierarchy should appear in the Path pane. Click into the Path pane and begin expanding the folder hierarchy. Spend a few minutes looking through the folders and files to become familiar with the information available.</li> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![OneDrive Explorer - Load Personal database](img/onedrive_forensics/04_onedriveexplorer_personal_load.png)\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-4-investigate-deleted-files-onedrive-recycle-bin","title":"Step 4 \u2014 Investigate Deleted Files (OneDrive Recycle Bin)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#goal","title":"Goal","text":"<p>Identify deleted OneDrive items relevant to incident scope.</p>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure_3","title":"Procedure","text":"<ol> <li>Locate the Deleted Files folder in OneDrive Explorer</li> <li>Identify files of interest (keyword search first) and document:<ul> <li>filename</li> <li>prior OneDrive path</li> <li>deleted time (if present)</li> </ul> </li> <li>Use the Find bar for sensitive keywords</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![OneDrive Explorer - Deleted Files](img/onedrive_forensics/05_deleted_files.png)\n</code></pre> <p>DFIR Tip: Deleted items often signal covering tracks or cleanup after staging.</p>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#workflow-shadowexplorer-volume-shadow-copies","title":"Workflow \u2013 ShadowExplorer (Volume Shadow Copies)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-5-review-prior-onedrive-states-via-volume-shadow-copies","title":"Step 5 \u2014 Review Prior OneDrive States via Volume Shadow Copies","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#goal_1","title":"Goal","text":"<p>Identify differences between: - current OneDrive folder state - prior shadow-copy snapshots</p> <p>This can reveal: - files that used to exist but were deleted - folder structures that changed over time - earlier versions of sensitive data</p>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure_4","title":"Procedure","text":"<ol> <li>Open ShadowExplorer</li> <li>Select mounted evidence drive from dropdown (example: <code>F:</code>)</li> <li>If drive letter isn\u2019t visible:<ul> <li>evidence likely mounted incorrectly (must be \u201cWrite temporary\u201d)</li> <li>close/reopen ShadowExplorer after remount</li> </ul> </li> <li>Navigate to:<ul> <li><code>Users\\user1\\OneDrive</code></li> </ul> </li> <li>Review shadow copies from newest \u2192 oldest</li> <li>Compare results to OneDrive Explorer findings and document differences</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![ShadowExplorer - OneDrive folder in VSS](img/onedrive_forensics/06_shadowexplorer_onedrive.png)\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#workflow-onedrive-explorer-business1","title":"Workflow \u2013 OneDrive Explorer (Business1)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-6-prepare-onedrive-for-business-if-applicable","title":"Step 6 \u2014 Prepare OneDrive for Business (If Applicable)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#notes","title":"Notes","text":"<p>OneDrive Explorer supports multiple databases loaded simultaneously.</p> <p>Important: Ensure Find/search bar is empty before loading additional DBs.</p>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure_5","title":"Procedure","text":"<ol> <li>Use the OneDrive Explorer menu item File -&gt; OneDrive settings -&gt; Load .dat to browse and open the One Drive for Business database file from your mounted triage image:<ul> <li>Example file:</li> <li><code>E:\\C\\Users\\user1\\AppData\\Local\\Microsoft\\OneDrive\\settings\\Business1\\c2b6b128-5267-5cca-abca-c9cd34be2569.dat</code></li> </ul> <li>When asked to provide a registry hive, select Yes and browse to the user's hive:<ul> <li><code>E:\\C\\Users\\user1\\NTUSER.DAT</code></li> </ul> </li> <li>When asked to provide the path to the user's $Recycle.Bin, select Yes and browse to:<ul> <li><code>E:\\C\\$Recycle.Bin\\S-1-5-21-...-1002</code></li> <li>Use the RID you identified to load the correct one</li> </ul> </li> <li>After a brief load time, the new OneDrive folder hierarchy should appear</li> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![OneDrive Explorer - Load Business1 database](img/onedrive_forensics/07_onedriveexplorer_business_load.png)\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-7-investigate-onedrive-for-business-content","title":"Step 7 \u2014 Investigate OneDrive for Business Content","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure_6","title":"Procedure","text":"<ol> <li>Document any interesting files and their locations (remember to do key word searches for sensitive documents from your Network Owner interview)</li> <li>If you find any interesting files, use Windows File Explorer to visit them in your mounted drive image.</li> <li>If you see a cloud symbol next to them in OneDriveExplorer or an X on the file in Windows File Explorer, that means they are \"cloud-only\", meaning they are only placeholders to them in this folder with no real data stored.</li> <li>For any interesting files, click on properties and note the Created and Modified times for any sensitive files.</li> </ol>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#timestamp-interpretation","title":"Timestamp Interpretation","text":"<p>If Modified is before Created: - file likely copied into OneDrive folder - Created time represents the copy operation</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![OneDrive Explorer - Cloud-only file indicators](img/onedrive_forensics/08_cloud_only_files.png)\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#workflow-timeline-explorer-csv-review","title":"Workflow \u2013 Timeline Explorer (CSV Review)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-8-analyze-onedrive-explorer-csv-output-in-timeline-explorer","title":"Step 8 \u2014 Analyze OneDrive Explorer CSV Output in Timeline Explorer","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#goal_2","title":"Goal","text":"<p>Move from OneDrive Explorer GUI browsing \u2192 high speed bulk analysis using Timeline Explorer.</p>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure_7","title":"Procedure","text":"<ol> <li>While the OneDriveExplorer GUI is useful for navigating early investigations, if you correctly set the Auto Save Preferences earlier in this workflow, you should also have .csv output available for each OneDrive .dat file parsed.</li> <li>Open CSV in Timeline Explorer</li> <li>Reset wide columns:<ul> <li>Tools \u2192 Reset column widths</li> </ul> </li> <li>Perform the same analysis as above concerning:<ul> <li>sensitive keywords</li> <li>file names</li> <li>specific directories</li> <li>delete activity</li> <li>downloads/sync conflicts</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Timeline Explorer - OneDrive CSV analysis](img/onedrive_forensics/09_timeline_explorer_csv.png)\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#exportable-evidence","title":"Exportable Evidence","text":"<p>Timeline Explorer provides:   - filtering   - sorting   - bookmarks   - CSV export for reporting</p>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#workflow-unified-audit-logs-ual","title":"Workflow \u2013 Unified Audit Logs (UAL)","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#step-9-investigate-onedrive-usage-via-unified-audit-logs","title":"Step 9 \u2014 Investigate OneDrive Usage via Unified Audit Logs","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#why-ual","title":"Why UAL?","text":"<p>OneDrive for Business (and most business-oriented cloud storage applications) has a log that administrators can use to track user activity. Called the Unified Audit Log, it is available via the Microsoft administrator portal and is an excellent source of evidence.  Endpoint artifacts only show what synced locally. UAL answers:     - who accessed files in cloud     - downloads/uploads     - anonymous link access     - external IP usage     - sharing behavior</p>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#procedure_8","title":"Procedure","text":"<ol> <li>Obtain UAL CSV export from network owner/admin</li> <li>Open in Timeline Explorer</li> <li>Your columns in Timeline Explorer may be very wide. To shrink everything down to fit on smaller screens:<ul> <li>Tools \u2192 Reset column widths</li> </ul> </li> <li>Continue your investigation of suspicious or sensitive files by using the filter/search bar to identify any entries across all of the columns that contain that term.</li> <li>Document the following for any files of interest:<ul> <li>Did this account have access to the file?</li> <li>Are the files referenced in these logs the same as the ones identified in their OneDrive account?</li> <li>What is the earliest known access to these files?</li> <li>What type of activity did this account have with those files:<ul> <li>Created Folders</li> <li>Created Files</li> <li>Uploads</li> <li>Downloads</li> <li>File Previews</li> </ul> </li> <li>What IP Addresses are involved?</li> </ul> </li> <li>Clear your global filter and create a filter on the User column for the email in question. Now create a second filter in the Activity column for all activity related to \"Links\". Auditing links can help identify how content is being shared and how shared content is being accessed.</li> <li>Review the data and document any interesting artifacts related to:<ul> <li>What files and folders did the account of interest share?</li> <li>What files and folders did the account of interest access via anonymous (non-authenticated) links?</li> <li>What IP address(s) predominates for this activity?</li> </ul> </li> <li>Audit downloads conducted by the account of interest. To do this, clear your filter on the Activity column. Then create a new filter on the Activity column for all activity related to \"Downloaded files to computer\". Keep your User filter for the account of interest.<ul> <li>Document dates of unusual download activity and the IP addresses involved.</li> </ul> </li> <li>Audit files deleted by the account of interest. To do this, clear your filter on the Activity column. Then create a new filter on the Activity column for all activity related to \"Deleted File\".<ul> <li>Document any files that were deleted that are tied to the timeframe we are focused on or sensitive file deletion.</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Timeline Explorer - Unified Audit Log CSV](img/onedrive_forensics/10_ual_overview.png)\n</code></pre>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#evidence-to-document","title":"Evidence to Document","text":""},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#onedrive-profile-summary","title":"OneDrive Profile Summary","text":"<ul> <li>OneDrive accounts present</li> <li>Personal vs Business</li> <li><code>UserEmail</code>, <code>UserFolder</code>, <code>cid</code>, <code>SPOResourceID</code></li> <li>business Tenants / SharePoint libraries synced</li> <li>deleted OneDrive files + original paths</li> <li>sensitive files located (and cloud-only status)</li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#activity-summary","title":"Activity Summary","text":"<ul> <li>suspicious file access patterns</li> <li>abnormal deletions</li> <li>link sharing behavior (anonymous access)</li> <li>unusual download activity</li> <li>IP addresses tied to high-risk activity</li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#key-questions-for-reporting","title":"Key Questions for Reporting","text":"<ul> <li>What sensitive data was accessed?</li> <li>Was data downloaded to a computer?</li> <li>Were anonymous links used?</li> <li>Were files deleted after access?</li> <li>What is earliest known exposure time?</li> </ul>"},{"location":"1.Windows/Cloud_Storage_Forensics_OneDrive/#analyst-notes-pitfalls","title":"Analyst Notes / Pitfalls","text":"<ul> <li>Endpoint artifacts are limited by sync state (cloud-only placeholders exist)</li> <li>OneDrive for Business may sync multiple SharePoint libraries</li> <li>Always corroborate endpoint findings with UAL</li> <li>Recycle Bin redirection often breaks in mounted images; triage images help</li> <li>Be careful interpreting Created vs Modified times in synced folders</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/","title":"Windows Execution Artifacts for DFIR","text":"<p>This README provides a Digital Forensics &amp; Incident Response (DFIR)\u2013focused overview of three core Windows execution artifacts:</p> <ul> <li>Prefetch</li> <li>Amcache</li> <li>ShimCache (AppCompatCache)</li> </ul> <p>It explains what they are, why they matter, what they look like, and how to parse them using common forensic tools.</p>"},{"location":"1.Windows/Evidence_of_Execution/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Prefetch</li> <li>Amcache</li> <li>ShimCache (AppCompatCache)</li> <li>Correlation &amp; Analyst Tips</li> <li>Timeline Correlation Example</li> <li>KAPE Targets</li> <li>Malware Case Study: Renamed Credential Dumper</li> <li>Common Attacker Evasion Techniques</li> <li>MITRE ATT&amp;CK Mapping</li> <li>Execution Investigation Workflow (Checklist)</li> <li>Additional Windows Execution Artifacts</li> <li>Searching &amp; Auditing with Registry Explorer</li> <li>Evasion Techniques for Additional Artifacts</li> <li>KAPE Collection Targets for These Registry Artifacts</li> <li>Correlation Matrix</li> <li>RECmd Batch File Snippets (.reb)</li> <li>Mini RECmd Batch File Template (Single Cohesive .reb)</li> <li>Artifact Pivot Batch (.reb)</li> <li>Tooling Summary</li> <li>References</li> </ol>"},{"location":"1.Windows/Evidence_of_Execution/#prefetch","title":"Prefetch","text":""},{"location":"1.Windows/Evidence_of_Execution/#what-is-prefetch","title":"What is Prefetch?","text":"<p>Prefetch files are created by Windows to improve application startup performance. When an executable runs, Windows records metadata about its execution and the files it loads.</p> <p>From a DFIR perspective, Prefetch is one of the strongest indicators of program execution on a system.</p> <ul> <li>Enabled by default on most desktop versions of Windows</li> <li>Stored as <code>.pf</code> files</li> <li>Limited in count (typically 128\u20131024 files depending on OS)</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#location","title":"Location","text":"<pre><code>C:\\Windows\\Prefetch\\\n</code></pre> <p>Example filename:</p> <pre><code>POWERSHELL.EXE-3F0D7E6A.pf\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#forensic-value","title":"Forensic Value","text":"<p>Prefetch can help answer:</p> <ul> <li>Was this program executed?</li> <li>How many times was it executed?</li> <li>When was it last executed?</li> <li>Which files and DLLs were accessed?</li> </ul> <p>This makes Prefetch extremely useful for:</p> <ul> <li>Malware execution confirmation</li> <li>Living-off-the-land (LOLbin) abuse</li> <li>Timeline reconstruction</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#key-data-points","title":"Key Data Points","text":"<ul> <li>Executable name</li> <li>Full path of executable</li> <li>Run count</li> <li>Last execution timestamp</li> <li>Referenced files and DLLs</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#example-output-pecmdexe","title":"Example Output (PECmd.exe)","text":"<pre><code>ExecutableName: POWERSHELL.EXE\nRunCount: 14\nLastRunTime: 2024-11-18 13:42:51 UTC\nFullPath: \\DEVICE\\HARDDISKVOLUME3\\WINDOWS\\SYSTEM32\\WINDOWSPOWERSHELL\\V1.0\\POWERSHELL.EXE\n\nReferenced Files:\n- KERNEL32.DLL\n- NTDLL.DLL\n- AMSI.DLL\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#tools-for-prefetch","title":"Tools for Prefetch","text":""},{"location":"1.Windows/Evidence_of_Execution/#pecmdexe-eric-zimmerman","title":"PECmd.exe (Eric Zimmerman)","text":"<p>Parse Prefetch files:</p> <pre><code>PECmd.exe -d C:\\Windows\\Prefetch --csv prefetch.csv\n</code></pre> <p>Common flags:</p> <ul> <li><code>-d</code> : Directory of Prefetch files</li> <li><code>--csv</code> : Export to CSV</li> <li><code>--json</code> : Export to JSON</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#amcache","title":"Amcache","text":""},{"location":"1.Windows/Evidence_of_Execution/#what-is-amcache","title":"What is Amcache?","text":"<p>Amcache tracks application installation and execution metadata. It is especially valuable because it may record executables that never generated Prefetch.</p> <p>Amcache was significantly expanded starting in Windows 8+.</p>"},{"location":"1.Windows/Evidence_of_Execution/#location_1","title":"Location","text":"<p>Primary hive:</p> <pre><code>C:\\Windows\\AppCompat\\Programs\\Amcache.hve\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#forensic-value_1","title":"Forensic Value","text":"<p>Amcache can provide:</p> <ul> <li>Executable file paths</li> <li>File hashes (SHA1)</li> <li>Compilation timestamps</li> <li>First-seen timestamps</li> <li>Program metadata (company name, product name)</li> </ul> <p>This is critical for:</p> <ul> <li>Identifying dropped malware</li> <li>Detecting renamed binaries</li> <li>Validating attacker toolkits</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#key-data-points_1","title":"Key Data Points","text":"<ul> <li>File path</li> <li>SHA1 hash</li> <li>File size</li> <li>Compile time</li> <li>First execution time</li> <li>Program name and vendor</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#example-output-amcacheparser","title":"Example Output (AmcacheParser)","text":"<pre><code>Path: C:\\Users\\Public\\svchost.exe\nSHA1: 9f2c3e9f1a9d7b9a7a5c5d8f3b2a1e4c6d9e8f7a\nCompileTime: 2023-09-12 08:15:22 UTC\nFirstRunTime: 2024-11-17 02:31:44 UTC\nCompany: Microsoft Corporation\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#tools-for-amcache","title":"Tools for Amcache","text":""},{"location":"1.Windows/Evidence_of_Execution/#amcacheparserexe-eric-zimmerman","title":"AmcacheParser.exe (Eric Zimmerman)","text":"<pre><code>AmcacheParser.exe -f Amcache.hve --csv amcache.csv\n</code></pre> <p>Useful flags:</p> <ul> <li><code>-f</code> : Path to Amcache hive</li> <li><code>--csv</code> : CSV output</li> <li><code>--json</code> : JSON output</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#shimcache-appcompatcache","title":"ShimCache (AppCompatCache)","text":""},{"location":"1.Windows/Evidence_of_Execution/#what-is-shimcache","title":"What is ShimCache?","text":"<p>ShimCache, also known as AppCompatCache, is part of the Windows Application Compatibility framework.</p> <p>It records executables to determine whether compatibility shims are required.</p> <p>\u26a0\ufe0f Important: ShimCache does NOT reliably indicate execution \u2014 it only indicates that Windows was aware of the file.</p>"},{"location":"1.Windows/Evidence_of_Execution/#location_2","title":"Location","text":"<p>Stored in the SYSTEM registry hive:</p> <pre><code>HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCompatCache\n</code></pre> <p>Offline hive:</p> <pre><code>SYSTEM\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#forensic-value_2","title":"Forensic Value","text":"<p>ShimCache can help:</p> <ul> <li>Identify presence of executables</li> <li>Discover files that were deleted</li> <li>Detect attacker staging activity</li> </ul> <p>Best used in correlation with other artifacts.</p>"},{"location":"1.Windows/Evidence_of_Execution/#key-data-points_2","title":"Key Data Points","text":"<ul> <li>File path</li> <li>Last modified timestamp</li> <li>File size (varies by OS)</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#example-output-appcompatcacheparser","title":"Example Output (AppCompatCacheParser)","text":"<pre><code>Path: C:\\Temp\\mimikatz.exe\nLastModified: 2024-11-16 22:10:03 UTC\nFileSize: 856064\n\nExecutionFlag: Unknown\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#tools-for-shimcache","title":"Tools for ShimCache","text":""},{"location":"1.Windows/Evidence_of_Execution/#appcompatcacheparserexe-eric-zimmerman","title":"AppCompatCacheParser.exe (Eric Zimmerman)","text":"<pre><code>AppCompatCacheParser.exe -f SYSTEM --csv shimcache.csv\n</code></pre> <p>Common flags:</p> <ul> <li><code>-f</code> : SYSTEM hive</li> <li><code>--csv</code> : CSV output</li> <li><code>--json</code> : JSON output</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#correlation-analyst-tips","title":"Correlation &amp; Analyst Tips","text":""},{"location":"1.Windows/Evidence_of_Execution/#execution-confidence-ranking","title":"Execution Confidence Ranking","text":"Artifact Execution Confidence Prefetch High Amcache Medium\u2013High ShimCache Low"},{"location":"1.Windows/Evidence_of_Execution/#analyst-tips","title":"Analyst Tips","text":"<ul> <li>Correlate timestamps across artifacts</li> <li>Look for renamed LOLbins (e.g., <code>svchost.exe</code> in user directories)</li> <li>Use Amcache hashes to pivot into malware databases</li> <li>Prefetch absence does not mean no execution</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#timeline-correlation-example","title":"Timeline Correlation Example","text":""},{"location":"1.Windows/Evidence_of_Execution/#scenario","title":"Scenario","text":"<p>An analyst is investigating suspected malware execution involving a renamed credential-dumping tool (<code>svchost.exe</code>) dropped into a user-writable directory.</p> <p>The goal is to correlate Prefetch, Amcache, and ShimCache to assess execution confidence and build a timeline.</p>"},{"location":"1.Windows/Evidence_of_Execution/#correlated-timeline","title":"Correlated Timeline","text":"Timestamp (UTC) Artifact Evidence 2024-11-16 22:09:58 ShimCache File present in Temp directory 2024-11-17 02:31:44 Amcache SHA1 recorded, FirstRunTime 2024-11-18 13:42:51 Prefetch RunCount = 3"},{"location":"1.Windows/Evidence_of_Execution/#analyst-interpretation","title":"Analyst Interpretation","text":"<ul> <li>ShimCache shows early presence (possible staging)</li> <li>Amcache confirms file metadata and first execution</li> <li>Prefetch strongly confirms repeated execution</li> </ul> <p>Combined, these artifacts provide high confidence execution evidence.</p>"},{"location":"1.Windows/Evidence_of_Execution/#kape-targets","title":"KAPE Targets","text":"<p>KAPE (Kroll Artifact Parser and Extractor) can be used to collect and parse these artifacts at scale.</p>"},{"location":"1.Windows/Evidence_of_Execution/#prefetch-targets","title":"Prefetch Targets","text":"<pre><code>Targets\\Windows\\Prefetch.tkape\n</code></pre> <p>Collects:</p> <ul> <li>Prefetch files (<code>*.pf</code>)</li> </ul> <p>Parser Module:</p> <pre><code>Modules\\Windows\\PECmd.mkape\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#amcache-targets","title":"Amcache Targets","text":"<pre><code>Targets\\Windows\\Amcache.tkape\n</code></pre> <p>Collects:</p> <ul> <li>Amcache.hve</li> </ul> <p>Parser Module:</p> <pre><code>Modules\\Windows\\AmcacheParser.mkape\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#shimcache-targets","title":"ShimCache Targets","text":"<pre><code>Targets\\Windows\\Registry\\SYSTEM.tkape\n</code></pre> <p>Collects:</p> <ul> <li>SYSTEM registry hive</li> </ul> <p>Parser Module:</p> <pre><code>Modules\\Windows\\AppCompatCacheParser.mkape\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#example-kape-command","title":"Example KAPE Command","text":"<pre><code>kape.exe --tsource C: --tdest E:\\KAPE --target Prefetch,Amcache,SYSTEM --module PECmd,AmcacheParser,AppCompatCacheParser\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#malware-case-study-renamed-credential-dumper","title":"Malware Case Study: Renamed Credential Dumper","text":""},{"location":"1.Windows/Evidence_of_Execution/#incident-overview","title":"Incident Overview","text":"<p>A SOC receives an alert for suspicious PowerShell activity. Investigation reveals a suspicious binary named <code>svchost.exe</code> located in a user-writable directory.</p>"},{"location":"1.Windows/Evidence_of_Execution/#findings-by-artifact","title":"Findings by Artifact","text":""},{"location":"1.Windows/Evidence_of_Execution/#shimcache","title":"ShimCache","text":"<ul> <li>Indicates the file existed on disk prior to execution</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#amcache_1","title":"Amcache","text":"<ul> <li>Records SHA1 hash and first execution time</li> <li>Hash does not match legitimate Windows binary</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#prefetch_1","title":"Prefetch","text":"<ul> <li>Confirms execution and multiple runs</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#final-assessment","title":"Final Assessment","text":"Question Answer Was the file present? Yes Was it executed? Yes Was it persistent? Likely Is it legitimate? No"},{"location":"1.Windows/Evidence_of_Execution/#analyst-conclusion","title":"Analyst Conclusion","text":"<p>The binary masquerading as <code>svchost.exe</code> was executed multiple times and is highly likely malicious.</p>"},{"location":"1.Windows/Evidence_of_Execution/#common-attacker-evasion-techniques","title":"Common Attacker Evasion Techniques","text":"<p>Attackers are aware of Windows execution artifacts and may attempt to evade or limit forensic visibility. Understanding these techniques helps analysts avoid false negatives.</p>"},{"location":"1.Windows/Evidence_of_Execution/#prefetch-evasion","title":"Prefetch Evasion","text":"<p>Techniques:</p> <ul> <li> <p>Disabling Prefetch via registry:</p> </li> <li> <p><code>HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters</code></p> </li> <li><code>EnablePrefetcher = 0</code></li> <li>Using portable executables executed only once</li> <li>Executing binaries from removable media or network shares</li> <li>Deleting Prefetch files post-execution</li> </ul> <p>DFIR Notes:</p> <ul> <li>Absence of Prefetch does not equal absence of execution</li> <li>Check OS version and Prefetch configuration</li> <li>Correlate with Amcache, ShimCache, and event logs</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#amcache-evasion","title":"Amcache Evasion","text":"<p>Techniques:</p> <ul> <li>Running malware purely in memory (reflective loading)</li> <li>Using scripts (PowerShell, JavaScript, WMI) instead of binaries</li> <li>Cleaning or replacing <code>Amcache.hve</code></li> </ul> <p>DFIR Notes:</p> <ul> <li>Amcache is resilient and often survives basic cleanup</li> <li>Look for suspicious compile times or mismatched metadata</li> <li>Hashes are valuable for threat intelligence pivoting</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#shimcache-appcompatcache-evasion","title":"ShimCache (AppCompatCache) Evasion","text":"<p>Techniques:</p> <ul> <li>Relying on the artifact\u2019s ambiguity (presence \u2260 execution)</li> <li>Clearing or rolling SYSTEM registry hives</li> <li>Executing binaries briefly and deleting them</li> </ul> <p>DFIR Notes:</p> <ul> <li>ShimCache is best used as a supporting artifact</li> <li>Deleted malware often still appears here</li> <li>Timestamp interpretation varies by Windows version</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#living-off-the-land-lolbin-abuse","title":"Living-off-the-Land (LOLbin) Abuse","text":"<p>Techniques:</p> <ul> <li> <p>Abuse of signed Windows binaries:</p> </li> <li> <p><code>powershell.exe</code></p> </li> <li><code>wmic.exe</code></li> <li><code>mshta.exe</code></li> <li><code>rundll32.exe</code></li> </ul> <p>DFIR Notes:</p> <ul> <li>Prefetch still records LOLbin execution</li> <li>Focus on command-line artifacts and child processes</li> <li>Correlate with PowerShell logs, SRUM, and UserAssist</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#analyst-takeaways","title":"Analyst Takeaways","text":"<ul> <li>Never rely on a single execution artifact</li> <li>Artifact gaps are often intentional</li> <li>Correlation beats individual indicators</li> <li>Document evasion possibilities in reports</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#mitre-attck-mapping","title":"MITRE ATT&amp;CK Mapping","text":"<p>The following MITRE ATT&amp;CK techniques are commonly associated with activity uncovered through Prefetch, Amcache, and ShimCache analysis.</p>"},{"location":"1.Windows/Evidence_of_Execution/#execution","title":"Execution","text":"<ul> <li> <p>T1059 \u2013 Command and Scripting Interpreter</p> </li> <li> <p>PowerShell, CMD, WMIC, MSHTA execution often visible via Prefetch</p> </li> <li> <p>T1204 \u2013 User Execution</p> </li> <li> <p>Malicious binaries executed via phishing or user interaction</p> </li> <li> <p>T1047 \u2013 Windows Management Instrumentation</p> </li> <li> <p>WMI-launched executables may appear in Amcache and ShimCache</p> </li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#defense-evasion","title":"Defense Evasion","text":"<ul> <li> <p>T1036 \u2013 Masquerading</p> </li> <li> <p>Renamed binaries (e.g., <code>svchost.exe</code> in user directories)</p> </li> <li> <p>T1070 \u2013 Indicator Removal on Host</p> </li> <li> <p>Deletion of Prefetch files or registry hives</p> </li> <li> <p>T1112 \u2013 Modify Registry</p> </li> <li> <p>Disabling Prefetch or tampering with AppCompat settings</p> </li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#persistence-related","title":"Persistence (Related)","text":"<ul> <li> <p>T1547 \u2013 Boot or Logon Autostart Execution</p> </li> <li> <p>Execution artifacts may reveal binaries later used for persistence</p> </li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#execution-investigation-workflow-checklist","title":"Execution Investigation Workflow (Checklist)","text":"<p>The following checklist provides a repeatable DFIR workflow for investigating suspected program execution on Windows systems.</p>"},{"location":"1.Windows/Evidence_of_Execution/#1-initial-triage","title":"1. Initial Triage","text":"<ul> <li>Identify suspicious filename or hash</li> <li>Note file location (system vs user-writable path)</li> <li>Check alerting source (EDR, SIEM, user report)</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#2-prefetch-analysis","title":"2. Prefetch Analysis","text":"<ul> <li>Parse Prefetch directory with <code>PECmd.exe</code></li> <li>Look for matching executable names</li> <li> <p>Record:</p> </li> <li> <p>Run count</p> </li> <li>Last execution time</li> <li>Full execution path</li> <li>Validate Prefetch configuration status</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#3-amcache-analysis","title":"3. Amcache Analysis","text":"<ul> <li>Parse <code>Amcache.hve</code></li> <li>Locate matching file paths or hashes</li> <li> <p>Record:</p> </li> <li> <p>SHA1 hash</p> </li> <li>Compile timestamp</li> <li>First-seen / execution time</li> <li>Compare metadata against known-good binaries</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#4-shimcache-analysis","title":"4. ShimCache Analysis","text":"<ul> <li>Parse SYSTEM hive AppCompatCache</li> <li>Identify presence of suspicious executables</li> <li>Note last modified timestamps</li> <li>Treat as supporting evidence only</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#5-correlation-validation","title":"5. Correlation &amp; Validation","text":"<ul> <li>Align timestamps across all artifacts</li> <li>Identify execution order and repetition</li> <li> <p>Validate against:</p> </li> <li> <p>Event logs</p> </li> <li>PowerShell logs</li> <li>SRUM / UserAssist</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#6-adversary-behavior-assessment","title":"6. Adversary Behavior Assessment","text":"<ul> <li>Check for masquerading indicators</li> <li>Identify LOLbin usage</li> <li>Determine possible execution method (scripted vs binary)</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#7-reporting-response","title":"7. Reporting &amp; Response","text":"<ul> <li>Document execution confidence level</li> <li>Note possible attacker evasion techniques</li> <li>Preserve parsed artifacts and raw evidence</li> <li>Escalate for containment and remediation</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#execution-confidence-summary","title":"Execution Confidence Summary","text":"Evidence Confidence Prefetch present High Amcache only Medium ShimCache only Low Correlated artifacts Very High"},{"location":"1.Windows/Evidence_of_Execution/#additional-windows-execution-artifacts","title":"Additional Windows Execution Artifacts","text":"<p>In addition to Prefetch, Amcache, and ShimCache, modern Windows systems contain several other high-value execution and user-activity artifacts in the registry.</p> <p>These artifacts are especially useful when:</p> <ul> <li>Prefetch is disabled or absent</li> <li>Malware executes via GUI shortcuts, Run dialog, or pinned apps</li> <li>Attackers rely heavily on interactive execution rather than services</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#bam-background-activity-moderator","title":"BAM (Background Activity Moderator)","text":"<p>Purpose: Records background app activity, including executable path and last executed time.</p> <p>Registry Path:</p> <pre><code>SYSTEM\\&lt;CurrentControlSet&gt;\\Services\\bam\\State\\UserSettings\\{SID}\n</code></pre> <p>Example Entry:</p> <pre><code>Value Name: \\Device\\HarddiskVolume3\\Users\\Public\\svchost.exe\nData: 2024-11-18 13:42:51 UTC\n</code></pre> <p>DFIR Value:</p> <ul> <li>Strong evidence of program execution</li> <li>Tracks full path</li> <li>Useful on Windows 10/11 where Prefetch may be limited</li> </ul> <p>How to Audit (Registry Explorer):</p> <ul> <li>Load SYSTEM hive</li> <li>Navigate to BAM path</li> <li>Review per-SID keys and value timestamps</li> </ul> <p>Command Line Tools:</p> <ul> <li><code>RECmd.exe</code> (Eric Zimmerman) can parse BAM keys when using appropriate batch files.</li> </ul> <p>Example:</p> <pre><code>RECmd.exe -f SYSTEM --bn RegistryExplorerBatch.reb --csv bam.csv\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#dam-desktop-activity-moderator","title":"DAM (Desktop Activity Moderator)","text":"<p>Purpose: Tracks desktop activity for Modern Standby / battery life management.</p> <p>Registry Path:</p> <pre><code>SYSTEM\\&lt;CurrentControlSet&gt;\\Services\\dam\\State\\UserSettings\\{SID}\n</code></pre> <p>Example Entry:</p> <pre><code>Value Name: \\Device\\HarddiskVolume3\\Windows\\System32\\cmd.exe\nData: 2024-11-17 02:35:11 UTC\n</code></pre> <p>DFIR Value:</p> <ul> <li>Evidence of interactive desktop execution</li> <li>Similar structure to BAM</li> </ul> <p>Audit steps mirror BAM.</p>"},{"location":"1.Windows/Evidence_of_Execution/#runmru-windowsr-command-history","title":"RunMRU (Windows+R Command History)","text":"<p>Purpose: Records commands entered into the Run dialog.</p> <p>Registry Path:</p> <pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\n</code></pre> <p>Example:</p> <pre><code>a = cmd\nb = powershell -enc SQBFAFgA...\nMRUList = \"ba\"\n</code></pre> <p>DFIR Value:</p> <ul> <li>Identifies user-initiated command execution</li> <li>Useful for detecting LOLbin usage</li> <li>Often reveals encoded PowerShell</li> </ul> <p>Audit (Registry Explorer):</p> <ul> <li>Load NTUSER.DAT</li> <li>Navigate to RunMRU key</li> <li>Review values and MRUList ordering</li> </ul> <p>Command Line:</p> <pre><code>RECmd.exe -f NTUSER.DAT --bn RegistryExplorerBatch.reb --csv runmru.csv\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#userassist","title":"UserAssist","text":"<p>Purpose: Tracks GUI program execution via Explorer (not background/terminal). Includes Focus Count and Focus Time.</p> <p>Registry Path:</p> <pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{GUID}\\Count\n</code></pre> <p>Useful GUIDs:</p> <ul> <li><code>CEBFF5CD-ACE2-4F4F-9178-9926F41749EA</code> (Executable File Execution)</li> <li><code>F4E57C4B-2036-45F0-A9AB-443BCFE33D9F</code> (Shortcut File Execution)</li> </ul> <p>Example:</p> <pre><code>Value Name (ROT13): HRZR_EHACNGU:P:\\Users\\Public\\svchost.exe\nRun Count: 7\nFocus Count: 3\nFocus Time: 00:05:22\nLast Run: 2024-11-18 13:41:02 UTC\n</code></pre> <p>DFIR Value:</p> <ul> <li>Excellent for user-driven execution</li> <li>Tracks frequency and interaction</li> </ul> <p>Audit:</p> <ul> <li>Registry Explorer shows decoded values</li> <li>Look for unusual paths and high run counts</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#featureusage-explorer-activity","title":"FeatureUsage (Explorer Activity)","text":"<p>Windows records additional Explorer app usage under FeatureUsage.</p>"},{"location":"1.Windows/Evidence_of_Execution/#applaunch","title":"AppLaunch","text":"<p>Purpose: Apps pinned to taskbar and executed from pinned shortcut.</p> <p>Path:</p> <pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppLaunch\n</code></pre> <p>Example:</p> <pre><code>\\Device\\HarddiskVolume3\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe : 12\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#appswitched","title":"AppSwitched","text":"<p>Purpose: Records apps switched into focus.</p> <p>Path:</p> <pre><code>...\\FeatureUsage\\AppSwitched\n</code></pre> <p>Example:</p> <pre><code>\\Device\\HarddiskVolume3\\Users\\Public\\svchost.exe : 5\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#appbadgeupdated","title":"AppBadgeUpdated","text":"<p>Purpose: Badge updates / notifications count.</p> <p>Path:</p> <pre><code>...\\FeatureUsage\\AppBadgeUpdated\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#showjumpview","title":"ShowJumpView","text":"<p>Purpose: Counts right-clicks showing Jump Lists.</p> <p>Path:</p> <pre><code>...\\FeatureUsage\\ShowJumpView\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#traybuttonclicked","title":"TrayButtonClicked","text":"<p>Purpose: Tracks clicks on built-in tray applications.</p> <p>Path:</p> <pre><code>...\\FeatureUsage\\TrayButtonClicked\n</code></pre> <p>DFIR Value for FeatureUsage:</p> <ul> <li>Identifies which apps were launched interactively</li> <li>Helps confirm user engagement</li> <li>Supports timeline reconstruction</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#searching-auditing-with-registry-explorer","title":"Searching &amp; Auditing with Registry Explorer","text":""},{"location":"1.Windows/Evidence_of_Execution/#workflow","title":"Workflow","text":"<ol> <li> <p>Acquire hives:</p> </li> <li> <p><code>SYSTEM</code></p> </li> <li><code>NTUSER.DAT</code></li> <li>Open in Registry Explorer</li> <li> <p>Use the search function for:</p> </li> <li> <p>suspicious filename (<code>svchost.exe</code>, <code>rundll32.exe</code>, etc.)</p> </li> <li>known LOLbins</li> <li>attacker tool names</li> </ol>"},{"location":"1.Windows/Evidence_of_Execution/#cli-workflow-with-recmd","title":"CLI Workflow with RECmd","text":"<p><code>RECmd.exe</code> supports batch parsing using <code>.reb</code> batch files.</p> <p>Example collection:</p> <pre><code>RECmd.exe -f SYSTEM --bn RegistryExplorerBatch.reb --csv system_artifacts.csv\nRECmd.exe -f NTUSER.DAT --bn RegistryExplorerBatch.reb --csv user_artifacts.csv\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#evasion-techniques-for-additional-artifacts","title":"Evasion Techniques for Additional Artifacts","text":"<p>Attackers may attempt to reduce registry artifact visibility.</p>"},{"location":"1.Windows/Evidence_of_Execution/#bamdam-evasion","title":"BAM/DAM Evasion","text":"<ul> <li>Execute tools via service context or scheduled task that avoids user context</li> <li>Clear BAM/DAM keys (requires admin)</li> <li>Roll back or replace SYSTEM hive</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#runmru-evasion","title":"RunMRU Evasion","text":"<ul> <li>Avoid Run dialog usage</li> <li>Clear RunMRU key</li> <li>Use alternate execution methods (shortcut, task scheduler)</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#userassist-evasion","title":"UserAssist Evasion","text":"<ul> <li>Use command-line only execution</li> <li>Run from non-Explorer contexts</li> <li>Clear UserAssist keys (user-level)</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#featureusage-evasion","title":"FeatureUsage Evasion","text":"<ul> <li>Avoid pinned apps</li> <li>Launch via CLI, scripts, WMI, or services</li> <li>Clear FeatureUsage keys</li> </ul> <p>Analyst Note: Artifact deletion attempts often create additional evidence such as:</p> <ul> <li>Registry hive timestamp changes</li> <li>USN journal entries</li> <li>Unexpected gaps in user activity</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#kape-collection-targets-for-these-registry-artifacts","title":"KAPE Collection Targets for These Registry Artifacts","text":"<p>KAPE collects files, not individual registry keys. For the artifacts below, you typically collect the registry hives that contain them, then parse with RECmd/Registry Explorer.</p>"},{"location":"1.Windows/Evidence_of_Execution/#required-hives-to-collect","title":"Required Hives to Collect","text":"Artifact Group Hive File(s) to Collect Typical On-Disk Path BAM / DAM <code>SYSTEM</code> <code>C:\\Windows\\System32\\config\\SYSTEM</code> RunMRU / UserAssist / FeatureUsage <code>NTUSER.DAT</code> (per user) <code>C:\\Users\\&lt;User&gt;\\NTUSER.DAT</code> (Optional but recommended) Shell/UI context <code>UsrClass.dat</code> (per user) <code>C:\\Users\\&lt;User&gt;\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat</code>"},{"location":"1.Windows/Evidence_of_Execution/#common-kape-targets-to-use","title":"Common KAPE Targets to Use","text":"<p>Depending on how your KAPETargets are organized, these are the most common target patterns that cover what you need:</p> <ul> <li>SYSTEM hive target (collects <code>SYSTEM</code>): often named something like <code>SYSTEM</code> or <code>RegistryHives</code> (varies by KapeFiles version)</li> <li>NTUSER targets (collect per-user): often named something like <code>NTUSER</code> or <code>UserHives</code></li> <li>UsrClass.dat targets (optional): often named something like <code>UsrClass</code> or included in broader user-hive targets</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#practical-kape-command-examples","title":"Practical KAPE Command Examples","text":"<p>Collect only the required hives:</p> <pre><code>kape.exe --tsource C: --tdest E:\\KAPE --target SYSTEM,NTUSER\n</code></pre> <p>Collect hives and immediately parse with RECmd (if you have a module set up for it):</p> <pre><code>kape.exe --tsource C: --tdest E:\\KAPE --target SYSTEM,NTUSER --module RECmd\n</code></pre> <p>Tip: Use <code>--sim</code> first to validate volume/paths before collecting.</p>"},{"location":"1.Windows/Evidence_of_Execution/#correlation-matrix","title":"Correlation Matrix","text":"<p>Use this matrix to quickly decide which artifact answers which question, and what its common blind spots are.</p> Artifact What it Answers What It Typically Stores Execution Confidence Common Gaps / Pitfalls Prefetch Was an EXE run? When? How often? Run count, last run time(s), path, loaded files High Disabled/limited; not guaranteed for all executions Amcache What EXE existed/was seen? Hash/metadata? Path, SHA1, compile time, \u201cfirst seen/run\u201d style metadata Med\u2013High In-memory/script-only may not appear; hive tampering ShimCache Was Windows aware of an EXE path? Path + timestamp (version dependent) Low Presence \u2260 execution; timestamp semantics vary BAM When did this EXE run in user context? Full path + last execution timestamp per SID Med\u2013High Can be cleared; depends on OS/user context DAM Similar to BAM, desktop activity Full path + last execution timestamp per SID Med\u2013High Similar limitations to BAM RunMRU What was typed into Win+R? Commands/strings + MRU ordering Medium No timestamp; only Win+R; easily cleared UserAssist What GUI apps were launched via Explorer? Run count, focus count/time, last run time Medium No CLI/background; ROT13; can be cleared FeatureUsage\\AppLaunch What was launched from pinned/taskbar? Counts keyed by app path Low\u2013Medium Counts only; UI-driven; limited context FeatureUsage\\AppSwitched What apps were switched into focus? Focus/switch counts Low Not proof of launch; only UI focus events"},{"location":"1.Windows/Evidence_of_Execution/#recmd-batch-file-snippets-reb","title":"RECmd Batch File Snippets (.reb)","text":"<p>RECmd batch files are YAML-formatted and let you script extraction of specific keys across many hives. Below are minimal snippets for the artifacts you listed.</p> <p>These are intended to be dropped into a custom <code>.reb</code> file (e.g., <code>ExecutionArtifacts_Custom.reb</code>). You can also compare against the maintained \u201cDFIR Batch File\u201d examples shipped with RECmd.</p>"},{"location":"1.Windows/Evidence_of_Execution/#system-hive-bam-dam","title":"SYSTEM Hive: BAM + DAM","text":"<pre><code>Description: Execution artifacts (BAM/DAM)\nAuthor: YourTeam\nVersion: 1\nId: 11111111-1111-1111-1111-111111111111\nKeys:\n  - Description: BAM UserSettings\n    HiveType: SYSTEM\n    Category: Program Execution\n    KeyPath: ControlSet*\\Services\\bam\\State\\UserSettings\\* \n    Recursive: true\n\n  - Description: DAM UserSettings\n    HiveType: SYSTEM\n    Category: Program Execution\n    KeyPath: ControlSet*\\Services\\dam\\State\\UserSettings\\* \n    Recursive: true\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#ntuserdat-runmru","title":"NTUSER.DAT: RunMRU","text":"<pre><code>  - Description: RunMRU (Win+R)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\n    Recursive: false\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#ntuserdat-userassist","title":"NTUSER.DAT: UserAssist","text":"<pre><code>  - Description: UserAssist (EXE execution)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}\\Count\n    Recursive: true\n\n  - Description: UserAssist (LNK execution)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}\\Count\n    Recursive: true\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#ntuserdat-featureusage","title":"NTUSER.DAT: FeatureUsage","text":"<pre><code>  - Description: FeatureUsage AppLaunch\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppLaunch\n    Recursive: true\n\n  - Description: FeatureUsage AppSwitched\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppSwitched\n    Recursive: true\n\n  - Description: FeatureUsage AppBadgeUpdated\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppBadgeUpdated\n    Recursive: true\n\n  - Description: FeatureUsage ShowJumpView\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\ShowJumpView\n    Recursive: true\n\n  - Description: FeatureUsage TrayButtonClicked\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\TrayButtonClicked\n    Recursive: true\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#running-recmd-with-your-custom-batch","title":"Running RECmd with Your Custom Batch","text":"<p>Parse a single hive:</p> <pre><code>RECmd.exe -f SYSTEM --bn ExecutionArtifacts_Custom.reb --csv E:\\out\nRECmd.exe -f NTUSER.DAT --bn ExecutionArtifacts_Custom.reb --csv E:\\out\n</code></pre> <p>Parse a directory of hives recursively:</p> <pre><code>RECmd.exe -d E:\\KAPE\\Files --bn ExecutionArtifacts_Custom.reb --csv E:\\out\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#mini-recmd-batch-file-template-single-cohesive-reb","title":"Mini RECmd Batch File Template (Single Cohesive .reb)","text":"<p>Below is a complete starter RECmd batch file you can save as <code>ExecutionArtifacts_Custom.reb</code>.</p> <p>Note: RECmd batch files support multiple key definitions in a single YAML document. This template includes SYSTEM + NTUSER keys together; RECmd will only apply entries that match the hive type being parsed.</p> <pre><code>Description: Windows Execution Artifacts (Prefetch Adjacent + Registry Execution Evidence)\nAuthor: DFIR Team\nVersion: 1\nId: 8b0c0e7e-3c8e-4d62-a1cf-000000000001\nKeys:\n  # -----------------------------\n  # SYSTEM Hive\n  # -----------------------------\n\n  - Description: BAM UserSettings (Background Activity Moderator)\n    HiveType: SYSTEM\n    Category: Program Execution\n    KeyPath: ControlSet*\\Services\\bam\\State\\UserSettings\\*\n    Recursive: true\n\n  - Description: DAM UserSettings (Desktop Activity Moderator)\n    HiveType: SYSTEM\n    Category: Program Execution\n    KeyPath: ControlSet*\\Services\\dam\\State\\UserSettings\\*\n    Recursive: true\n\n  # -----------------------------\n  # NTUSER.DAT Hive\n  # -----------------------------\n\n  - Description: RunMRU (Windows+R)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\n    Recursive: false\n\n  - Description: UserAssist (Executable File Execution)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}\\Count\n    Recursive: true\n\n  - Description: UserAssist (Shortcut File Execution)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}\\Count\n    Recursive: true\n\n  - Description: FeatureUsage AppLaunch (Pinned apps execution count)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppLaunch\n    Recursive: true\n\n  - Description: FeatureUsage AppSwitched (App focus switches)\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppSwitched\n    Recursive: true\n\n  - Description: FeatureUsage AppBadgeUpdated (Notification badges)\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\AppBadgeUpdated\n    Recursive: true\n\n  - Description: FeatureUsage ShowJumpView (Jump List right-click count)\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\ShowJumpView\n    Recursive: true\n\n  - Description: FeatureUsage TrayButtonClicked (Tray UI clicks)\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\\TrayButtonClicked\n    Recursive: true\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#example-usage","title":"Example Usage","text":"<pre><code>RECmd.exe -f SYSTEM --bn ExecutionArtifacts_Custom.reb --csv E:\\out\nRECmd.exe -f C:\\Users\\Alice\\NTUSER.DAT --bn ExecutionArtifacts_Custom.reb --csv E:\\out\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#artifact-pivot-batch-reb","title":"Artifact Pivot Batch (.reb)","text":"<p>Sometimes you don\u2019t know which artifact will contain your indicator. In those cases, it\u2019s useful to run an artifact pivot batch that extracts the most common execution-related keys from SYSTEM and NTUSER, then pivot (search) in the output for an indicator such as:</p> <ul> <li>suspicious filename (<code>mimikatz.exe</code>, <code>svchost.exe</code> in user paths)</li> <li>known LOLbin (<code>rundll32.exe</code>, <code>mshta.exe</code>)</li> <li>a directory (<code>C:\\Users\\Public</code>, <code>C:\\Temp</code>)</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#how-the-pivot-works","title":"How the Pivot Works:**","text":"<ol> <li>Run RECmd with the pivot batch (exports CSV/JSON)</li> <li>Search the output with <code>findstr</code>, <code>Select-String</code>, or your SIEM/forensic notebook</li> </ol>"},{"location":"1.Windows/Evidence_of_Execution/#pivot-batch-template-executionartifacts_pivotreb","title":"Pivot Batch Template: <code>ExecutionArtifacts_Pivot.reb</code>","text":"<pre><code>Description: Artifact Pivot (Execution + User Activity)\nAuthor: DFIR Team\nVersion: 1\nId: 8b0c0e7e-3c8e-4d62-a1cf-000000000002\nKeys:\n  # -----------------------------\n  # SYSTEM Hive\n  # -----------------------------\n\n  - Description: BAM UserSettings (Background Activity Moderator)\n    HiveType: SYSTEM\n    Category: Program Execution\n    KeyPath: ControlSet*\\Services\\bam\\State\\UserSettings\\*\n    Recursive: true\n\n  - Description: DAM UserSettings (Desktop Activity Moderator)\n    HiveType: SYSTEM\n    Category: Program Execution\n    KeyPath: ControlSet*\\Services\\dam\\State\\UserSettings\\*\n    Recursive: true\n\n  # -----------------------------\n  # NTUSER.DAT Hive\n  # -----------------------------\n\n  - Description: RunMRU (Windows+R)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\n    Recursive: false\n\n  - Description: UserAssist (All GUIDs)\n    HiveType: NTUSER\n    Category: Program Execution\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\n    Recursive: true\n\n  - Description: FeatureUsage (All)\n    HiveType: NTUSER\n    Category: User Activity\n    KeyPath: Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FeatureUsage\n    Recursive: true\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#run-recmd-pivot-collection","title":"Run RECmd (Pivot Collection)","text":"<pre><code>RECmd.exe -f SYSTEM --bn ExecutionArtifacts_Pivot.reb --csv E:\\pivot_out\nRECmd.exe -f C:\\Users\\Alice\\NTUSER.DAT --bn ExecutionArtifacts_Pivot.reb --csv E:\\pivot_out\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#pivot-search-examples","title":"Pivot (Search) Examples","text":""},{"location":"1.Windows/Evidence_of_Execution/#windows-findstr","title":"Windows <code>findstr</code>","text":"<p>Search all pivot CSV output for a suspicious string:</p> <pre><code>findstr /S /I \"svchost.exe C:\\Users\\Public mimikatz\" E:\\pivot_out\\*.csv\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#powershell-select-string","title":"PowerShell <code>Select-String</code>","text":"<pre><code>Get-ChildItem E:\\pivot_out\\*.csv | Select-String -Pattern \"svchost.exe\",\"mimikatz\",\"C:\\Temp\" -CaseSensitive:$false\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#linuxwsl-grep-if-your-output-is-staged-on-a-linux-host","title":"Linux/WSL <code>grep</code> (if your output is staged on a Linux host)","text":"<pre><code>grep -RinE \"svchost\\.exe|mimikatz|C:\\Temp\" ./pivot_out/\n</code></pre>"},{"location":"1.Windows/Evidence_of_Execution/#notes","title":"Notes","text":"<ul> <li>This pivot batch intentionally targets broader parent keys for UserAssist and FeatureUsage to maximize recall.</li> <li>If you want higher precision, use the earlier Custom batch file with specific GUIDs/subkeys.</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#tooling-summary","title":"Tooling Summary","text":"Artifact Tools Prefetch PECmd.exe Amcache AmcacheParser.exe ShimCache AppCompatCacheParser.exe <p>Additional Helpful Tools:</p> <ul> <li>Timeline Explorer</li> <li>KAPE</li> <li>Plaso / log2timeline</li> </ul>"},{"location":"1.Windows/Evidence_of_Execution/#references","title":"References","text":"<ul> <li>Eric Zimmerman Tools</li> <li>Microsoft Windows Internals</li> <li>SANS DFIR Posters</li> </ul> <p>Author: DFIR Reference</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/","title":"NTUSER.DAT Analysis (DFIR)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#overview","title":"Overview","text":"<p>The NTUSER.DAT registry hive contains per-user configuration and activity artifacts for a Windows profile. From a DFIR standpoint, NTUSER.DAT is one of the most valuable artifacts to:</p> <ul> <li>Identify user intent (searches, typed paths, recent documents)</li> <li>Recover evidence of file access and data staging/exfil</li> <li>Attribute actions to a specific user profile</li> <li>Detect persistence mechanisms (Run keys)</li> <li>Correlate activity with a timeframe of interest</li> </ul> <p>This document provides a structured workflow for analyzing NTUSER.DAT using:</p> <ul> <li>Registry Explorer (interactive analysis)</li> <li>RECmd.exe (automation at scale)</li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#artifact-location","title":"Artifact Location","text":"<p>Registry Hive: <code>NTUSER.DAT</code> Typical Path: <code>C:\\Users\\{user}\\NTUSER.DAT</code></p> <p>Associated transaction logs (if present): - <code>ntuser.dat.LOG1</code> - <code>ntuser.dat.LOG2</code></p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#tools-used","title":"Tools Used","text":"<ul> <li>Registry Explorer (Eric Zimmerman)</li> <li>RECmd.exe + Timeline Explorer (Eric Zimmerman)</li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#investigative-workflow-registry-explorer","title":"Investigative Workflow \u2013 Registry Explorer","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#step-1-prep-ntuserdat-hive-in-registry-explorer","title":"Step 1 \u2014 Prep NTUSER.DAT Hive in Registry Explorer","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#procedure","title":"Procedure","text":"<ol> <li>Launch Registry Explorer</li> <li>Select File \u2192 Load Hive</li> <li>Browse to the offline hive file  <ul> <li>Example: <code>E:\\C\\Users\\user1\\NTUSER.DAT</code></li> </ul> </li> <li>If a dirty hive is detected, select Yes</li> <li>Click OK to select the transaction logs to replay (skip if not prompted)</li> <li>In the \u201cOpen\u201d dialog box navigate to offline hive file (such as E:\\C\\Users\\user1) and highlight ntuser.dat.LOG1 and ntuser.dat.LOG2 by holding the CTRL key and clicking the filenames with your mouse. Select Open. (skip if no dirty hive detected).</li> <li>Click OK to replay transaction logs</li> <li>Select the save location to the directory you are working in, naming it something like: <code>NTUSER.DAT_clean</code></li> <li>Select Yes when asked if you want to load the updated hive.</li> <li>Select No when asked to load the dirty hive</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Load NTUSER.DAT hive](img/ntuser_analysis/01_load_ntuser_hive.png)\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#step-2-wordwheelquery-search-terms","title":"Step 2 \u2014 WordWheelQuery (Search Terms)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#registry-path","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordWheelQuery\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#what-it-shows","title":"What it shows","text":"<p>Search terms typed into Windows Search / Explorer search.</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#procedure_1","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordWheelQuery</code> in Registry Explorer.</li> <li>Review the searches typed by the account in question and identify any suspicious search terms.<ul> <li>MRU, or Most Recently Used, position is in descending order, position 0 is the most recent search.</li> </ul> </li> <li>Document any searches with timestamps:<ul> <li>WordWheelQuery does not maintain timestamps for its values, it does have one timestamp, the last write time of the key itself.</li> <li>Since the key contains a Most Recently Used (MRU) list, we know that the most recent search conducted is present in MRU position 0.</li> <li>Hence that search was conducted at the time WordWheelQuery was last written.</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - WordWheelQuery searches](img/ntuser_analysis/02_wordwheelquery.png)\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#dfir-notes","title":"DFIR Notes","text":"<ul> <li>MRU list is descending</li> <li>MRU position <code>0</code> is the most recent search</li> <li>Values do not store timestamps</li> <li>The key\u2019s LastWrite timestamp indicates when the most recent search (MRU 0) occurred</li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#step-3-typedpaths-explorer-path-bar","title":"Step 3 \u2014 TypedPaths (Explorer Path Bar)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#registry-path_1","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#what-it-shows_1","title":"What it shows","text":"<p>Locations typed manually into the Explorer address bar.</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#procedure_2","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths</code> key in Registry Explorer.</li> <li>Document any suspicious entries:<ul> <li>Examples are:<ul> <li><code>\\\\server\\share</code></li> <li>removable drives (E:, F:)</li> <li>staging folders (Temp, Downloads)</li> <li>unusual admin shares (C$)</li> </ul> </li> </ul> </li> <li>TypedPaths does not keep a MRU list, but does keep its entries in order by value name, thus the only timestamp that is available is for the most recent entry which is when the key was updated.</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - TypedPaths](img/ntuser_analysis/03_typedpaths.png)\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#dfir-notes_1","title":"DFIR Notes","text":"<ul> <li>No MRU list</li> <li>Entries are ordered by value name</li> <li>Key LastWrite time reflects the most recent update (most recent entry)</li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#step-4-recentdocs-recent-file-activity","title":"Step 4 \u2014 RecentDocs (Recent File Activity)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#registry-path_2","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#what-it-shows_2","title":"What it shows","text":"<p>Recently opened documents by extension type.</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#procedure_3","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs</code> key in Registry Explorer.</li> <li>Timestamps in the RecentDocs key are identified via MRU lists and the last write times of registry keys. Each key has a timestamp and thus each of the sub-keys of RecentDocs keeps the time of the last file of that type to be opened.</li> <li>These \"extra\" timestamps are collected in the Registry Explorer Recent documents plugin in the Extension Last Opened column. By reviewing this column you can bookend the time periods within which multiple files were opened.</li> <li>The RecentDocs key keeps the order of items opened via its MRU key.</li> <li>For example, if test.doc was opened on 2025-10-10:50:25 UTC and is MRU position 41, that means that the 40 items above it in the list were all opened AFTER 2025-10-10:50:25 UTC.</li> <li>Review the Extension Last Opened column in Registry Explorer and identify the filenames opened around the timeframe of interest and document timestamps.</li> <li>Document drive letters referenced within RecentDocs by looking at the Target Name:<ul> <li>You can search for interesting or sensitive files by searching within the Target Name field</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - RecentDocs plugin view](img/ntuser_analysis/04_recentdocs.png)\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#dfir-notes_2","title":"DFIR Notes","text":"<ul> <li>Uses MRU lists and key LastWrite timestamps</li> <li>Subkeys store \u201cextra timestamps\u201d:</li> <li>Each file-type subkey\u2019s LastWrite = time the last file of that type was opened</li> <li>Registry Explorer plugin includes Extension Last Opened column</li> <li>MRU ordering helps time bounding / bookending</li> <li>If item is MRU position 41 opened at time T, the 40 above it were opened after T</li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#step-5-office-file-mru-full-paths-timestamps","title":"Step 5 \u2014 Office File MRU (Full Paths + Timestamps)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#registry-path-example-for-word-2016","title":"Registry Path (Example for Word 2016+)","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Office\\16.0\\Word\\User MRU\\ADAL_*\\File MRU\n</code></pre> <p>Note: The <code>ADAL_*</code> portion varies per user/environment. You may need to expand the tree to locate it. An example is <code>NTUSER.DAT\\Software\\Microsoft\\Office\\16.0\\Word\\User MRU\\ ADAL_71509F4C9F29E24E25306165B32FE79B68FD54A88446B7C792A3A9D5AB6BB5AE\\File MRU</code></p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#what-it-shows_3","title":"What it shows","text":"<p>Office MRU provides:    - Full path    - Timestamps for every entry    - Duration of access (Last Closed - Last Opened)</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#procedure_4","title":"Procedure","text":"<ol> <li>Navigate to the NTUSER.DAT\\Software\\Microsoft\\Office\\16.0\\Word\\User MRU ADAL_*\\File MRU key in Registry Explorer.</li> <li>Document what drive letters were used to open Office files of interest (like Word documents) during the timeframe of interest (C:, D:, E:, etc.).</li> <li>What drive letters may be Cloud storage like Google Drive? Look for paths like:<ul> <li><code>Google Drive</code></li> <li><code>OneDrive</code></li> <li><code>SharePoint</code></li> </ul> </li> <li>Identify any sensitive files opened (work with the network owner) and how long they were opened for (subtract Last Closed from Last Opened timestamp).</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Office Word File MRU](img/ntuser_analysis/05_office_file_mru.png)\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#step-6-opensavepidlmru-opensave-dialog-artifacts","title":"Step 6 \u2014 OpenSavePidlMRU (Open/Save Dialog Artifacts)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#registry-path_3","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32\\OpenSavePidlMRU\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#what-it-shows_4","title":"What it shows","text":"<p>Files and folders interacted with via Open/Save dialogs. Most of the files referenced in OpenSavePidlMRU are also present in RecentDocs. However, this is a good data source to review largely because it provides full path information not available in RecentDocs.</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#procedure_5","title":"Procedure","text":"<ol> <li>Navigate to the <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32\\OpenSavePidlMRU</code> key in Registry Explorer.</li> <li>Use the full path information available here in the Absolute Path column to look for suspicious or sensitive files opened.</li> <li>Document any suspicious or sensitive files along with the full path.</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - OpenSavePidlMRU absolute paths](img/ntuser_analysis/06_opensavepidlmru.png)\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#dfir-notes_3","title":"DFIR Notes","text":"<ul> <li>Often overlaps with RecentDocs</li> <li>Provides full path info in Registry Explorer plugin (Absolute Path column)</li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#step-7-lastvisitedpidlmru-executable-correlation","title":"Step 7 \u2014 LastVisitedPidlMRU (Executable Correlation)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#registry-path_4","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32\\LastVisitedPidlMRU\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#what-it-shows_5","title":"What it shows","text":"<p>Associates the Open/Save dialog usage with the application executable responsible. </p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#procedure_6","title":"Procedure","text":"<ol> <li>Correlate OpenSavePidlMRU information with application information present in the LastVisitedPidlMRU key.</li> <li>Navigate to the <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32\\LastVisitedPidlMRU</code> key in Registry Explorer.</li> <li>Reference timestamps and the MRU position to attempt to identify the Executable responsible for interacting with the file in question.</li> <li>Only entries with timestamp values in the Opened On column can be validated, others will need more correlating information.</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - LastVisitedPidlMRU executable correlation](img/ntuser_analysis/07_lastvisitedpidlmru.png)\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#dfir-notes_4","title":"DFIR Notes","text":"<ul> <li>Some entries have timestamps in Opened On</li> <li>Only timestamped entries can be validated directly</li> <li>Use MRU order + correlation with OpenSavePidlMRU for weak attribution</li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#step-8-run-key-user-persistence-startup-items","title":"Step 8 \u2014 Run Key (User Persistence / Startup Items)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#registry-path_5","title":"Registry Path","text":"<pre><code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#why-it-matters","title":"Why it matters","text":"<p>This key runs programs on every user logon and is the most common place for malware to add a reference to itself in an attempt to survive a reboot (commonly called a persistence mechanism).</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#procedure_7","title":"Procedure","text":"<ol> <li>In addition to helping discover potential malware, this key also gives an indication of applications installed by the user.</li> <li>Navigate to the <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Run</code> key in Registry Explorer.</li> <li>Document any suspicious entries such as:<ul> <li>executables in <code>AppData\\Roaming</code></li> <li>scripts (<code>.vbs</code>, <code>.ps1</code>, <code>.js</code>, <code>.bat</code>)</li> <li>references to Temp/Downloads</li> <li>suspicious LOLBins (rundll32, regsvr32, mshta)</li> </ul> </li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Run key persistence](img/ntuser_analysis/08_run_key.png)\n</code></pre>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#scaling-analysis-recmd-timeline-explorer","title":"Scaling Analysis \u2013 RECmd + Timeline Explorer","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#why-scale","title":"Why scale?","text":"<p>Registry Explorer is excellent for investigative pivoting, but RECmd enables: - bulk processing across many NTUSER.DAT hives - consistent evidence extraction - CSV outputs suited for timeline correlation</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#use-the-useractivityreb-batch-file","title":"Use the UserActivity.reb Batch File","text":"<p>This workflow assumes <code>UserActivity.reb</code> exists under the <code>Batch</code> directory in your RECmd install path.</p>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#steps","title":"Steps","text":"<ol> <li>Open an Administrator Command Prompt</li> <li>Navigate to RECmd install directory</li> <li>Run RECmd with batch:</li> </ol> <pre><code>RECmd.exe -f \"E:\\C\\Users\\user1\\NTUSER.DAT\" --bn .\\Batch\\UserActivity.reb --csv \"G:\\Evidence\\Registry\"\n</code></pre> <ol> <li>Open output file in Timeline Explorer:       -<code>&lt;timestamp&gt;_RECmd_Batch_UserActivity_Output.csv</code></li> <li>In Timeline Explorer, reset columns:<ul> <li><code>Tools \u2192 Reset column widths</code> (Ctrl+R is the keyboard shortcut)</li> </ul> </li> <li>Focus analysis on:<ul> <li>Description</li> <li>Key Path</li> <li>Value Data</li> </ul> </li> <li>Document interesting findings</li> <li>Review other CSV outputs for individual keys discussed above.</li> </ol>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#evidence-review-guidance-recmd-output","title":"Evidence Review Guidance (RECmd Output)","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#look-for","title":"Look for:","text":"<ul> <li>unusual paths in <code>Value Data</code></li> <li>references to:<ul> <li><code>Temp</code></li> <li><code>Downloads</code></li> <li><code>AppData</code></li> <li><code>\\UNC\\Paths</code></li> <li>external drive letters (E:, F:)</li> </ul> </li> <li>suspicious keywords:<ul> <li><code>password</code></li> <li><code>vpn</code></li> <li><code>putty</code></li> <li><code>winscp</code></li> <li><code>rclone</code></li> <li><code>7zip</code></li> <li><code>keylogger</code></li> <li><code>powershell</code></li> </ul> </li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#evidence-to-document","title":"Evidence to Document","text":""},{"location":"1.Windows/NTUSER_DAT_Analysis/#user-activity-summary","title":"User Activity Summary","text":"<ul> <li>Suspicious searches (WordWheelQuery)</li> <li>Suspicious typed locations (TypedPaths)</li> <li>Recent documents &amp; extension timestamps (RecentDocs)</li> <li>Office file access (File MRU)</li> <li>Full path file access via dialog (OpenSavePidlMRU)</li> <li>Executable attribution (LastVisitedPidlMRU)</li> <li>Persistence artifacts (Run key)</li> </ul>"},{"location":"1.Windows/NTUSER_DAT_Analysis/#recommended-deliverables","title":"Recommended Deliverables","text":"Artifact Key Path Evidence Search terms WordWheelQuery User intent + timeframe via LastWrite Typed paths TypedPaths UNC paths, external drives, staging Recent opened files RecentDocs Filenames, drive letters, time bounding Office documents Office File MRU Full path + timestamps + open duration Open/Save evidence OpenSavePidlMRU Full paths to sensitive/suspicious files Executable correlation LastVisitedPidlMRU App attribution and MRU ordering Persistence Run Logon execution artifacts"},{"location":"1.Windows/NTUSER_DAT_Analysis/#analyst-notes-pitfalls","title":"Analyst Notes / Pitfalls","text":"<ul> <li>Many NTUSER artifacts are MRU-based, not timestamp-based</li> <li>Always document key LastWrite time</li> <li>Validate major conclusions using:<ul> <li>Event logs (Security 4624/4688)</li> <li>Prefetch</li> <li>SRUM</li> <li>Jump Lists</li> <li>File system timestamps</li> </ul> </li> </ul>"},{"location":"1.Windows/System_Profiling/","title":"System Profiling (DFIR)","text":""},{"location":"1.Windows/System_Profiling/#overview","title":"Overview","text":"<p>System Profiling is a foundational DFIR task used to understand the baseline characteristics of a Windows system. This information provides critical context for timeline analysis, anomaly detection, and incident scoping.</p> <p>Through analysis of the SYSTEM and SOFTWARE registry hives, investigators can determine:</p> <ul> <li>System identity and configuration</li> <li>Operating system version and update history</li> <li>Timezone configuration</li> <li>Shutdown and reboot activity</li> <li>Network history (wired, wireless, VPN)</li> <li>Installed applications (including suspicious software)</li> </ul>"},{"location":"1.Windows/System_Profiling/#registry-artifacts","title":"Registry Artifacts","text":""},{"location":"1.Windows/System_Profiling/#system-hive","title":"SYSTEM Hive","text":"<p>Path: <code>C:\\Windows\\System32\\config\\SYSTEM</code></p>"},{"location":"1.Windows/System_Profiling/#software-hive","title":"SOFTWARE Hive","text":"<p>Path: <code>C:\\Windows\\System32\\config\\SOFTWARE</code></p>"},{"location":"1.Windows/System_Profiling/#tools-used","title":"Tools Used","text":"<ul> <li>Registry Explorer (Eric Zimmerman)</li> <li>RECmd.exe (Eric Zimmerman)</li> </ul>"},{"location":"1.Windows/System_Profiling/#investigative-steps-system-hive","title":"Investigative Steps \u2013 SYSTEM Hive","text":""},{"location":"1.Windows/System_Profiling/#step-1-prep-system-hive-in-registry-explorer","title":"Step 1 \u2014 Prep SYSTEM Hive in Registry Explorer","text":""},{"location":"1.Windows/System_Profiling/#procedure","title":"Procedure","text":"<ol> <li>Launch Registry Explorer</li> <li>Select File \u2192 Load Hive</li> <li>Browse to the offline SYSTEM hive  <ul> <li>Example: <code>E:\\C\\Windows\\System32\\config\\SYSTEM</code></li> </ul> </li> <li>If a dirty hive is detected, select Yes</li> <li>Click OK to select transaction logs (skip if not prompted)</li> <li>Highlight <code>SYSTEM.LOG1</code> and <code>SYSTEM.LOG2</code> (CTRL + click) and select Open</li> <li>Click OK to replay transaction logs</li> <li>Save the cleaned hive (example: <code>SYSTEM_clean</code>)</li> <li>Select Yes to load the updated hive</li> <li>Select No when prompted to load the dirty hive</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Load SYSTEM hive](img/system_profiling/01_load_system_hive.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#step-2-identify-the-currentcontrolset","title":"Step 2 \u2014 Identify the CurrentControlSet","text":""},{"location":"1.Windows/System_Profiling/#registry-path","title":"Registry Path","text":"<pre><code>SYSTEM\\Select\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task","title":"Task","text":"<p>Identify the value of Current, which determines the active control set.</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - SYSTEM Select key](img/system_profiling/02_currentcontrolset.png)\n</code></pre> <p>Example Interpretation - <code>Current = 1</code> \u2192 <code>CurrentControlSet = ControlSet001</code></p>"},{"location":"1.Windows/System_Profiling/#step-3-identify-the-computer-name","title":"Step 3 \u2014 Identify the Computer Name","text":""},{"location":"1.Windows/System_Profiling/#registry-path_1","title":"Registry Path","text":"<pre><code>SYSTEM\\&lt;CurrentControlSet&gt;\\Control\\ComputerName\\ComputerName\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_1","title":"Task","text":"<p>Document the ComputerName of the system.</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - ComputerName](img/system_profiling/03_computername.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#step-4-determine-the-system-timezone","title":"Step 4 \u2014 Determine the System Timezone","text":""},{"location":"1.Windows/System_Profiling/#registry-path_2","title":"Registry Path","text":"<pre><code>SYSTEM\\&lt;CurrentControlSet&gt;\\Control\\TimeZoneInformation\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_2","title":"Task","text":"<p>Document the timezone the system was last set to.</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - TimeZoneInformation](img/system_profiling/04_timezone.png)\n</code></pre> <p>DFIR Significance - Timezone is critical for timeline normalization - Prevents misinterpretation of event log and registry timestamps</p>"},{"location":"1.Windows/System_Profiling/#step-5-last-shutdown-reboot-time","title":"Step 5 \u2014 Last Shutdown / Reboot Time","text":""},{"location":"1.Windows/System_Profiling/#registry-path_3","title":"Registry Path","text":"<pre><code>SYSTEM\\&lt;CurrentControlSet&gt;\\Control\\Windows\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_3","title":"Task","text":"<ul> <li>Identify timestamp values stored as Windows FILETIME</li> <li>Right-click the value \u2192 Data Interpreter</li> <li>Convert to human-readable time</li> <li>Document the last shutdown or reboot</li> </ul> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Last shutdown time](img/system_profiling/05_last_shutdown.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#step-6-network-interface-profiling","title":"Step 6 \u2014 Network Interface Profiling","text":""},{"location":"1.Windows/System_Profiling/#registry-path_4","title":"Registry Path","text":"<pre><code>SYSTEM\\&lt;CurrentControlSet&gt;\\Services\\Tcpip\\Parameters\\Interfaces\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_4","title":"Task","text":"<p>Review network interface subkeys and document: - <code>DhcpDomain</code> - Interfaces associated with unusual or suspicious networks</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Network interfaces](img/system_profiling/06_network_interfaces.png)\n</code></pre> <p>DFIR Notes - Interfaces may persist long after a network is no longer used - Useful for identifying corporate vs. home vs. attacker infrastructure</p>"},{"location":"1.Windows/System_Profiling/#investigative-steps-software-hive","title":"Investigative Steps \u2013 SOFTWARE Hive","text":""},{"location":"1.Windows/System_Profiling/#step-1-prep-software-hive-in-registry-explorer","title":"Step 1 \u2014 Prep SOFTWARE Hive in Registry Explorer","text":""},{"location":"1.Windows/System_Profiling/#procedure_1","title":"Procedure","text":"<ol> <li>Launch Registry Explorer</li> <li>Select File \u2192 Load Hive</li> <li>Browse to: <code>E:\\C\\Windows\\System32\\config\\SOFTWARE</code></li> <li>If dirty hive detected, select Yes</li> <li>Select <code>SOFTWARE.LOG1</code> and <code>SOFTWARE.LOG2</code></li> <li>Replay transaction logs</li> <li>Save cleaned hive as <code>SOFTWARE_clean</code></li> <li>Load the updated hive</li> <li>Do not load the dirty hive</li> </ol> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Load SOFTWARE hive](img/system_profiling/07_load_software_hive.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#step-2-os-version-install-information","title":"Step 2 \u2014 OS Version &amp; Install Information","text":""},{"location":"1.Windows/System_Profiling/#registry-path_5","title":"Registry Path","text":"<pre><code>SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_5","title":"Task","text":"<p>Document:    - Windows Version    - RegisteredOwner    - ReleaseID    - CurrentBuild    - InstallTime (convert using Data Interpreter)</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - OS version info](img/system_profiling/08_os_version.png)\n</code></pre> <p>\u26a0\ufe0f Important Interpretation Note  Be careful with your interpretation of \"InstallTime\". This value could be the time the OS was first installed, but more commonly represents the last major update of the system. Starting with Windows 10, Microsoft began releasing frequent major version updates and hence this time typically represents the last update.  This information will be very helpful as you will notice many timestamps set to around this time, indicating the update, not user activity was responsible.</p>"},{"location":"1.Windows/System_Profiling/#step-3-previous-windows-versions","title":"Step 3 \u2014 Previous Windows Versions","text":""},{"location":"1.Windows/System_Profiling/#registry-path_6","title":"Registry Path","text":"<pre><code>SYSTEM\\Setup\\Source OS\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_6","title":"Task","text":"<p>Document:    - Number of previous OS versions    - ReleaseID and CurrentBuild of previous OS    - InstallTime (human-readable)</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Source OS](img/system_profiling/09_source_os.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#step-4-network-history-known-networks","title":"Step 4 \u2014 Network History (Known Networks)","text":""},{"location":"1.Windows/System_Profiling/#registry-path_7","title":"Registry Path","text":"<pre><code>SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\n</code></pre>"},{"location":"1.Windows/System_Profiling/#procedure_2","title":"Procedure","text":"<ul> <li>Open the Known Networks tab in Registry Explorer</li> </ul>"},{"location":"1.Windows/System_Profiling/#task_7","title":"Task","text":"<p>Document:    - Wireless networks       - First Connect time       - Last Connected time    - Likely non-managed networks (home/public)       - First Connect time       - Last Connected time    - WWAN (VPN) networks       - First Connect time       - Last Connected time</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Known Networks](img/system_profiling/10_known_networks.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#step-5-managed-network-identification","title":"Step 5 \u2014 Managed Network Identification","text":""},{"location":"1.Windows/System_Profiling/#registry-path_8","title":"Registry Path","text":"<pre><code>SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_8","title":"Task","text":"<p>Document which networks are marked as Managed (typically domain/corporate).</p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - Network signatures](img/system_profiling/11_network_signatures.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#step-6-installed-64-bit-applications","title":"Step 6 \u2014 Installed 64-bit Applications","text":""},{"location":"1.Windows/System_Profiling/#registry-path_9","title":"Registry Path","text":"<pre><code>SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_9","title":"Task","text":"<p>Document:    - Web browsers    - Security tools    - Suspicious software    - Install paths from <code>TEMP</code> or <code>Downloads</code></p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - 64-bit applications](img/system_profiling/12_installed_apps_64.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#step-7-installed-32-bit-applications","title":"Step 7 \u2014 Installed 32-bit Applications","text":""},{"location":"1.Windows/System_Profiling/#registry-path_10","title":"Registry Path","text":"<pre><code>SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\n</code></pre>"},{"location":"1.Windows/System_Profiling/#task_10","title":"Task","text":"<p>Document:    - Security tools    - Suspicious software    - Install paths from <code>TEMP</code> or <code>Downloads</code></p> <p>\ud83d\udcf8 Example Screenshot</p> <pre><code>![Registry Explorer - 32-bit applications](img/system_profiling/13_installed_apps_32.png)\n</code></pre>"},{"location":"1.Windows/System_Profiling/#recmdexe-automation-system-profiling-at-scale","title":"RECmd.exe Automation (System Profiling at Scale)","text":""},{"location":"1.Windows/System_Profiling/#example-recmd-execution","title":"Example RECmd Execution","text":"<pre><code>RECmd.exe -f \"C:\\Cases\\Hives\\SYSTEM\" --csv \"C:\\Cases\\Output\\RECmd\" --csvf SYSTEM_Profile.csv\nRECmd.exe -f \"C:\\Cases\\Hives\\SOFTWARE\" --csv \"C:\\Cases\\Output\\RECmd\" --csvf SOFTWARE_Profile.csv\n</code></pre>"},{"location":"1.Windows/System_Profiling/#example-recmd-reb-snippet","title":"Example RECmd .reb (Snippet)","text":"<pre><code>&lt;RegistryExplorerBatch&gt;\n  &lt;RegistryKey&gt;\n    &lt;HivePath&gt;%%hivepath%%&lt;/HivePath&gt;\n    &lt;KeyPath&gt;SYSTEM\\Select&lt;/KeyPath&gt;\n    &lt;Comment&gt;Determine CurrentControlSet&lt;/Comment&gt;\n  &lt;/RegistryKey&gt;\n\n  &lt;RegistryKey&gt;\n    &lt;HivePath&gt;%%hivepath%%&lt;/HivePath&gt;\n    &lt;KeyPath&gt;SYSTEM\\ControlSet001\\Control\\ComputerName\\ComputerName&lt;/KeyPath&gt;\n    &lt;Comment&gt;System Computer Name&lt;/Comment&gt;\n  &lt;/RegistryKey&gt;\n\n  &lt;RegistryKey&gt;\n    &lt;HivePath&gt;%%hivepath%%&lt;/HivePath&gt;\n    &lt;KeyPath&gt;SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion&lt;/KeyPath&gt;\n    &lt;Comment&gt;OS Version and Install Info&lt;/Comment&gt;\n  &lt;/RegistryKey&gt;\n&lt;/RegistryExplorerBatch&gt;\n</code></pre>"},{"location":"1.Windows/System_Profiling/#evidence-to-document","title":"Evidence to Document","text":""},{"location":"1.Windows/System_Profiling/#system-profile-summary","title":"System Profile Summary","text":"<ul> <li>System Name</li> <li>Operating System</li> <li>Install / Last Major Update Time</li> <li>Timezone</li> <li>Last Shutdown / Reboot Time</li> <li>Interesting Networks</li> <li>VPN / WWAN Activity</li> <li>Suspicious Installed Applications</li> </ul>"},{"location":"1.Windows/System_Profiling/#analyst-notes","title":"Analyst Notes","text":"<ul> <li>Many timestamps align with feature updates, not user activity</li> <li>Network artifacts persist long after disconnection</li> <li>Always correlate with:<ul> <li>Event Logs</li> <li>Prefetch</li> <li>SRUM</li> <li>Firewall logs</li> <li>VPN client logs</li> </ul> </li> </ul>"},{"location":"1.Windows/User_Account_Profiling/","title":"User Account Profiling (SAM Hive)","text":""},{"location":"1.Windows/User_Account_Profiling/#overview","title":"Overview","text":"<p>User Account Profiling is a DFIR activity focused on identifying local accounts, built-in system accounts, and Microsoft/cloud-linked accounts, then extracting evidence such as:</p> <ul> <li>Account Name</li> <li>RID</li> <li>Whether it\u2019s a Cloud/Microsoft account</li> <li>Email tied to the account</li> <li>Last Logon timestamp</li> </ul> <p>This work is commonly performed by analyzing the SAM Registry hive.</p>"},{"location":"1.Windows/User_Account_Profiling/#artifact-location","title":"Artifact Location","text":""},{"location":"1.Windows/User_Account_Profiling/#registry-hive-key","title":"Registry Hive / Key","text":"<p>SAM <code>SAM\\Domains\\Account\\Users</code></p>"},{"location":"1.Windows/User_Account_Profiling/#forensic-relevance","title":"Forensic Relevance","text":"<p>The <code>Users</code> key contains the system\u2019s local account database, including:</p> <ul> <li>Account name and RID (Relative Identifier)</li> <li>Last Logon time</li> <li>Password metadata (last change time)</li> <li>Login counters</li> <li>Group membership indicators</li> <li>Markers indicating Microsoft/cloud accounts, such as values with <code>Internet</code> in their name</li> </ul> <p>This hive is extremely useful for:</p> <ul> <li>Identifying suspicious accounts (unknown admins, rogue local accounts)</li> <li>Finding recently active accounts (Last Login)</li> <li>Determining whether built-in accounts were used</li> <li>Mapping accounts into the timeline of compromise</li> </ul> <p>\u26a0\ufe0f Note: SAM hive data is not the full source of truth for all auth activity. Always validate logon activity with Security log events (4624/4625) and other sources.</p>"},{"location":"1.Windows/User_Account_Profiling/#tools","title":"Tools","text":""},{"location":"1.Windows/User_Account_Profiling/#primary-tools-used","title":"Primary tools used","text":"<ul> <li>Registry Explorer (Eric Zimmerman)</li> <li>RECmd.exe (Eric Zimmerman)</li> </ul>"},{"location":"1.Windows/User_Account_Profiling/#data-acquisition-recommended","title":"Data Acquisition (Recommended)","text":"<p>Collect the following: - <code>C:\\Windows\\System32\\config\\SAM</code> - <code>C:\\Windows\\System32\\config\\SYSTEM</code> (needed to decrypt SAM in some workflows)</p> <p>If you're using KAPE, include modules/targets for SAM + SYSTEM hives.</p>"},{"location":"1.Windows/User_Account_Profiling/#investigative-workflow","title":"Investigative Workflow","text":""},{"location":"1.Windows/User_Account_Profiling/#step-1-parse-sam-users-with-registry-explorer","title":"Step 1 \u2014 Parse SAM Users with Registry Explorer","text":""},{"location":"1.Windows/User_Account_Profiling/#goal","title":"Goal","text":"<p>Use Registry Explorer\u2019s built-in parsing for <code>Users</code> to quickly enumerate accounts and metadata.</p>"},{"location":"1.Windows/User_Account_Profiling/#procedure","title":"Procedure","text":"<ol> <li>Open Registry Explorer</li> <li>Load the SAM hive</li> <li>Navigate to:       -<code>SAM\\Domains\\Account\\Users</code></li> <li>Select the Users key</li> <li>After selecting the Users key, in the data viewing pane, select the User accounts Tab at the top of the pane and view the data parsed by the Registry Explorer plugin</li> </ol> <p>\ud83d\udcf8 Screenshot Example (add yours here):</p> <p><pre><code>![Registry Explorer - SAM Users User accounts tab](img/user_account_profiling/01_registry_explorer_users_tab.png)\n</code></pre> 6. The first column in the Registry Explorer User Accounts plugin-in is named User Id and represents a value Microsoft calls the \"Relative Identifier (RID)\". RID values of 1000 or higher are reserved for user accounts and those below that value are used for system accounts. Document:       - How many user accounts are present in this SAM hive?</p> <p>\ud83d\udcf8 Screenshot Example:</p> <pre><code>![Registry Explorer - Sorted RIDs](img/user_account_profiling/02_sorted_by_rid.png)\n</code></pre> <ol> <li>What are the User Names of the accounts of interest and document their User Id values.</li> </ol> <p>\ud83d\udcf8 Screenshot Example:</p> <pre><code>![Registry Explorer - Accounts of interest highlighted](img/user_account_profiling/03_accounts_of_interest.png)\n</code></pre> <p>Example documentation format:</p> User Name RID Notes Administrator 500 Built-in Guest 501 Built-in jsnow 1002 Account of interest svc-backup 1004 Suspicious service account <ol> <li>What Groups are the accounts of interest a member of? Annotate any Group memberships that have Administrative rights.</li> </ol> <p>\ud83d\udcf8 Screenshot Example:</p> <pre><code>![Registry Explorer - Group memberships view](img/user_account_profiling/04_group_memberships.png)\n</code></pre> <ol> <li>Document the Last Login Time for the account(s) of interest.<ul> <li>Why might the Total Login Count = 0 for the account of interest?  New Microsoft Accounts no longer update this value within the SAM. Since there is a Last Login Time we would expect Total Login Count to be greater than zero.</li> </ul> </li> </ol> <p>\ud83d\udcf8 Screenshot Example:</p> <pre><code>![Registry Explorer - Last login time](img/user_account_profiling/05_last_login_time.png)\n</code></pre> <ol> <li>How many of the built-in system accounts (RID &lt; 1000) have been used on the system?</li> </ol> <p>\ud83d\udcf8 Screenshot Example:</p> <p><pre><code>![Registry Explorer - Built-in accounts usage](img/user_account_profiling/06_builtin_accounts_used.png)\n</code></pre> Analysis Tip: Common built-in accounts - 500 Administrator - 501 Guest - 502 KRBTGT (domain controllers) - Other service/system accounts depending on context</p> <ol> <li>What is the Invalid Login Count for the any Administrator accounts?</li> </ol> <p>\ud83d\udcf8 Screenshot Example:</p> <pre><code>![Registry Explorer - Invalid login counts](img/user_account_profiling/07_invalid_login_count.png)\n</code></pre> <p>Analysis Tip: Interpretation notes - Elevated invalid counts may indicate:   - brute force attempts   - password spraying   - credential stuffing   - misconfigured service using stale password</p> <ol> <li>Why might the Last Password Change time be before the account Created On time of the account of interest?  Major system updates are known to change a lot of timestamps in the Windows Registry. This is a known phenomenon for major Windows updates,  document the last system update time to validate.</li> <li>he raw data for user accounts in the SAM hive are stored as sub-keys under the Users key. Each account has a sub-key named according to the hex representation of its Relative Identifier (RID). For example the hex value for RID 1002 is 3EA. Examine the accounts of interest.</li> </ol> <p>\ud83d\udcf8 Screenshot Example:</p> <pre><code>![Registry Explorer - User subkey 000003EA](img/user_account_profiling/08_hex_rid_subkey.png)\n</code></pre> <ol> <li>How we can tell a particular account is a Microsoft (Cloud) Account are the values with \"Internet\" in their names. Click on the InternetUserName value and look at the raw data in the Type Viewer pane. Document the email account associated with the accounts of interest.</li> </ol> <p>\ud83d\udcf8 Screenshot Example:</p> <pre><code>![Registry Explorer - InternetUserName raw view](img/user_account_profiling/09_internetusername_raw.png)\n</code></pre>"},{"location":"1.Windows/User_Account_Profiling/#recmdexe-workflow-evidence-at-scale","title":"RECmd.exe Workflow (Evidence at Scale)","text":"<p>Registry Explorer is great for interactive analysis; RECmd is how you scale and automate.</p>"},{"location":"1.Windows/User_Account_Profiling/#example-recmd-execution","title":"Example RECmd Execution","text":""},{"location":"1.Windows/User_Account_Profiling/#run-recmd-against-sam-using-a-reb","title":"Run RECmd against SAM using a .reb","text":"<pre><code>RECmd.exe -f \"C:\\Cases\\Hives\\SAM\" --csv \"C:\\Cases\\Output\\RECmd\" --csvf SAM_UserAccounts.csv\n</code></pre>"},{"location":"1.Windows/User_Account_Profiling/#recommended-approach","title":"Recommended approach","text":"<p>Create a <code>.reb</code> that targets: - <code>SAM\\Domains\\Account\\Users</code> - account subkeys - values containing <code>Internet</code></p>"},{"location":"1.Windows/User_Account_Profiling/#example-recmd-reb-snippet","title":"Example RECmd .reb (Snippet)","text":"<p>Save as: <code>REB/SAM_UserAccount_Profiling.reb</code></p> <pre><code>&lt;RegistryExplorerBatch&gt;\n  &lt;RegistryKey&gt;\n    &lt;HivePath&gt;%%hivepath%%&lt;/HivePath&gt;\n    &lt;KeyPath&gt;SAM\\Domains\\Account\\Users&lt;/KeyPath&gt;\n    &lt;Recursive&gt;false&lt;/Recursive&gt;\n    &lt;Comment&gt;Enumerate local users from SAM&lt;/Comment&gt;\n  &lt;/RegistryKey&gt;\n\n  &lt;RegistryKey&gt;\n    &lt;HivePath&gt;%%hivepath%%&lt;/HivePath&gt;\n    &lt;KeyPath&gt;SAM\\Domains\\Account\\Users\\Names&lt;/KeyPath&gt;\n    &lt;Recursive&gt;true&lt;/Recursive&gt;\n    &lt;Comment&gt;Account name mapping&lt;/Comment&gt;\n  &lt;/RegistryKey&gt;\n\n  &lt;RegistryKey&gt;\n    &lt;HivePath&gt;%%hivepath%%&lt;/HivePath&gt;\n    &lt;KeyPath&gt;SAM\\Domains\\Account\\Users&lt;/KeyPath&gt;\n    &lt;Recursive&gt;true&lt;/Recursive&gt;\n    &lt;Comment&gt;Look for InternetUserName values indicating Microsoft accounts&lt;/Comment&gt;\n  &lt;/RegistryKey&gt;\n&lt;/RegistryExplorerBatch&gt;\n</code></pre> <p>You can tune recursion and filter output further once you test against real hives.</p>"},{"location":"1.Windows/User_Account_Profiling/#evidence-output-requirements","title":"Evidence Output Requirements","text":"<p>At the end of this workflow, you should be able to report:</p> Account Name RID Cloud Account Email Last Logged On jsnow 1002 Yes jsnow@outlook.com 2025-12-10 14:22:01Z svc-backup 1004 No N/A 2025-12-05 09:13:12Z"},{"location":"1.Windows/User_Account_Profiling/#analyst-notes-pitfalls","title":"Analyst Notes / Pitfalls","text":"<ul> <li>SAM timestamps can be affected by system updates and registry operations</li> <li>Total Login Count may be unreliable for Microsoft accounts</li> <li>Always correlate with:</li> <li>Event logs (4624/4625/4672)</li> <li>RDP logs</li> <li>LSA secrets (if applicable)</li> <li>Browser artifacts for email account reuse</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/","title":"Windows Services Persistence (DFIR)","text":"<p>This document provides a Digital Forensics &amp; Incident Response (DFIR)\u2013focused overview of Windows Services as a persistence mechanism.</p> <p>Windows services are one of the most common and resilient ways attackers maintain access because they:</p> <ul> <li>execute with elevated privileges</li> <li>can start automatically at boot or logon</li> <li>may run without user interaction</li> <li>blend in with legitimate system services</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Windows Services Overview</li> <li>Service Registry Location</li> <li>How Services Work</li> <li>Service Accounts</li> <li>Persistence-Relevant Settings</li> <li>Start Values and Persistence</li> <li>Forensic Value</li> <li>Key Data Points</li> <li>Examples of Malicious Service Tradecraft</li> <li>How to Investigate Services</li> <li>Tools and Commands</li> <li>Evasion Techniques</li> </ol>"},{"location":"1.Windows/Windows_Services_Persistence/#windows-services-overview","title":"Windows Services Overview","text":"<p>A Windows Service is a long-running executable (or driver) managed by the Service Control Manager (SCM). Services can:</p> <ul> <li>start during system boot</li> <li>start automatically at logon</li> <li>start on demand</li> <li>restart on failure</li> </ul> <p>Services are frequently used by:</p> <ul> <li>operating system components</li> <li>device drivers</li> <li>enterprise security tooling</li> <li>endpoint management platforms</li> </ul> <p>Attackers abuse services because they provide:</p> <ul> <li>privileged persistence</li> <li>reliable execution</li> <li>a mechanism that can survive reboots</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#service-registry-location","title":"Service Registry Location","text":""},{"location":"1.Windows/Windows_Services_Persistence/#persistence-location","title":"Persistence Location","text":"<pre><code>HKLM\\SYSTEM\\CurrentControlSet\\Services\n</code></pre> <p>This key contains:</p> <ul> <li>service configurations</li> <li>device driver configurations</li> <li>parameters for each service/driver</li> <li>executable path and launch settings</li> </ul> <p>Offline path:</p> <ul> <li>Hive: <code>SYSTEM</code></li> <li>File location: <code>C:\\Windows\\System32\\config\\SYSTEM</code></li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#how-services-work","title":"How Services Work","text":"<p>Services are controlled by the Service Control Manager (SCM).</p> <p>Key concepts:</p> <ul> <li>SCM loads service configuration from registry</li> <li>SCM starts services based on the <code>Start</code> value</li> <li>Services can be configured to restart on failure</li> <li>Many services run without interactive desktops</li> </ul> <p>Services can be:</p> <ul> <li>user-mode services (<code>.exe</code>)</li> <li>kernel-mode drivers (<code>.sys</code>)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#service-accounts","title":"Service Accounts","text":"<p>Services typically run under one of these built-in accounts:</p>"},{"location":"1.Windows/Windows_Services_Persistence/#localsystem","title":"LocalSystem","text":"<ul> <li>Highest default privilege on the local machine</li> <li>Has extensive local rights</li> <li>Can access network as the computer account (<code>DOMAIN\\\\HOSTNAME$</code>)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#localservice","title":"LocalService","text":"<ul> <li>Limited local privileges</li> <li>Uses anonymous credentials on the network</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#networkservice","title":"NetworkService","text":"<ul> <li>Limited local privileges</li> <li>Uses the computer account on the network</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#custom-service-accounts","title":"Custom Service Accounts","text":"<ul> <li>Domain user accounts</li> <li>Managed Service Accounts (MSA/gMSA)</li> </ul> <p>DFIR Tip: Persistence is more suspicious when:</p> <ul> <li>a service runs as LocalSystem but does not need to</li> <li>a service uses an unexpected domain account</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#persistence-relevant-settings","title":"Persistence-Relevant Settings","text":"<p>Each service has a registry subkey:</p> <pre><code>HKLM\\SYSTEM\\CurrentControlSet\\Services\\&lt;ServiceName&gt;\n</code></pre> <p>Common values include:</p> <ul> <li><code>ImagePath</code> \u2013 binary path or driver path</li> <li><code>Start</code> \u2013 startup type</li> <li><code>Type</code> \u2013 service vs driver</li> <li><code>ObjectName</code> \u2013 the account used to run the service</li> <li><code>Description</code></li> <li><code>DisplayName</code></li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#start-values-and-persistence","title":"Start Values and Persistence","text":"<p>The <code>Start</code> value determines when the service/driver loads.</p> Start Value (Hex) Meaning Persistence Impact <code>0x00</code> Boot (driver) Very high \u2013 loads during boot (drivers) <code>0x01</code> System High \u2013 loads early <code>0x02</code> Automatic High \u2013 starts automatically <code>0x03</code> Manual Medium \u2013 requires trigger <code>0x04</code> Disabled None (unless modified)"},{"location":"1.Windows/Windows_Services_Persistence/#why-0x02-and-0x00-matter","title":"Why <code>0x02</code> and <code>0x00</code> Matter","text":"<ul> <li><code>0x02</code> services ensure malware runs after reboot</li> <li><code>0x00</code> boot-start drivers can run before many security controls initialize</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#forensic-value","title":"Forensic Value","text":"<p>Services help answer:</p> <ul> <li>How did persistence occur?</li> <li>Was a new service created or an existing service modified?</li> <li>What binary executed and where is it located?</li> <li>What account/privilege context is used?</li> <li>Was failure recovery configured to execute malware?</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#key-data-points","title":"Key Data Points","text":"<p>When analyzing a suspicious service, extract:</p> <ul> <li><code>ServiceName</code> (registry key name)</li> <li><code>DisplayName</code> and <code>Description</code></li> <li><code>ImagePath</code> (target binary)</li> <li><code>Start</code> type</li> <li><code>Type</code> (service vs driver)</li> <li><code>ObjectName</code> (account)</li> <li>service DLL / parameters if present</li> <li>timestamps (registry key last write)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#examples-of-malicious-service-tradecraft","title":"Examples of Malicious Service Tradecraft","text":""},{"location":"1.Windows/Windows_Services_Persistence/#1-new-service-creation-apt1-example","title":"1) New Service Creation (APT1 Example)","text":"<p>Technique: Create a new service pointing to a malicious binary.</p> <p>Example:</p> <ul> <li>Service name: <code>IPRIP</code></li> <li>Display name: <code>RIP Listener Service</code></li> </ul> <p>Registry Example (Registry Explorer):</p> <pre><code>Key: ...\\Services\\IPRIP\nImagePath: \"C:\\Windows\\Temp\\iprip.exe\"\nStart: 0x02\nObjectName: LocalSystem\nDisplayName: RIP Listener Service\n</code></pre> <p>Forensic indicators:</p> <ul> <li>Service name not aligned with vendor</li> <li>Binary in <code>Temp</code> / user-writable path</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#2-service-replacement-glassrat-example","title":"2) Service Replacement (GlassRAT Example)","text":"<p>Technique: Replace a legitimate but disabled service with a malicious payload.</p> <p>Known example:</p> <ul> <li>Service: <code>RasAuto</code> (Remote Access Auto Connection Manager)</li> <li>Attacker replaces <code>ImagePath</code> to point to malicious executable</li> </ul> <p>Registry Example:</p> <pre><code>Key: ...\\Services\\RasAuto\nImagePath: \"C:\\ProgramData\\rasauto.exe\"\nStart: 0x02\n</code></pre> <p>Forensic indicators:</p> <ul> <li>Service name is legitimate</li> <li>Binary path is not</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#3-service-failure-recovery-abuse","title":"3) Service Failure Recovery Abuse","text":"<p>Technique: Configure failure actions to launch malware.</p> <p>Attacker approach:</p> <ul> <li>Force service to crash</li> <li>Configure failure recovery to execute malicious binary</li> </ul> <p>Evidence may include:</p> <ul> <li>unusual <code>FailureActions</code></li> <li>unexpected <code>sc failure</code> configuration</li> </ul> <p>Example Behavior:</p> <pre><code>sc failure \"Spooler\" reset= 0 actions= restart/5000/run/5000\nsc failureflag \"Spooler\" 1\n</code></pre> <p>Forensic indicators:</p> <ul> <li>critical service failure actions running unknown executables</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#how-to-investigate-services","title":"How to Investigate Services","text":""},{"location":"1.Windows/Windows_Services_Persistence/#services-persistence-triage-checklist","title":"Services Persistence Triage Checklist","text":"<p>Use this checklist during incident response to quickly assess whether a service is likely malicious.</p>"},{"location":"1.Windows/Windows_Services_Persistence/#1-identify-high-risk-services-first","title":"1) Identify High-Risk Services First","text":"<ul> <li> Newly created service names (not present in baseline)</li> <li> Recently modified service keys (LastWrite time on <code>...\\Services\\&lt;Name&gt;</code>)</li> <li> Services with Start = 0x02 (Automatic) unexpectedly</li> <li> Drivers with Start = 0x00 (Boot) or <code>0x01 (System)</code> that are unknown</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#2-validate-service-identity","title":"2) Validate Service Identity","text":"<ul> <li> Does <code>DisplayName</code> / <code>Description</code> match expected vendor/software?</li> <li> Does the service name masquerade as Windows (e.g., <code>Windows Audio Driver</code>, <code>Update Service</code>)?</li> <li> Is the service name similar to legitimate service names (typosquatting)?</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#3-inspect-imagepath-parameters","title":"3) Inspect ImagePath &amp; Parameters","text":"<ul> <li> <p> Does <code>ImagePath</code> point to user-writable locations?</p> </li> <li> <p><code>C:\\Users\\Public</code></p> </li> <li><code>%AppData%</code> / <code>%LocalAppData%</code></li> <li><code>%Temp%</code></li> <li><code>C:\\ProgramData</code></li> <li><code>C:\\Windows\\Temp</code></li> <li> Is the binary signed and from an expected publisher?</li> <li> <p> Are there suspicious command line patterns?</p> </li> <li> <p><code>powershell.exe -enc</code></p> </li> <li><code>cmd.exe /c</code></li> <li><code>rundll32.exe</code></li> <li><code>mshta.exe</code></li> <li><code>.vbs</code>, <code>.js</code>, <code>.ps1</code></li> <li> Is there unusual quoting or spacing in the path (common evasion)?</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#4-accountprivilege-context-objectname","title":"4) Account/Privilege Context (ObjectName)","text":"<ul> <li> Runs as LocalSystem when not expected</li> <li> Runs as NetworkService/LocalService but points to suspicious binary</li> <li> Runs as a domain user or custom account unexpectedly</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#5-startup-behavior","title":"5) Startup Behavior","text":"<ul> <li> <code>Start</code> type appears inconsistent with service function</li> <li> Service set to auto-start but should be manual</li> <li> Disabled service (<code>0x04</code>) was changed to auto-start</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#6-failure-recovery-failureactions-abuse","title":"6) Failure Recovery / FailureActions Abuse","text":"<ul> <li> Failure actions configured unusually (restart loops)</li> <li> Failure actions set to execute programs (launch malware)</li> <li> Service appears intentionally crashing to trigger failure recovery</li> </ul> <p>Use:</p> <pre><code>sc qfailure &lt;ServiceName&gt;\n</code></pre>"},{"location":"1.Windows/Windows_Services_Persistence/#7-correlate-with-logs","title":"7) Correlate With Logs","text":"<ul> <li> System log: 7045 (service installed)</li> <li> System log: 7036 (service state changed)</li> <li> Security log: 4697 (service installed \u2014 if enabled)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#8-correlate-with-execution-artifacts","title":"8) Correlate With Execution Artifacts","text":"<ul> <li> Prefetch shows service executable execution</li> <li> Amcache records dropped service binary hash</li> <li> ShimCache indicates presence of service payload</li> <li> BAM/DAM corroborates user-context execution (if applicable)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#9-containment-evidence","title":"9) Containment &amp; Evidence","text":"<ul> <li> Preserve SYSTEM hive + EVTX logs</li> <li> Collect the service binary and compute hashes</li> <li> Capture service configuration output:</li> </ul> <pre><code>sc qc &lt;ServiceName&gt;\nsc qfailure &lt;ServiceName&gt;\n</code></pre>"},{"location":"1.Windows/Windows_Services_Persistence/#quick-triage-questions","title":"Quick Triage Questions","text":"<ul> <li>Is this service new or recently modified?</li> <li>Does <code>ImagePath</code> point to a legitimate signed binary?</li> <li>Is the binary located in a user-writable directory?</li> <li>Is <code>Start</code> set to <code>0x02</code> (Automatic) unexpectedly?</li> <li>Is the service running as LocalSystem?</li> <li>Are failure actions configured unusually?</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#recommended-indicator-list-services-persistence-hunting","title":"Recommended Indicator List (Services Persistence Hunting)","text":"<p>Use this list to pivot quickly when reviewing services via Autoruns, <code>sc</code>, Registry Explorer/RECmd output, or EVTX parsing.</p>"},{"location":"1.Windows/Windows_Services_Persistence/#high-signal-lolbins-service-abuse-targets","title":"High-Signal LOLBins / Service Abuse Targets","text":"<p>Search for these executables appearing in <code>ImagePath</code> or parameters:</p> <ul> <li><code>powershell.exe</code> / <code>pwsh.exe</code></li> <li><code>cmd.exe</code></li> <li><code>rundll32.exe</code></li> <li><code>regsvr32.exe</code></li> <li><code>mshta.exe</code></li> <li><code>wscript.exe</code> / <code>cscript.exe</code></li> <li><code>bitsadmin.exe</code></li> <li><code>certutil.exe</code></li> <li><code>schtasks.exe</code> (often used alongside services)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#suspicious-command-line-patterns","title":"Suspicious Command-Line Patterns","text":"<ul> <li><code>-enc</code> / <code>-encodedcommand</code></li> <li><code>IEX</code> / <code>Invoke-Expression</code></li> <li><code>FromBase64String</code></li> <li><code>DownloadString</code></li> <li><code>WebClient</code></li> <li><code>Start-Process</code></li> <li><code>Hidden</code> / <code>WindowStyle Hidden</code></li> <li> <p>DLL execution patterns:</p> </li> <li> <p><code>rundll32.exe &lt;dll&gt;,&lt;export&gt;</code></p> </li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#high-risk-paths-for-service-binaries","title":"High-Risk Paths for Service Binaries","text":"<p>These paths are suspicious as service targets (especially for auto-start services):</p> <ul> <li><code>C:\\ProgramData</code></li> <li><code>C:\\Users\\Public</code></li> <li><code>%AppData%</code> / <code>\\AppData\\Roaming</code></li> <li><code>%LocalAppData%</code> / <code>\\AppData\\Local</code></li> <li><code>%Temp%</code> / <code>\\AppData\\Local\\Temp</code></li> <li><code>C:\\Windows\\Temp</code></li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#common-masquerading-filenames","title":"Common Masquerading Filenames","text":"<p>Look for these names when they appear outside <code>C:\\Windows\\System32</code>:</p> <ul> <li><code>svchost.exe</code></li> <li><code>lsass.exe</code></li> <li><code>services.exe</code></li> <li><code>spoolsv.exe</code></li> <li><code>taskhostw.exe</code></li> <li><code>winlogon.exe</code></li> <li><code>explorer.exe</code></li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#naming-patterns-that-deserve-scrutiny","title":"Naming Patterns That Deserve Scrutiny","text":"<ul> <li> <p>Services with vague names:</p> </li> <li> <p><code>Update Service</code>, <code>Windows Update Helper</code>, <code>Security Service</code></p> </li> <li> <p>Random-looking names:</p> </li> <li> <p><code>svc123</code>, <code>a1b2c3</code>, <code>WinSysHost</code></p> </li> <li> <p>Typosquatting:</p> </li> <li> <p><code>WindiwsUpdate</code>, <code>Micros0ft</code></p> </li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#quick-pivot-strings","title":"Quick Pivot Strings","text":"<p>Use these directly in <code>findstr</code> / PowerShell searches:</p> <ul> <li><code>powershell.exe -enc</code></li> <li><code>rundll32.exe</code></li> <li><code>mshta.exe</code></li> <li><code>\\programdata\\</code></li> <li><code>\\users\\public\\</code></li> <li><code>\\appdata\\</code></li> <li><code>\\temp\\</code></li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#tools-and-commands","title":"Tools and Commands","text":""},{"location":"1.Windows/Windows_Services_Persistence/#sysinternals-autoruns","title":"Sysinternals Autoruns","text":"<p>Autoruns highlights:</p> <ul> <li>Services tab shows auto-start services</li> <li>detects unsigned binaries</li> <li>provides quick triage of persistence locations</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#built-in-commands-sc","title":"Built-in Commands (<code>sc</code>)","text":"<p>List all services:</p> <pre><code>sc query state= all\n</code></pre> <p>Query a specific service:</p> <pre><code>sc qc &lt;ServiceName&gt;\n</code></pre> <p>Query failure actions:</p> <pre><code>sc qfailure &lt;ServiceName&gt;\n</code></pre>"},{"location":"1.Windows/Windows_Services_Persistence/#registry-explorer-recmd","title":"Registry Explorer + RECmd","text":"<p>Registry Explorer:</p> <ul> <li>Load <code>SYSTEM</code> hive</li> <li> <p>Navigate to:</p> </li> <li> <p><code>ControlSet001\\\\Services</code></p> </li> <li><code>CurrentControlSet\\\\Services</code></li> </ul> <p>RECmd batch parsing example:</p> <pre><code>RECmd.exe -f SYSTEM --kn \"ControlSet*\\\\Services\" --csv services.csv\n</code></pre>"},{"location":"1.Windows/Windows_Services_Persistence/#kansa-framework-get-svcfailps1","title":"Kansa Framework \u2014 Get-SvcFail.ps1","text":"<p>Kansa includes scripts for service misconfiguration and failure actions.</p> <p>Example:</p> <pre><code>.\\\\Get-SvcFail.ps1\n</code></pre> <p>DFIR Use:</p> <ul> <li>quickly enumerates suspicious failure recovery</li> <li>highlights services launching binaries on failure</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#recmd-batch-template-reb-services-including-failureactions","title":"RECmd Batch Template (.reb) \u2014 Services (Including FailureActions)","text":"<p>Below is a cohesive RECmd batch file you can save as:</p> <ul> <li><code>Services_Persistence.reb</code></li> </ul> <p>It targets common service persistence indicators under <code>CurrentControlSet\\Services</code> and also extracts the <code>Control</code> keys commonly used to store service FailureActions.</p> <p>Note: Service configuration can exist under <code>ControlSet00x</code> and <code>CurrentControlSet</code>. Using <code>ControlSet*</code> maximizes recall for offline hives.</p> <pre><code>Description: Windows Services Persistence (Services + FailureActions)\nAuthor: DFIR Team\nVersion: 1\nId: 8b0c0e7e-3c8e-4d62-a1cf-000000000020\nKeys:\n  - Description: Services (All) \u2014 Current/ControlSets\n    HiveType: SYSTEM\n    Category: Persistence\n    KeyPath: ControlSet*\\Services\n    Recursive: true\n\n  - Description: Service Control (FailureActions / FailureActionsOnNonCrashFailures)\n    HiveType: SYSTEM\n    Category: Persistence\n    KeyPath: ControlSet*\\Control\n    Recursive: true\n</code></pre>"},{"location":"1.Windows/Windows_Services_Persistence/#recmd-usage-examples","title":"RECmd Usage Examples","text":"<p>Single hive:</p> <pre><code>RECmd.exe -f SYSTEM --bn Services_Persistence.reb --csv E:\\out\n</code></pre> <p>Directory of hives (post-KAPE):</p> <pre><code>RECmd.exe -d E:\\KAPE\\Files --bn Services_Persistence.reb --csv E:\\out\n</code></pre> <p>Pivot Tip: After export, search for:</p> <ul> <li>suspicious paths (<code>C:\\ProgramData</code>, <code>C:\\Users\\Public</code>, <code>\\Temp</code>)</li> <li>LOLbins (<code>rundll32.exe</code>, <code>powershell.exe</code>, <code>mshta.exe</code>)</li> <li>unexpected drivers (<code>.sys</code> under non-standard directories)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#kape-targets-modules-services-event-logs","title":"KAPE Targets &amp; Modules (Services + Event Logs)","text":"<p>To investigate service persistence, collect:</p> <ul> <li><code>SYSTEM</code> hive (service configuration)</li> <li>Windows Event Logs containing service creation/start/stop evidence</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#what-to-collect","title":"What to Collect","text":"Evidence Where Notes Service configs <code>SYSTEM</code> hive <code>C:\\Windows\\System32\\config\\SYSTEM</code> Service install events Security log Event ID 4697 (if auditing enabled) Service creation (SCM) System log Event ID 7045 Service state changes System log Event ID 7036"},{"location":"1.Windows/Windows_Services_Persistence/#kape-targets","title":"KAPE Targets","text":"<p>Target names vary by your KAPETargets pack, but commonly include:</p> <ul> <li><code>SYSTEM</code> or <code>RegistryHives</code></li> <li><code>EventLogs</code> or <code>EVTX</code></li> </ul> <p>Example collection:</p> <pre><code>kape.exe --tsource C: --tdest E:\\KAPE --target SYSTEM,EventLogs\n</code></pre>"},{"location":"1.Windows/Windows_Services_Persistence/#kape-modules-optional-parsing","title":"KAPE Modules (Optional Parsing)","text":"<ul> <li><code>RECmd</code> (parse SYSTEM hive)</li> <li><code>EvtxECmd</code> (parse EVTX)</li> </ul> <p>Example collect + parse:</p> <pre><code>kape.exe --tsource C: --tdest E:\\KAPE --target SYSTEM,EventLogs --module RECmd,EvtxECmd\n</code></pre> <p>Tip: If you have a custom RECmd module/batch, point the module to <code>Services_Persistence.reb</code>.</p>"},{"location":"1.Windows/Windows_Services_Persistence/#mitre-attck-mapping-services","title":"MITRE ATT&amp;CK Mapping (Services)","text":""},{"location":"1.Windows/Windows_Services_Persistence/#persistence","title":"Persistence","text":"<ul> <li> <p>T1543.003 \u2013 Create or Modify System Process: Windows Service</p> </li> <li> <p>Creating a new service (e.g., <code>sc create</code>)</p> </li> <li>Modifying an existing service (<code>ImagePath</code>, <code>Start</code>, <code>ObjectName</code>)</li> <li>Service replacement (legitimate service name, malicious binary)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#privilege-escalation-related","title":"Privilege Escalation (Related)","text":"<ul> <li>T1543.003 often results in execution under high privilege (LocalSystem)</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#defense-evasion-related","title":"Defense Evasion (Related)","text":"<ul> <li> <p>T1036 \u2013 Masquerading</p> </li> <li> <p>Legitimate-sounding service names/descriptions</p> </li> <li> <p>Reusing real service names</p> </li> <li> <p>T1070 \u2013 Indicator Removal on Host</p> </li> <li> <p>Removing service keys</p> </li> <li> <p>Clearing System/Security logs</p> </li> <li> <p>T1562 \u2013 Impair Defenses</p> </li> <li> <p>Disabling logging/auditing needed for 4697</p> </li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#execution-related","title":"Execution (Related)","text":"<ul> <li> <p>T1059 \u2013 Command and Scripting Interpreter</p> </li> <li> <p>Services that execute <code>cmd.exe</code>, <code>powershell.exe</code>, scripts</p> </li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#evasion-techniques","title":"Evasion Techniques","text":"<p>Attackers may:</p> <ul> <li>masquerade service names/descriptions</li> <li>use legitimate service names (service replacement)</li> <li> <p>point <code>ImagePath</code> to:</p> </li> <li> <p><code>C:\\ProgramData</code></p> </li> <li><code>C:\\Users\\Public</code></li> <li><code>%AppData%</code></li> <li>use signed LOLbins as service targets</li> <li>disable logging or clear event logs</li> <li>revert registry hives / timestomp binaries</li> </ul>"},{"location":"1.Windows/Windows_Services_Persistence/#references","title":"References","text":"<ul> <li>Microsoft Service Control Manager documentation</li> <li>Sysinternals Autoruns</li> <li>MITRE ATT&amp;CK T1543.003 (Windows Service)</li> <li>Kansa Framework</li> </ul>"},{"location":"Cloud/","title":"Overview","text":"<p>Placeholder</p>"},{"location":"ICS/","title":"Overview","text":"<p>Placeholder</p>"},{"location":"Linux/","title":"Overview","text":"<p>Placeholder</p>"},{"location":"Malware/","title":"Overview","text":"<p>Placeholder</p>"},{"location":"Networking/","title":"Overview","text":"<p>Placeholder</p>"},{"location":"Tools/","title":"Overview","text":"<ul> <li>Find Evil Run Book</li> <li>DFIR Eric Zimmerman Tools for Host Investigations</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/","title":"DFIR Eric Zimmerman Tools (SANS EZ Tools)","text":"<p>Purpose: This page documents the common DFIR command-line tools highlighted in the SANS \u201cForensics the EZ Way \u2013 Results in Seconds at the Command Line\u201d poster, including what each tool is for, what artifacts it processes, and copy/paste-ready usage examples.  Recommended use: bake these into repeatable triage scripts and standardize output formats (CSV/JSON/HTML) across investigations. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#common-ez-tools-cli-conventions","title":"Common EZ Tools CLI Conventions","text":"<p>The poster highlights common switches shared across many EZ tools: </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#common-input-options","title":"Common input options","text":"<ul> <li><code>-d</code> : directory to process</li> <li><code>-f</code> : file to process</li> <li><code>-q</code> : quiet mode</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#common-output-options","title":"Common output options","text":"<ul> <li><code>--csv &lt;dir&gt;</code> : export CSV</li> <li><code>--json &lt;dir&gt;</code> : export JSON</li> <li><code>--html &lt;dir&gt;</code> : export HTML</li> <li>Multiple export formats can be specified at once (ex: <code>--csv ... --json ...</code>). </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#time-format-verbosity","title":"Time format + verbosity","text":"<ul> <li><code>--dt &lt;format&gt;</code> : custom date/time format</li> <li><code>--debug</code> : debug output</li> <li><code>--trace</code> : trace output (usually with <code>--debug</code>)</li> <li><code>--sync</code> : sync updates from GitHub (ex: KAPE targets/modules updates; evtxecmd map updates). </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#volume-shadow-copy-processing","title":"Volume Shadow Copy processing","text":"<ul> <li><code>--vss</code> : process Volume Shadow Copies   Supported in EvtxECmd, MFTECmd, PECmd, and RECmd. </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#vscmount-volume-shadow-copy-mounter","title":"VSCMount \u2014 Volume Shadow Copy Mounter","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is","title":"What it is","text":"<p>VSCMount mounts each Volume Shadow Copy from a mounted evidence disk to a folder so you can browse historical versions of the filesystem and recover deleted/older files. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type","title":"Artifact type","text":"<ul> <li>Volume Shadow Copies (VSS)</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage","title":"Basic usage","text":"<p>Evidence must be mounted as a physical drive first (example uses drive <code>E:</code>). </p> <pre><code>.\\VSCMount.exe --dl E --mp C:\\VSCs\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#advanced-usage","title":"Advanced usage","text":"<p>Add creation date to each mapped VSC folder (<code>--ud</code>). </p> <pre><code>.\\VSCMount.exe --dl E --mp C:\\VSCs --ud\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#what-to-look-for","title":"What to look for","text":"<ul> <li>Prior versions of:</li> <li>registry hives</li> <li>event logs</li> <li>malware that was deleted/wiped</li> <li>renamed payloads</li> <li>Compare attacker-modified timestamps against older copies for tampering.</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#sqlecmd-sqlite-parser","title":"SQLECmd \u2014 SQLite Parser","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_1","title":"What it is","text":"<p>Parses SQLite databases using schema-specific map files (e.g., Chrome History). </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_1","title":"Artifact type","text":"<ul> <li>SQLite DBs (browsers, cloud tools, chat apps, phone backups, etc.) </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_1","title":"Basic usage","text":"<p>Single DB: <pre><code>SQLECmd.exe -f G:\\databases\\database.db --csv G:\\SQLECmd_output\n</code></pre></p> <p>Folder of DBs: <pre><code>SQLECmd.exe -d G:\\databases\\ --csv G:\\SQLECmd_output\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#key-output","title":"Key output","text":"<ul> <li>Multiple CSVs depending on DB schema (for Chrome History: history, downloads, keyword searches, etc.). </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#advanced-notes","title":"Advanced notes","text":"<ul> <li>SQLECmd only parses schemas that have map files; custom maps can be made by adding SQL queries. </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#sumecmd-user-access-log-parser-windows-server","title":"SumECmd \u2014 User Access Log Parser (Windows Server)","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_2","title":"What it is","text":"<p>Parses User Access Logs from Windows Servers (tracks user requests, connections, usernames, client IPs; useful for lateral movement). </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_2","title":"Artifact type","text":"<ul> <li>User Access Logging databases (SUM) on Windows Server </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#inputs","title":"Inputs","text":"<ul> <li><code>C:\\Windows\\System32\\LogFiles\\SUM</code></li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#pre-processing-required","title":"Pre-processing (REQUIRED)","text":"<p>Poster recommends repairing the copied SUM ESE databases before parsing:</p> <pre><code>esentutl.exe /r svc /i /o\nesentutl.exe /p Current.mdb\nesentutl.exe /p SystemIdentity.mdb\nesentutl.exe /p &lt;GUID&gt;.mdb\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_2","title":"Basic usage","text":"<pre><code>SumECmd.exe -d G:\\sum_fixed\\ --csv G:\\sum_output\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#key-output_1","title":"Key output","text":"<ul> <li><code>ClientDetail</code> (dates/times, role/service accessed, domain, username, source IP). </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#hunt-tip","title":"Hunt tip","text":"<ul> <li>Look for domains/users/IPs not part of the org (anomalous access). </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#bstrings-extract-text-from-binary-files","title":"bstrings \u2014 Extract Text From Binary Files","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_3","title":"What it is","text":"<p>Searches any file type for interesting strings (including Unicode and selected ANSI code pages). </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_3","title":"Artifact type","text":"<ul> <li>Any binary file, including EVTX, EXE, DLL, memory dumps, etc.</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_3","title":"Basic usage","text":"<pre><code>bstrings.exe -f &lt;file&gt;\n</code></pre> <p>Search for a string: <pre><code>bstrings.exe -f &lt;file&gt; --ls \"password\"\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#useful-switches","title":"Useful switches","text":"<ul> <li><code>-x</code> / <code>-m</code> : set maximum/minimum string lengths</li> <li><code>--off</code> : show offset for each hit </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#regex-hunting","title":"Regex hunting","text":"<p>List built-in regex patterns: <pre><code>bstrings.exe -p\n</code></pre></p> <p>Use a built-in regex (example: email): <pre><code>bstrings.exe -f suspect.exe --lr email\n</code></pre></p> <p>Multiple regexes from a file: <pre><code>bstrings.exe -f suspect.exe -fr DFIR_RegExs.txt\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#evtx-note-important","title":"EVTX note (important)","text":"<p>Windows Event Logs require code page 1201 to find strings: </p> <pre><code>bstrings.exe -f Powershell.evtx --ls download --cp 1201\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#appcompatcacheparser-shimcache-parser","title":"AppCompatCacheParser \u2014 ShimCache Parser","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_4","title":"What it is","text":"<p>Parses Application Compatibility Cache (ShimCache) from a SYSTEM hive. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_4","title":"Artifact type","text":"<ul> <li>AppCompatCache / ShimCache (registry-derived execution-ish evidence)</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_4","title":"Basic usage","text":"<pre><code>AppCompatCacheParser.exe -f E:\\Windows\\System32\\config\\SYSTEM --csv G:\\AppCompatCache\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#key-output-fields","title":"Key output fields","text":"<ul> <li><code>Path</code></li> <li><code>LastModifiedTimeUTC</code> (file last modified; NOT execution time)</li> <li><code>Executed</code> (flag/indicator) </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#investigation-tip","title":"Investigation tip","text":"<ul> <li>Watch <code>Path</code> prefix (e.g., <code>SYSVOL\\...</code> indicates OS volume). </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#rbcmd-recycle-bin-artifact-parser","title":"RBCmd \u2014 Recycle Bin Artifact Parser","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_5","title":"What it is","text":"<p>Parses <code>$I</code> files in Recycle Bin to identify original path/name and deletion timestamps. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_5","title":"Artifact type","text":"<ul> <li>Recycle Bin <code>$I</code> metadata files</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_5","title":"Basic usage","text":"<p>Single <code>$I</code> file: <pre><code>RBCmd.exe -f E:\\$Recycle.Bin\\&lt;SID&gt;\\$I7YQ28P.jpg\n</code></pre></p> <p>Folder mode: <pre><code>RBCmd.exe -d F:\\$Recycle.Bin\\&lt;SID&gt; --csv G:\\RBFiles -q\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#pro-tip","title":"Pro tip","text":"<p>On mounted drives Windows may not expose deleted files; recover <code>$I</code> files first, then parse. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#jlecmd-jump-list-explorer-cli","title":"JLECmd \u2014 Jump List Explorer (CLI)","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_6","title":"What it is","text":"<p>Parses Windows Jump Lists (AutoDestinations) for evidence of file knowledge and execution context. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_6","title":"Artifact type","text":"<ul> <li>Jump Lists (AutomaticDestinations)</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_6","title":"Basic usage","text":"<p>Single Jump List: <pre><code>JLECmd.exe -f E:\\Users\\Donald\\AppData\\Microsoft\\Windows\\Recent\\AutomaticDestinations\\&lt;appid&gt;.automaticDestinations-ms --csv G:\\Jumplists -q\n</code></pre></p> <p>Folder mode: <pre><code>JLECmd.exe -d E:\\Users\\Donald\\AppData\\Microsoft\\Windows\\Recent\\AutomaticDestinations --csv G:\\Jumplists -q\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#advanced-hunting-poster-tip","title":"Advanced hunting (poster tip)","text":"<p>Look for changes in: - <code>DriveType</code> - <code>VolumeSerialNumber</code> - <code>VolumeLabel</code> These indicate files opened from external devices. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#srumecmd-srum-parser","title":"SRUMECmd \u2014 SRUM Parser","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_7","title":"What it is","text":"<p>Parses SRUM to understand app usage, network usage, power usage, and wireless network context. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_7","title":"Artifact type","text":"<ul> <li><code>SRUDB.dat</code> (ESE database) + SOFTWARE hive</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#required-repair-step","title":"Required repair step","text":"<p>Poster recommends repairing SRUDB after copying the folder: </p> <pre><code>esentutl.exe /r sru /i /o\nesentutl.exe /p SRUDB.dat /o\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_7","title":"Basic usage","text":"<pre><code>SRUMECmd.exe -f G:\\sru_fixed\\SRUDB.dat -r E:\\Windows\\System32\\config\\SOFTWARE --csv G:\\SRUM_output\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#key-output_2","title":"Key output","text":"<p>Multiple CSVs (application usage, energy, network usage/connectivity). Data is recorded in 30\u201360 minute segments. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#reporting-tip","title":"Reporting tip","text":"<p>Plot bandwidth/application usage over time in Excel for report visuals. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#wxtcmd-timeline-explorer","title":"WxTCmd \u2014 Timeline Explorer","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_8","title":"What it is","text":"<p>Parses Windows 10 Timeline (ActivitiesCache.db) tracking last ~30 days of apps/files opened by user and synced devices. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_8","title":"Artifact type","text":"<ul> <li>ActivitiesCache.db (Windows Timeline)</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_8","title":"Basic usage","text":"<pre><code>WxTCmd.exe -f E:\\Users\\srogers\\AppData\\Local\\ConnectedDevicesPlatform\\&lt;varies&gt;\\ActivitiesCache.db --csv G:\\WxT_output\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#key-fields","title":"Key fields","text":"<ul> <li><code>Executable</code> (path)</li> <li><code>Display Text</code> (content opened + app)</li> <li><code>Content Info</code> (location/resource)</li> <li><code>Start Time</code> (first time this activity occurred in last 30 days) </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#advanced-tip","title":"Advanced tip","text":"<p><code>Content Info</code> can include a Volume GUID, enabling correlation to a specific device/volume. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#lecmd-lnk-file-explorer","title":"LECmd \u2014 LNK File Explorer","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_9","title":"What it is","text":"<p>Parses Windows shortcut (.lnk) files (target path, drive type, volume serial/label, timestamps, etc.). </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_9","title":"Artifact type","text":"<ul> <li><code>*.lnk</code> shortcut files</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_9","title":"Basic usage","text":"<p>Single file: <pre><code>LECmd.exe -f E:\\Users\\srogers\\AppData\\Microsoft\\Windows\\Recent\\Peggy.jpg.lnk\n</code></pre></p> <p>Folder mode: <pre><code>LECmd.exe -d E:\\Users\\srogers\\AppData\\Microsoft\\Windows\\Recent --csv G:\\LnkFiles -q\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#forensic-interpretations-poster-highlights","title":"Forensic interpretations (poster highlights)","text":"<ul> <li>If <code>TargetModified</code> precedes <code>TargetCreated</code>, file likely copied from another volume.</li> <li>Multiple opens may be inferred by differences in source created/modified fields. </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#amcacheparser-amcache-parser","title":"AmcacheParser \u2014 Amcache Parser","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_10","title":"What it is","text":"<p>Parses <code>Amcache.hve</code> hive to identify programs present/run and extract SHA1 hashes. </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_10","title":"Artifact type","text":"<ul> <li><code>Amcache.hve</code></li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_10","title":"Basic usage","text":"<pre><code>AmcacheParser.exe -f E:\\Windows\\AppCompat\\Programs\\Amcache.hve --csv G:\\Amcache\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#key-output-fields_1","title":"Key output fields","text":"<ul> <li><code>FileIDLastWriteTimestamp</code> (first time executable was run)</li> <li><code>SHA1</code></li> <li><code>FullPath</code></li> <li>Volume/MFT identifiers for NTFS correlation </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#advanced-usage-blacklistwhitelist-by-hash","title":"Advanced usage: blacklist/whitelist by hash","text":"<pre><code>AmcacheParser.exe -f E:\\Windows\\AppCompat\\Programs\\Amcache.hve -b G:\\Blacklist.txt --csv G:\\Amcache\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#mftecmd-mft-explorer","title":"MFTECmd \u2014 MFT Explorer","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_11","title":"What it is","text":"<p>Parses NTFS internal files: - <code>$MFT</code>, <code>$J</code> (USN Journal), <code>$SDS</code>, <code>$LogFile</code>, <code>$Boot</code> </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_11","title":"Artifact type","text":"<ul> <li>NTFS metadata artifacts</li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#basic-usage_11","title":"Basic usage","text":"<p>Exported MFT: <pre><code>MFTECmd.exe -f \"G:\\Exports\\$MFT\" --csv G:\\MFT_Output\n</code></pre></p> <p>Directly from mounted evidence: <pre><code>MFTECmd.exe -f \"E:\\$MFT\" --csv G:\\MFT_Output\n</code></pre></p> <p>Alternate data streams for USN + Secure: <pre><code>MFTECmd.exe -f \"E:\\$Extend\\$UsnJrnl:$MFT\" --csv G:\\USN_Output\nMFTECmd.exe -f \"E:\\$Secure:$SDS\" --csv G:\\SDS_Output\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#vss-processing","title":"VSS processing","text":"<p>Poster highlights MFTECmd can pull older versions via VSS using <code>--vss</code> and avoid duplicates with <code>--dedupe</code>: </p> <pre><code>MFTECmd.exe -f \"E:\\$Extend\\$UsnJrnl:$J\" --csv G:\\MFT_Output --vss --dedupe\n</code></pre>"},{"location":"Tools/DFIR_Command_Line_Tools/#key-interpretations","title":"Key interpretations","text":"<ul> <li><code>Modified &lt; Created</code> strongly suggests a file was copied from another volume. </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#recmd-registry-explorer-cli","title":"RECmd \u2014 Registry Explorer (CLI)","text":""},{"location":"Tools/DFIR_Command_Line_Tools/#what-it-is_12","title":"What it is","text":"<p>Command-line Registry parsing/search/export at scale (consistent output across many hosts). </p>"},{"location":"Tools/DFIR_Command_Line_Tools/#artifact-type_12","title":"Artifact type","text":"<ul> <li>Registry hives (NTUSER/SAM/SECURITY/SOFTWARE/SYSTEM/USRCLASS/AMCACHE/etc.) </li> </ul>"},{"location":"Tools/DFIR_Command_Line_Tools/#search-examples","title":"Search examples","text":"<p>Search NTUSER key names: <pre><code>RECmd.exe -f \"C:\\Temp\\NTUSER.dat\" --sk Dropbox\n</code></pre></p> <p>Search USRCLASS value data: <pre><code>RECmd.exe -f \"C:\\Temp\\UsrClass.dat\" --sd Dropbox\n</code></pre></p> <p>Search directory of hives with filters: <pre><code>RECmd.exe --d \"C:\\Temp\\registry_files\" --sk \"Dropbox\" --StartDate \"11/13/2014 15:35:01\" --RegEx --sv \"(App|Display)Name\" --recover false --nl\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#search-notes-poster","title":"Search notes (poster)","text":"<ul> <li>Start/EndDate filter uses LastWrite timestamps (UTC)</li> <li><code>--minsize</code> can find very large values (often used for malware)</li> <li><code>--Base64</code> decodes Base64-encoded registry values</li> <li><code>--recover true</code> retrieves deleted keys/values (when supported) </li> </ul> <p>Example large/base64 hunting: <pre><code>RECmd.exe -d \"C:\\Temp\\registry_files\" --minsize 1M --Base64 --recover true\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#batch-mode-reb","title":"Batch mode (REB)","text":"<p>RECmd supports batch mode with <code>.reb</code> bundles, using <code>HiveType</code> to target only relevant hives. </p> <p>Example: <pre><code>RECmd.exe --bn .\\BatchExamples\\BatchExampleUserAssist.reb -f C:\\Temp\\NTUSER_dblake.DAT --nl --csv C:\\Temp\n</code></pre></p>"},{"location":"Tools/DFIR_Command_Line_Tools/#quick-start-standardized-output-folder-layout","title":"Quick Start: Standardized Output Folder Layout","text":"<p>Recommended standard run folder (repeatable across cases/hosts):</p> <pre><code>Case_&lt;ID&gt;\\\n  Host_&lt;HOSTNAME&gt;\\\n    EZTools\\\n      VSCMount\\\n      SQLECmd\\\n      SumECmd\\\n      bstrings\\\n      AppCompatCache\\\n      RecycleBin\\\n      JumpLists\\\n      SRUM\\\n      Timeline\\\n      LNK\\\n      Amcache\\\n      MFT\\\n      Registry\\\n</code></pre> <p>End of file. Poster reference: SANS EZ Tools Poster </p>"},{"location":"Tools/Find_Evil_Run_Book/","title":"Find Evil DFIR Run Book (SANS Hunt Evil Poster Driven)","text":"<p>Purpose: This run book operationalizes the SANS DFIR \u201cHunt Evil / Find Evil\u201d poster into an Incident Response + Forensic Analysis workflow. It provides step-by-step collection, analysis, and hunting checklists, including a RECmd <code>.reb</code> bundle for poster registry artifacts. Source poster: SANS DFIR Hunt Evil Poster </p>"},{"location":"Tools/Find_Evil_Run_Book/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Operating Rules</li> <li>Response Modes</li> <li>Collection Plan</li> <li>Know Normal (Process Baseline)</li> <li>Evidence of Program Execution</li> <li>Lateral Movement</li> <li>KAPE Collection Mapping</li> <li>Deliverables</li> <li>Appendix A \u2014 RECmd <code>.reb</code> Bundle</li> </ol>"},{"location":"Tools/Find_Evil_Run_Book/#operating-rules","title":"Operating Rules","text":""},{"location":"Tools/Find_Evil_Run_Book/#evidence-handling","title":"Evidence handling","text":"<ul> <li>Maintain chain of custody for all media/images/exports.</li> <li>Record:</li> <li>Hostname / asset ID</li> <li>Date/time acquired (UTC)</li> <li>Tool used + version</li> <li>Hashes (MD5/SHA256)</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#time-normalization","title":"Time normalization","text":"<ul> <li>Record:</li> <li>System time + timezone</li> <li>NTP settings</li> <li>Normalize all timestamps to UTC for correlation.</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#response-modes","title":"Response Modes","text":""},{"location":"Tools/Find_Evil_Run_Book/#rapid-triage-3090-minuteshost","title":"Rapid Triage (30\u201390 minutes/host)","text":"<p>Use when immediate scoping is needed. Collect: - Volatile triage (processes + net connections) - Event logs (Security/System + poster-relevant operational logs) - Registry hives (SYSTEM/SOFTWARE/SAM/SECURITY + user hives) - Execution artifacts (Prefetch, Amcache, ShimCache, BAM/DAM, SRUM, Jump Lists)</p>"},{"location":"Tools/Find_Evil_Run_Book/#full-forensic-acquisition-26-hourshost","title":"Full Forensic Acquisition (2\u20136+ hours/host)","text":"<p>Use when: - Privilege escalation is suspected - Malware present/unknown - Lateral movement is confirmed - Legal/regulatory requirements exist Collect triage set +: - Full disk image - Full memory image - pagefile/hiberfile - VSS snapshots (if feasible)</p>"},{"location":"Tools/Find_Evil_Run_Book/#collection-plan","title":"Collection Plan","text":""},{"location":"Tools/Find_Evil_Run_Book/#minimum-artifact-checklist-per-host","title":"Minimum Artifact Checklist (per host)","text":"<p>Memory - RAM capture (preferred) - Running processes + command lines - Network connections + listening ports - Loaded modules / suspicious injections</p> <p>Disk - MFT / USN Journal (if possible) - Prefetch (<code>C:\\Windows\\Prefetch</code>)  - Amcache (<code>C:\\Windows\\AppCompat\\Programs\\Amcache.hve</code>)  - SRUM (<code>C:\\Windows\\System32\\SRU\\SRUDB.dat</code>)  - Jump Lists (AutomaticDestinations) </p> <p>Registry - SYSTEM / SOFTWARE / SECURITY / SAM - NTUSER.DAT and USRCLASS.DAT (primary users) - Poster keys:   - BAM/DAM   - ShimCache/AppCompatCache   - Services   - Scheduled TaskCache   - RDP Client servers list   - MountPoints2   - PowerShell ExecutionPolicy </p> <p>Event logs - <code>Security.evtx</code> - <code>System.evtx</code> - Operational logs:   - TaskScheduler Operational   - PowerShell Operational + Windows PowerShell   - WinRM Operational   - WMI Activity Operational   - RDPClient Operational   - RdpCoreTS / RemoteConnectionManager / LocalSessionManager   - SMBClient Security </p>"},{"location":"Tools/Find_Evil_Run_Book/#know-normal-process-baseline","title":"Know Normal (Process Baseline)","text":"<p>The poster emphasizes \u201cKnow Normal\u201d to identify malicious outliers quickly. </p>"},{"location":"Tools/Find_Evil_Run_Book/#baseline-validation-checklist","title":"Baseline validation checklist","text":"<ul> <li> Validate image path is expected (system binaries in correct directories)</li> <li> Validate signature (Microsoft signed expected for Windows binaries)</li> <li> Validate parent process is expected</li> <li> Validate user context (SYSTEM vs user context)</li> <li> Look for spelling tricks (<code>svch0st.exe</code>, <code>1sass.exe</code>, etc.)</li> <li> Identify anomalies:</li> <li>weird command-line args</li> <li>unsigned binaries in Windows dirs</li> <li>unexpected children of <code>lsass.exe</code>, <code>services.exe</code>, <code>wininit.exe</code></li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#evidence-of-program-execution","title":"Evidence of Program Execution","text":"<p>The poster execution artifacts to prioritize: SRUM, BAM/DAM, UserAssist, Jump Lists, ShimCache, Prefetch, Amcache. </p>"},{"location":"Tools/Find_Evil_Run_Book/#srum","title":"SRUM","text":"<ul> <li>Location: <code>C:\\Windows\\System32\\SRU\\SRUDB.dat</code></li> <li>Hunt:</li> <li> Identify apps with unusual network usage</li> <li> Identify rare executables and spikes</li> <li> Correlate with logon timestamps</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#bamdam","title":"BAM/DAM","text":"<ul> <li>Location:  </li> <li><code>SYSTEM\\CurrentControlSet\\Services\\bam\\UserSettings\\{SID}</code> </li> <li><code>SYSTEM\\CurrentControlSet\\Services\\dam\\UserSettings\\{SID}</code> </li> <li><code>...bam\\State\\UserSettings\\{SID}</code> (Win10 1809+) </li> <li>Hunt:</li> <li> Flag executions from user-writable dirs</li> <li> Identify LOLBins used unusually</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#userassist","title":"UserAssist","text":"<ul> <li>Location: <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{GUID}\\Count</code> </li> <li>Hunt:</li> <li> Decode ROT13 values</li> <li> Identify first-seen admin tools or remote tools</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#jump-lists","title":"Jump Lists","text":"<ul> <li>Location: <code>%USERPROFILE%\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\AutomaticDestinations</code> </li> <li>Hunt:</li> <li> Identify remote paths / staging locations</li> <li> Map access to sensitive files</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#shimcache-appcompatcache","title":"ShimCache (AppCompatCache)","text":"<ul> <li>Location:  </li> <li>XP: <code>SYSTEM\\...\\Session Manager\\AppCompatibility</code> </li> <li>Win7+: <code>SYSTEM\\...\\Session Manager\\AppCompatCache</code> </li> <li>Hunt:</li> <li> Identify suspicious executables that existed on disk</li> <li> Correlate with MFT/Amcache hashes</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#prefetch","title":"Prefetch","text":"<ul> <li>Location: <code>C:\\Windows\\Prefetch</code> </li> <li>Hunt:</li> <li> Identify suspicious EXE executions</li> <li> Review embedded referenced files/paths</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#amcachehve","title":"Amcache.hve","text":"<ul> <li>Location: <code>C:\\Windows\\AppCompat\\Programs\\Amcache.hve</code> </li> <li>Hunt:</li> <li> Extract SHA1 for suspicious binaries/drivers</li> <li> Identify odd compilation time/publisher anomalies</li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#lateral-movement","title":"Lateral Movement","text":"<p>Poster provides a practical map for Remote Access and Remote Execution artifact hunting. </p>"},{"location":"Tools/Find_Evil_Run_Book/#remote-access-smb-admin-shares","title":"Remote Access: SMB / Admin shares","text":"<p>Source host - Security log: 4648 - SMBClient Security: 31001 - Registry: MountPoints2, Shellbags - Execution: ShimCache/BAM-DAM/Amcache/Prefetch for <code>net.exe</code> / <code>net1.exe</code> </p> <p>Destination host - Security: 4624 Type 3, 4672, 4776, 5140, 5145 - DC: 4768, 4769 - Files: attacker tool drops (creation time = copy time) </p>"},{"location":"Tools/Find_Evil_Run_Book/#remote-access-rdp","title":"Remote Access: RDP","text":"<p>Source - Registry: <code>NTUSER\\...\\Terminal Server Client\\Servers</code> - RDPClient Operational: 1024, 1102 - Files: Jump lists for MSTSC, bitmap cache, <code>Default.rdp</code></p> <p>Destination - Security: 4624 Type 10, 4778/4779 - RDS logs: 1149, 21/22/25/41, 98/131 </p>"},{"location":"Tools/Find_Evil_Run_Book/#remote-execution-scheduled-tasks","title":"Remote Execution: Scheduled Tasks","text":"<ul> <li>Security: 4698, 4702, 4699, 4700/4701</li> <li>TaskScheduler Operational: 106, 140, 141, 200/201</li> <li>Registry: TaskCache <code>Tasks</code> + <code>Tree</code></li> <li>Files: <code>C:\\Windows\\Tasks</code>, <code>C:\\Windows\\System32\\Tasks</code>, <code>C:\\Windows\\SysWOW64\\Tasks</code> </li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#remote-execution-services","title":"Remote Execution: Services","text":"<ul> <li>Security: 4697 (if enabled)</li> <li>System: 7034, 7035, 7036, 7040, 7045</li> <li>Registry: <code>SYSTEM\\CurrentControlSet\\Services\\</code> </li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#remote-execution-powershell-remoting-winrm","title":"Remote Execution: PowerShell Remoting / WinRM","text":"<ul> <li>WinRM Operational: 6, 91, 142, 161, 169</li> <li>PowerShell Operational: 40961, 40962, 8193/8194, 8197</li> <li>Script Block Logging: 4103/4104 (if enabled)</li> <li>Registry: ExecutionPolicy key </li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#remote-execution-wmiwmic","title":"Remote Execution: WMI/WMIC","text":"<ul> <li>WMI Activity Operational: 5857, 5860, 5861</li> <li>Files: <code>.mof</code>, repository changes under <code>C:\\Windows\\System32\\wbem\\Repository</code> </li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#remote-execution-psexec","title":"Remote Execution: PsExec","text":"<ul> <li>Registry:</li> <li><code>NTUSER.DAT\\Software\\Sysinternals\\PsExec\\EulaAccepted</code></li> <li><code>SYSTEM\\CCS\\Services\\PSEXESVC</code></li> <li>System: 7045</li> <li>Files: <code>psexesvc.exe</code> in <code>ADMIN$ (\\Windows)</code> </li> </ul>"},{"location":"Tools/Find_Evil_Run_Book/#kape-collection-mapping","title":"KAPE Collection Mapping","text":"<p>Triage KAPE target set - Registry: SYSTEM/SOFTWARE/SAM/SECURITY + NTUSER/USRCLASS - Event logs: Security/System + poster operational logs - Prefetch, Amcache, SRUM, Jump Lists, PSReadline history</p> <p>Full KAPE target set - Add: <code>$MFT</code>, <code>$UsnJrnl</code>, LNK files, browser artifacts, recycle bin, scheduled task folders, services keys</p>"},{"location":"Tools/Find_Evil_Run_Book/#deliverables","title":"Deliverables","text":"<p>Per host - Collection log + hashes - Execution evidence timeline (Prefetch/Amcache/ShimCache/BAM-DAM/SRUM/UserAssist/Jumplists) - Auth + movement chain (source user/host \u2192 destination/method) - IOC list (hashes, filenames/paths, service/task names, IPs/domains)</p> <p>Enterprise - Lateral movement map - Affected host list - Containment recommendations</p>"},{"location":"Tools/Find_Evil_Run_Book/#appendix-a-recmd-reb-bundle","title":"Appendix A \u2014 RECmd <code>.reb</code> Bundle","text":"<p>Save as: <code>SANS_HuntEvil_PosterArtifacts.reb</code> This RECmd bundle aligns to poster artifacts: BAM/DAM, ShimCache, Amcache (hive), Services, Scheduled TaskCache, plus key lateral-movement support keys (RDP servers, MountPoints2, PsExec, ExecutionPolicy). </p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RegistryExplorerBookmarkFile xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n                              xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\n                              Comment=\"SANS Hunt Evil / Find Evil Poster - Registry Artifacts Bundle\"\n                              Author=\"DFIR Run Book\"\n                              Version=\"1\"&gt;\n\n  &lt;!-- ========================= --&gt;\n  &lt;!-- Evidence of Program Execution --&gt;\n  &lt;!-- ========================= --&gt;\n\n  &lt;!-- BAM/DAM (Win10+) --&gt;\n  &lt;Bookmark Name=\"BAM - UserSettings (Win10+)\"\n            Category=\"Execution Evidence\\BAM-DAM\"\n            Description=\"BAM tracks executed file full path and last execution time (typically ~1 week).\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Services\\bam\\UserSettings\" /&gt;\n\n  &lt;Bookmark Name=\"BAM - State (Win10 1809+)\"\n            Category=\"Execution Evidence\\BAM-DAM\"\n            Description=\"Some Win10+ builds store execution data under State.\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Services\\bam\\State\\UserSettings\" /&gt;\n\n  &lt;Bookmark Name=\"DAM - UserSettings (Win10+)\"\n            Category=\"Execution Evidence\\BAM-DAM\"\n            Description=\"DAM tracks executed file full path and last execution time (typically ~1 week).\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Services\\dam\\UserSettings\" /&gt;\n\n  &lt;Bookmark Name=\"DAM - State (Win10 1809+)\"\n            Category=\"Execution Evidence\\BAM-DAM\"\n            Description=\"Some Win10+ builds store execution data under State.\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Services\\dam\\State\\UserSettings\" /&gt;\n\n  &lt;!-- ShimCache / AppCompatCache --&gt;\n  &lt;Bookmark Name=\"ShimCache (XP) - AppCompatibility\"\n            Category=\"Execution Evidence\\ShimCache\"\n            Description=\"XP-era AppCompatibility database location.\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCompatibility\" /&gt;\n\n  &lt;Bookmark Name=\"ShimCache (Win7+) - AppCompatCache\"\n            Category=\"Execution Evidence\\ShimCache\"\n            Description=\"Win7+ AppCompatCache (ShimCache). Presence != proof of execution.\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCompatCache\" /&gt;\n\n  &lt;!-- Prefetch control (EnablePrefetcher) --&gt;\n  &lt;Bookmark Name=\"Prefetch Settings - PrefetchParameters\"\n            Category=\"Execution Evidence\\Prefetch\"\n            Description=\"EnablePrefetcher value (0 disabled; 3 app launch + boot).\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters\" /&gt;\n\n  &lt;!-- Amcache.hve (separate hive; include as an input hive) --&gt;\n  &lt;Bookmark Name=\"Amcache - Root\"\n            Category=\"Execution Evidence\\Amcache\"\n            Description=\"Amcache tracks program/driver presence; includes SHA1 for executables/drivers.\"\n            KeyPath=\"Amcache\" /&gt;\n\n  &lt;Bookmark Name=\"Amcache - File Entries (Common)\"\n            Category=\"Execution Evidence\\Amcache\"\n            Description=\"Common Amcache file inventory areas vary by OS build; review subkeys for file path, publisher, SHA1.\"\n            KeyPath=\"Amcache\\Root\" /&gt;\n\n  &lt;!-- ========================= --&gt;\n  &lt;!-- Persistence &amp; Remote Execution --&gt;\n  &lt;!-- ========================= --&gt;\n\n  &lt;!-- Services --&gt;\n  &lt;Bookmark Name=\"Services - All\"\n            Category=\"Persistence\\Services\"\n            Description=\"All services and drivers. Review ImagePath/ServiceDll/Start/Type/ObjectName/FailureActions.\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Services\" /&gt;\n\n  &lt;Bookmark Name=\"Services - ControlSet001 (alt view)\"\n            Category=\"Persistence\\Services\"\n            Description=\"Alternate control set view (helpful when CurrentControlSet is ambiguous).\"\n            KeyPath=\"SYSTEM\\ControlSet001\\Services\" /&gt;\n\n  &lt;Bookmark Name=\"Services - ControlSet002 (alt view)\"\n            Category=\"Persistence\\Services\"\n            Description=\"Alternate control set view (if present).\"\n            KeyPath=\"SYSTEM\\ControlSet002\\Services\" /&gt;\n\n  &lt;!-- Scheduled Tasks TaskCache --&gt;\n  &lt;Bookmark Name=\"Scheduled Tasks - TaskCache Tasks\"\n            Category=\"Persistence\\Scheduled Tasks\"\n            Description=\"Task GUID nodes and metadata. Correlate to filesystem Tasks folder and event logs.\"\n            KeyPath=\"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\" /&gt;\n\n  &lt;Bookmark Name=\"Scheduled Tasks - TaskCache Tree\"\n            Category=\"Persistence\\Scheduled Tasks\"\n            Description=\"Task names/folders mapping to task GUIDs. Good pivot for human-readable names.\"\n            KeyPath=\"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\" /&gt;\n\n  &lt;!-- ========================= --&gt;\n  &lt;!-- Lateral Movement - Remote Access/Execution --&gt;\n  &lt;!-- ========================= --&gt;\n\n  &lt;!-- RDP destinations --&gt;\n  &lt;Bookmark Name=\"RDP Client - Servers\"\n            Category=\"Lateral Movement\\RDP (Source)\"\n            Description=\"Per-user RDP destination history (mstsc).\"\n            KeyPath=\"NTUSER\\Software\\Microsoft\\Terminal Server Client\\Servers\" /&gt;\n\n  &lt;!-- MountPoints2 --&gt;\n  &lt;Bookmark Name=\"MountPoints2 - Mapped Shares / Removable\"\n            Category=\"Lateral Movement\\SMB (Source)\"\n            Description=\"Tracks remotely mapped shares and removable usage. Useful for net use / Explorer mappings.\"\n            KeyPath=\"NTUSER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2\" /&gt;\n\n  &lt;!-- PsExec EULA --&gt;\n  &lt;Bookmark Name=\"PsExec - EulaAccepted\"\n            Category=\"Lateral Movement\\PsExec (Source)\"\n            Description=\"Sysinternals PsExec EULA acceptance indicator per-user.\"\n            KeyPath=\"NTUSER\\Software\\Sysinternals\\PsExec\" /&gt;\n\n  &lt;!-- PowerShell Execution Policy --&gt;\n  &lt;Bookmark Name=\"PowerShell - ExecutionPolicy\"\n            Category=\"Lateral Movement\\PowerShell/WinRM\"\n            Description=\"ExecutionPolicy changes may indicate attacker loosening restrictions (e.g., Bypass).\"\n            KeyPath=\"SOFTWARE\\Microsoft\\PowerShell\\1\\ShellIds\\Microsoft.PowerShell\" /&gt;\n\n  &lt;!-- WMI (limited; primary artifacts are logs + repository) --&gt;\n  &lt;Bookmark Name=\"WMI - CIMOM\"\n            Category=\"Lateral Movement\\WMI\"\n            Description=\"WMI service configuration helper key.\"\n            KeyPath=\"SOFTWARE\\Microsoft\\WBEM\\CIMOM\" /&gt;\n\n  &lt;!-- ========================= --&gt;\n  &lt;!-- Authentication / Context --&gt;\n  &lt;!-- ========================= --&gt;\n\n  &lt;Bookmark Name=\"LSA - Authentication Packages\"\n            Category=\"Context\\Authentication\"\n            Description=\"Review Security Support Providers and auth packages for suspicious additions.\"\n            KeyPath=\"SYSTEM\\CurrentControlSet\\Control\\Lsa\" /&gt;\n\n  &lt;Bookmark Name=\"Winlogon - Shell\"\n            Category=\"Context\\Logon\"\n            Description=\"Default shell. Unexpected shells (cmd.exe/powershell.exe) can indicate persistence.\"\n            KeyPath=\"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /&gt;\n\n&lt;/RegistryExplorerBookmarkFile&gt;\n</code></pre>"},{"location":"Tools/Find_Evil_Run_Book/#recmd-execution-example-optional","title":"RECmd execution example (optional)","text":"<p>Example execution idea: - Run the <code>.reb</code> against:   - <code>SYSTEM</code>   - <code>SOFTWARE</code>   - <code>NTUSER.DAT</code>   - <code>Amcache.hve</code></p> <p>Then merge outputs into your case timeline.</p> <p>End of run book.</p>"}]}